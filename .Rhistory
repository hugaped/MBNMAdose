dic <- 1797.080 # nicu
output.excel(sum.mat=sum.mat, coda.d=coda.d,
dic=dic, pd=pd,
outcome=outcome)
save.excl(outcome=outcome, nnorep = nnorep, ncont=ncont, nzero = nzero,
drop.df=drop.df, ndrops = ndrops)
sum.mat
coda.d
outcome
file <- paste0("~/NICE TSU/IoL/ResultExcel/", outcome, ".ind.txt")
index <- read.table(file)
coda.d <- list()
for (i in 1:4) {
file <- paste0("~/NICE TSU/IoL/ResultExcel/", outcome, ".out.", i, ".txt")
coda.long <- read.table(file)
for (k in seq_along(index[,1])) {
temp.d <- coda.long[index[,2][k]:index[,3][k],
2]
coda.d[[as.character(index[,1][k])]] <- append(coda.d[[as.character(index[,1][k])]],
temp.d)
}
}
coda.d <- as.data.frame(coda.d)
colnames(coda.d) <- labs
dic
output.excel(sum.mat=sum.mat, coda.d=coda.d,
dic=dic, pd=pd,
outcome=outcome)
trtnames
run.nma(bugsdat, outcome = outcome, n.iter=300000, n.burnin=50000,
save=FALSE, ume=FALSE, TE="fixed", outresults = FALSE)
outindex <- 7
cervix <- NULL
#cervix <- 3 # Select studies with unfavourable cervix
outnames <- c("novd", "hyper", "cs", "neo", "mat", "inst", "nicu", "epi")
excltrt <- c("Herb", "Sex", "MemSweep", "Breast", "CasOil", "Acu", "Homeo", "HotBath", "Enema")
outcome <- outnames[outindex]
out.df <- get.data(df, outcome=outcome) # Get outcome data from overall data (and print network)
#out.df <- drop.hta(out.df, outcome=outcome) # Drop previously dropped studies from HTA report
if (outcome %in% c("novd", "cs", "nicu")) {
out.df <- change.ref(out.df, ref="vPGE2_tab", outcome=outcome)
}
temp <- drop.excltrt(out.df, excltrt=excltrt) # Drop treatments that are excluded from the analysis
out.df <- temp$df
ndrops <- temp$ndrops
# Drop studies post-2015
# out.df <- out.df[grepl("2015", out.df$studyID)==FALSE,]
# out.df <- out.df[grepl("2016", out.df$studyID)==FALSE,]
# out.df <- out.df[grepl("2017", out.df$studyID)==FALSE,]
# out.df <- out.df[grepl("2018", out.df$studyID)==FALSE,]
# Record numbers and reasons for study exclusions
nnorep <- length(df[[paste0("r1.", outcome)]][is.na(df[[paste0("r1.", outcome)]])])
drop.df <- data.frame("studyID"=NA, "ExclReason"=NA)[-0,]
ncont <- 0
temp <- drop.zeros(out.df)
out.df <- temp$df
nzero <- temp$nzero
# Drop studies prior to recoding
if (outcome=="novd") {
drop.df[nrow(drop.df)+1,] <- c("Frass 2011", "Dropping since r and N are same for NoTrT and it is only study with NoTrt")
out.df <- out.df[!(out.df$studyID %in% drop.df$studyID),]
}
if (outcome=="hyper") {
studies <- c("Sharma 2005", "Chanrachakul 2000a", "Chanrachakul 2002",  "Soliman 2013",
"Wing 2000a", "Johnson 1985", "Chua 1997", "Cromi 2012", "Pennell 2009")
# Add continuity correction for UME model (1:1 ratio)
studies <- append(studies, c("Thiery 1984", "Srisomboon 1996", "Curet 1989",
"Shetty 2004", "Perryman 1992", "Rowlands 2001", "Orhue 1995",
"Rouzi 2017"))
# Add continuity correction for UME model (not 1:1 ratio)
studies <- append(studies, c("Witter 1992", "Witter 1996", "Gelisen 2005",
"Cromi 2011",
"Wing 2004"))
# Add continuity correction for UME model (not 1:1 ratio)
studies <- append(studies, c("Graves 1985", "Rayburn 1992"))
temp <- add.continuity(out.df, studyID = studies)
out.df <- temp$df
ncont <- temp$ncont
}
if (outcome=="cs") {
drop.df[nrow(drop.df)+1,] <- c("Frass 2011", "Removed due to automatic CS after 24 hours")
drop.df[nrow(drop.df)+1,] <- c("Gelisen 2005", "Removed due to automatic CS after 24 hours")
drop.df[nrow(drop.df)+1,] <- c("Atad 1996", "Removed due to quality of trial")
out.df <- out.df[!(out.df$studyID %in% drop.df$studyID),]
studies <- c("Naismith 1973", "Spellacy 1973", "Iskander 1978")
temp <- add.continuity(out.df, studyID = studies)
out.df <- temp$df
ncont <- temp$ncont
}
if (outcome=="neo") {
drop.df[nrow(drop.df)+1,] <- c("Rouzi 2014", "Dropping since r and N are same for NoTrT and it is only study with NoTrt")
out.df <- out.df[!(out.df$studyID %in% drop.df$studyID),]
# # Only continuity correction for studies with close to 1:1 randomisation
# studies <- c("Ratnam 1974", "Bollapragada 2009",
#              "Yelikar 2015", "Frass 2011",
#              "Noah 1987", "Oboro 2005", "Ayaz 2010", "Papanikolaou 2004",
#              "Buser 1997", "Chua 1997", "Lyndrup 1991", "Misra 1994", "Azubuike 2015",
#              "Mahacakri 2018", "Rahman 2013", "Deshmukh 2013", "Somirathne 2017",
#              "Spellacy 1973")
temp <- add.continuity(out.df)
out.df <- temp$df
ncont <- temp$ncont
}
if (outcome=="mat") {
drop.df[nrow(drop.df)+1,] <- c("Berkane 2005", "Not connected to network")
out.df <- out.df[!(out.df$studyID %in% drop.df$studyID),]
# Add continuity correction
temp <- add.continuity(out.df)
out.df <- temp$df
ncont <- temp$ncont
}
if (outcome=="inst") {
# studies <- c("Somirathne 2017", "Jozwiak 2014") # Not 1:1 randomisation
# studies <- c(studies, "Mahacakri 2018", "Souza 2013") # Limited evidence for these trt comparisons
# studies <- c(studies, c("Dulger 2018", "Wingerup 1978", "McLaren 1987", "Kulshreshtha 2007",
#                         "Madaan 2014", "Balci 2011", "Ezechukwu 2015", "Zeteroglu 2006a"))
# Add continuity correction
#out.df <- add.continuity(out.df, studyID = studies)
# temp <- add.continuity(out.df)
# out.df <- temp$df
# ncont <- temp$ncont
}
if (outcome=="nicu") {
# NECESSARY FOR RUNNING UME MODEL ONLY
#temp <- add.continuity(out.df)
#out.df <- temp$df
#ncont <- temp$ncont
}
if (outcome=="epi") {
drop.df[nrow(drop.df)+1,] <- c("Craft 1971", "All r and N are same for all arms")
drop.df[nrow(drop.df)+1,] <- c("Saleh 1975", "All r and N are same for all arms")
out.df <- out.df[!(out.df$studyID %in% drop.df$studyID),]
}
#### SELECT SUBGOUP ####
if (!is.null(cervix)) {
out.df <- out.df[out.df$cervix==cervix,]
}
# Recode treatments sequentially for those included for this outcome
recoded <- recode.trts(out.df)
out.df <- recoded$df
trtnames <- recoded$trtnames
# Sort data
out.df <- arrange(out.df, desc(Narms), trt)
#out.df <- arrange(out.df, trt, desc(Narms))
out.df$study.index <- as.numeric(factor(out.df$studyID, levels=unique(out.df$studyID)))
out.df <- arrange(out.df, study.index, arm)
# Extract list of data ready for WinBUGS
bugsdat <- getbugsdata(out.df)
###### Check bugsdat ########
bugsdat <- check.bugsdat(bugsdat)
# Select difficult studies
droplist <- list(
"novd"=vector(),
"hyper"=vector(),
"cs"=c(),
"neo"=vector(),
"mat"=vector(),
# Drop comparisons with zero responders in baseline - doesn't help convergence
#"inst"=c("Dulger 2018", "Fletcher 1994", "McLaren 1987", "Mahacakri 2018", "Balci 2011"),
"inst"=c("Silva-Cruz 1988" # Removed due to inclusion criteria (Edna)
#"Chyu 1997", "Wieland 1999"
#"Chyu 1997", "Prasad 1989", "MacLennan 1989", "Khatib 2019", "Shechter-Maor 2015", "Suffecool 2014", # Very heterogeneus
#"Jozwiak 2014"
),
# Drop comparisons with zero responders in baseline
"nicu"=c(
#"Sheela 2007", "Sheikher 2009", "Khoury 2001",
#"Balci 2010", "Meydanli 2003", "Zeteroglu 2006b", "Feitosa 2006", # Drop comparisons with equal r and N in both arms
#"Bartusevicius 2006", "Savithri 2018", "Krithika 2008", "Chitrakar 2012",
#"Shetty 2004", "Elhassan 2004", "Beigi 2003"
),
"epi"=vector()
)
# Drop difficult studies
bugsdat <- drop.bugs(bugsdat, drops=droplist[[outcome]])
# Reorder (if necessary)
# order <- order(bugsdat$t[,1])
# bugsdat$studyID <- bugsdat$studyID[order]
# bugsdat$na <- bugsdat$na[order]
# bugsdat$r <- bugsdat$r[order,]
# bugsdat$n <- bugsdat$n[order,]
# bugsdat$t <- bugsdat$t[order,]
# Create study indentifier variable
inclstudyID <- bugsdat$studyID
###### Plot network to check connectivity ######
mtc <- out.df %>% rename(
study=studyID,
treatment=trt,
responders=r,
sampleSize=N
)
mtc <- mtc.network(mtc)
plot(mtc)
# Plot with sized vertices
ntotal <- vector()
for (i in 1:bugsdat$nt) {
ntotal <- append(ntotal, sum(bugsdat$n[bugsdat$t==i], na.rm=TRUE))
}
ntotal <- ntotal[order(as.character(1:bugsdat$nt))]
loc <- radian.rescale(1:bugsdat$nt, start=0, direction=-1)#[order(as.character(1:bugsdat$nt))]
scale <- 200 # novd
plot(mtc, vertex.size=ntotal/scale, vertex.label.dist=3, vertex.label.degree=loc)
run.nma(bugsdat, outcome = outcome, n.iter=300000, n.burnin=50000,
save=FALSE, ume=FALSE, TE="fixed", outresults = FALSE)
library(xlsx)
# For BUGS object
#sum.mat <- result.ume.fe$summary
# For Excel object
sum.df <- read.xlsx2("~/NICE TSU/IoL/WinBUGSFiles/BUGSsummary.xlsx", sheetName = outcome)
nodes <- sum.df$X.node
sum.df$X.node <- NULL
sum.df <- apply(sum.df, MARGIN=2, function(x) {as.numeric(as.character(x))})
#sum.mat <- sum.df[,c(2,3,5,5,6,7,7,8,9)]
sum.mat <- sum.df[,c(1,2,4,4,5,6,6,7,8)]
rownames(sum.mat) <- nodes
###### Output Coda d's #######
labs <- vector()
nt <- max(bugsdat$t, na.rm=TRUE)
for (i in 2:nt) {
labs <- append(labs, paste0("d[", i, "]"))
}
# From BUGS object
#coda.d <- result$sims.list$d
#colnames(coda.d) <- labs
# From Txt files
file <- paste0("~/NICE TSU/IoL/ResultExcel/", outcome, ".ind.txt")
index <- read.table(file)
coda.d <- list()
for (i in 1:4) {
file <- paste0("~/NICE TSU/IoL/ResultExcel/", outcome, ".out.", i, ".txt")
coda.long <- read.table(file)
for (k in seq_along(index[,1])) {
temp.d <- coda.long[index[,2][k]:index[,3][k],
2]
coda.d[[as.character(index[,1][k])]] <- append(coda.d[[as.character(index[,1][k])]],
temp.d)
}
}
coda.d <- as.data.frame(coda.d)
colnames(coda.d) <- labs
# Save results to Excel
#pd <- result$pD
#pd <- 231.826 # novd
#pd <- 629.275 # cs
#pd <- 457.041 # cs_unfav
pd <- 196.927 # nicu
#dic <- result$DIC
#dic <- 1742.580 # novd
#dic <- 5433.210 # cs
#dic <- 4100.300 # cs_unfav
dic <- 1797.080 # nicu
output.excel(sum.mat=sum.mat, coda.d=coda.d,
dic=dic, pd=pd,
outcome=outcome)
trtnames
sum.mat
or.mat <- sum.mat[grepl("^or", rownames(sum.mat)),]
neat <- neat.cri(or.mat)
mat <- matrix(ncol=nt, nrow=nt)
row <- 1
for (i in 1:(nt-1)) {
for (k in (i+1):nt) {
mat[i,k] <- neat[row]
row <- row+1
}
}
or.mat <- t(mat)
colnames(or.mat) <- trtnames
rownames(or.mat) <- trtnames
d.mat <- sum.mat[grepl("^d\\[", rownames(sum.mat)),]
neat <- neat.cri(d.mat)
rk.mat <- sum.mat[grepl("^rk\\[", rownames(sum.mat)),]
neat.rk <- neat.cri(rk.mat)
# Best
best.mat <- sum.mat[grepl("^best\\[", rownames(sum.mat)),]
neat.best <- round(best.mat[,1], 2)
ranks.df <- data.frame("trtname"=trtnames, "trtcode"=c(1:nt), "rank"=neat.rk, "prob_best"=neat.best)
nt
bugsdat$nt
trtnames
neat.rk
rk.mat <- sum.mat[grepl("^rk\\[", rownames(sum.mat)),]
rk.mat
sum.mat
rownames(sum.mat)
run.nma(bugsdat, outcome = outcome, n.iter=300000, n.burnin=50000,
save=FALSE, ume=FALSE, TE="fixed", outresults = TRUE)
library(xlsx)
# For BUGS object
#sum.mat <- result.ume.fe$summary
# For Excel object
sum.df <- read.xlsx2("~/NICE TSU/IoL/WinBUGSFiles/BUGSsummary.xlsx", sheetName = outcome)
nodes <- sum.df$X.node
sum.df$X.node <- NULL
sum.df <- apply(sum.df, MARGIN=2, function(x) {as.numeric(as.character(x))})
#sum.mat <- sum.df[,c(2,3,5,5,6,7,7,8,9)]
sum.mat <- sum.df[,c(1,2,4,4,5,6,6,7,8)]
rownames(sum.mat) <- nodes
###### Output Coda d's #######
labs <- vector()
nt <- max(bugsdat$t, na.rm=TRUE)
for (i in 2:nt) {
labs <- append(labs, paste0("d[", i, "]"))
}
# From BUGS object
#coda.d <- result$sims.list$d
#colnames(coda.d) <- labs
# From Txt files
file <- paste0("~/NICE TSU/IoL/ResultExcel/", outcome, ".ind.txt")
index <- read.table(file)
coda.d <- list()
for (i in 1:4) {
file <- paste0("~/NICE TSU/IoL/ResultExcel/", outcome, ".out.", i, ".txt")
coda.long <- read.table(file)
for (k in seq_along(index[,1])) {
temp.d <- coda.long[index[,2][k]:index[,3][k],
2]
coda.d[[as.character(index[,1][k])]] <- append(coda.d[[as.character(index[,1][k])]],
temp.d)
}
}
coda.d <- as.data.frame(coda.d)
colnames(coda.d) <- labs
# Save results to Excel
#pd <- result$pD
#pd <- 231.826 # novd
#pd <- 629.275 # cs
#pd <- 457.041 # cs_unfav
pd <- 195.971 # nicu
#dic <- result$DIC
#dic <- 1742.580 # novd
#dic <- 5433.210 # cs
#dic <- 4100.300 # cs_unfav
dic <- 1786.350 # nicu
output.excel(sum.mat=sum.mat, coda.d=coda.d,
dic=dic, pd=pd,
outcome=outcome)
save.excl(outcome=outcome, nnorep = nnorep, ncont=ncont, nzero = nzero,
drop.df=drop.df, ndrops = ndrops)
outindex <- 8
cervix <- NULL
#cervix <- 3 # Select studies with unfavourable cervix
outnames <- c("novd", "hyper", "cs", "neo", "mat", "inst", "nicu", "epi")
excltrt <- c("Herb", "Sex", "MemSweep", "Breast", "CasOil", "Acu", "Homeo", "HotBath", "Enema")
outcome <- outnames[outindex]
out.df <- get.data(df, outcome=outcome) # Get outcome data from overall data (and print network)
#out.df <- drop.hta(out.df, outcome=outcome) # Drop previously dropped studies from HTA report
if (outcome %in% c("novd", "cs", "nicu")) {
out.df <- change.ref(out.df, ref="vPGE2_tab", outcome=outcome)
}
temp <- drop.excltrt(out.df, excltrt=excltrt) # Drop treatments that are excluded from the analysis
out.df <- temp$df
ndrops <- temp$ndrops
# Drop studies post-2015
# out.df <- out.df[grepl("2015", out.df$studyID)==FALSE,]
# out.df <- out.df[grepl("2016", out.df$studyID)==FALSE,]
# out.df <- out.df[grepl("2017", out.df$studyID)==FALSE,]
# out.df <- out.df[grepl("2018", out.df$studyID)==FALSE,]
# Record numbers and reasons for study exclusions
nnorep <- length(df[[paste0("r1.", outcome)]][is.na(df[[paste0("r1.", outcome)]])])
drop.df <- data.frame("studyID"=NA, "ExclReason"=NA)[-0,]
ncont <- 0
temp <- drop.zeros(out.df)
out.df <- temp$df
nzero <- temp$nzero
# Drop studies prior to recoding
if (outcome=="novd") {
drop.df[nrow(drop.df)+1,] <- c("Frass 2011", "Dropping since r and N are same for NoTrT and it is only study with NoTrt")
out.df <- out.df[!(out.df$studyID %in% drop.df$studyID),]
}
if (outcome=="hyper") {
studies <- c("Sharma 2005", "Chanrachakul 2000a", "Chanrachakul 2002",  "Soliman 2013",
"Wing 2000a", "Johnson 1985", "Chua 1997", "Cromi 2012", "Pennell 2009")
# Add continuity correction for UME model (1:1 ratio)
studies <- append(studies, c("Thiery 1984", "Srisomboon 1996", "Curet 1989",
"Shetty 2004", "Perryman 1992", "Rowlands 2001", "Orhue 1995",
"Rouzi 2017"))
# Add continuity correction for UME model (not 1:1 ratio)
studies <- append(studies, c("Witter 1992", "Witter 1996", "Gelisen 2005",
"Cromi 2011",
"Wing 2004"))
# Add continuity correction for UME model (not 1:1 ratio)
studies <- append(studies, c("Graves 1985", "Rayburn 1992"))
temp <- add.continuity(out.df, studyID = studies)
out.df <- temp$df
ncont <- temp$ncont
}
if (outcome=="cs") {
drop.df[nrow(drop.df)+1,] <- c("Frass 2011", "Removed due to automatic CS after 24 hours")
drop.df[nrow(drop.df)+1,] <- c("Gelisen 2005", "Removed due to automatic CS after 24 hours")
drop.df[nrow(drop.df)+1,] <- c("Atad 1996", "Removed due to quality of trial")
out.df <- out.df[!(out.df$studyID %in% drop.df$studyID),]
studies <- c("Naismith 1973", "Spellacy 1973", "Iskander 1978")
temp <- add.continuity(out.df, studyID = studies)
out.df <- temp$df
ncont <- temp$ncont
}
if (outcome=="neo") {
drop.df[nrow(drop.df)+1,] <- c("Rouzi 2014", "Dropping since r and N are same for NoTrT and it is only study with NoTrt")
out.df <- out.df[!(out.df$studyID %in% drop.df$studyID),]
# # Only continuity correction for studies with close to 1:1 randomisation
# studies <- c("Ratnam 1974", "Bollapragada 2009",
#              "Yelikar 2015", "Frass 2011",
#              "Noah 1987", "Oboro 2005", "Ayaz 2010", "Papanikolaou 2004",
#              "Buser 1997", "Chua 1997", "Lyndrup 1991", "Misra 1994", "Azubuike 2015",
#              "Mahacakri 2018", "Rahman 2013", "Deshmukh 2013", "Somirathne 2017",
#              "Spellacy 1973")
temp <- add.continuity(out.df)
out.df <- temp$df
ncont <- temp$ncont
}
if (outcome=="mat") {
drop.df[nrow(drop.df)+1,] <- c("Berkane 2005", "Not connected to network")
out.df <- out.df[!(out.df$studyID %in% drop.df$studyID),]
# Add continuity correction
temp <- add.continuity(out.df)
out.df <- temp$df
ncont <- temp$ncont
}
if (outcome=="inst") {
# studies <- c("Somirathne 2017", "Jozwiak 2014") # Not 1:1 randomisation
# studies <- c(studies, "Mahacakri 2018", "Souza 2013") # Limited evidence for these trt comparisons
# studies <- c(studies, c("Dulger 2018", "Wingerup 1978", "McLaren 1987", "Kulshreshtha 2007",
#                         "Madaan 2014", "Balci 2011", "Ezechukwu 2015", "Zeteroglu 2006a"))
# Add continuity correction
#out.df <- add.continuity(out.df, studyID = studies)
# temp <- add.continuity(out.df)
# out.df <- temp$df
# ncont <- temp$ncont
}
if (outcome=="nicu") {
# NECESSARY FOR RUNNING UME MODEL ONLY
#temp <- add.continuity(out.df)
#out.df <- temp$df
#ncont <- temp$ncont
}
if (outcome=="epi") {
drop.df[nrow(drop.df)+1,] <- c("Craft 1971", "All r and N are same for all arms")
drop.df[nrow(drop.df)+1,] <- c("Saleh 1975", "All r and N are same for all arms")
out.df <- out.df[!(out.df$studyID %in% drop.df$studyID),]
}
#### SELECT SUBGOUP ####
if (!is.null(cervix)) {
out.df <- out.df[out.df$cervix==cervix,]
}
# Recode treatments sequentially for those included for this outcome
recoded <- recode.trts(out.df)
out.df <- recoded$df
trtnames <- recoded$trtnames
# Sort data
out.df <- arrange(out.df, desc(Narms), trt)
#out.df <- arrange(out.df, trt, desc(Narms))
out.df$study.index <- as.numeric(factor(out.df$studyID, levels=unique(out.df$studyID)))
out.df <- arrange(out.df, study.index, arm)
# Extract list of data ready for WinBUGS
bugsdat <- getbugsdata(out.df)
###### Check bugsdat ########
bugsdat <- check.bugsdat(bugsdat)
# Select difficult studies
droplist <- list(
"novd"=vector(),
"hyper"=vector(),
"cs"=c(),
"neo"=vector(),
"mat"=vector(),
# Drop comparisons with zero responders in baseline - doesn't help convergence
#"inst"=c("Dulger 2018", "Fletcher 1994", "McLaren 1987", "Mahacakri 2018", "Balci 2011"),
"inst"=c("Silva-Cruz 1988" # Removed due to inclusion criteria (Edna)
#"Chyu 1997", "Wieland 1999"
#"Chyu 1997", "Prasad 1989", "MacLennan 1989", "Khatib 2019", "Shechter-Maor 2015", "Suffecool 2014", # Very heterogeneus
#"Jozwiak 2014"
),
# Drop comparisons with zero responders in baseline
"nicu"=c(
#"Sheela 2007", "Sheikher 2009", "Khoury 2001",
#"Balci 2010", "Meydanli 2003", "Zeteroglu 2006b", "Feitosa 2006", # Drop comparisons with equal r and N in both arms
#"Bartusevicius 2006", "Savithri 2018", "Krithika 2008", "Chitrakar 2012",
#"Shetty 2004", "Elhassan 2004", "Beigi 2003"
),
"epi"=vector()
)
# Drop difficult studies
bugsdat <- drop.bugs(bugsdat, drops=droplist[[outcome]])
# Reorder (if necessary)
# order <- order(bugsdat$t[,1])
# bugsdat$studyID <- bugsdat$studyID[order]
# bugsdat$na <- bugsdat$na[order]
# bugsdat$r <- bugsdat$r[order,]
# bugsdat$n <- bugsdat$n[order,]
# bugsdat$t <- bugsdat$t[order,]
# Create study indentifier variable
inclstudyID <- bugsdat$studyID
###### Plot network to check connectivity ######
mtc <- out.df %>% rename(
study=studyID,
treatment=trt,
responders=r,
sampleSize=N
)
mtc <- mtc.network(mtc)
plot(mtc)
# Plot with sized vertices
ntotal <- vector()
for (i in 1:bugsdat$nt) {
ntotal <- append(ntotal, sum(bugsdat$n[bugsdat$t==i], na.rm=TRUE))
}
ntotal <- ntotal[order(as.character(1:bugsdat$nt))]
loc <- radian.rescale(1:bugsdat$nt, start=0, direction=-1)#[order(as.character(1:bugsdat$nt))]
scale <- 200 # novd
plot(mtc, vertex.size=ntotal/scale, vertex.label.dist=3, vertex.label.degree=loc)
run.nma(bugsdat, outcome = outcome, n.iter=300000, n.burnin=50000,
save=FALSE, ume=FALSE, TE="random", outresults = TRUE)
