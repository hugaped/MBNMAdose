<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MBNMAdose for dose-response Model-Based Network Meta-Analysis • MBNMAdose</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="MBNMAdose for dose-response Model-Based Network Meta-Analysis">
<meta property="og:description" content="MBNMAdose">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">MBNMAdose</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.4.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/mbnmadose.html">MBNMAdose for dose-response Model-Based Network Meta-Analysis</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="mbnmadose_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>MBNMAdose for dose-response Model-Based Network Meta-Analysis</h1>
                        <h4 data-toc-skip class="author">Hugo Pedder</h4>
            
            <h4 data-toc-skip class="date">2022-03-16</h4>
      
      
      <div class="hidden name"><code>mbnmadose.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This vignette demonstrates how to use <code>MBNMAdose</code> to perform Model-Based Network Meta-Analysis (MBNMA) of studies with multiple doses of different agents by accounting for the dose-response relationship. This can connect disconnected networks via the dose-response relationship and the placebo response, improve precision of estimated effects and allow interpolation/extrapolation of predicted response based on the dose-response relationship.</p>
<p>Modelling the dose-response relationship also avoids the “lumping” of different doses of an agent which is often done in Network Meta-Analysis (NMA) and can introduce additional heterogeneity or inconsistency. All models and analyses are implemented in a Bayesian framework, following an extension of the standard NMA methodology presented by <span class="citation">(Lu and Ades 2004)</span> and are run in JAGS <em>(version 4.3.0 or later is required)</em> <span class="citation">(JAGS Computer Program 2017)</span>. For full details of dose-response MBNMA methodology see Mawdsley et al. <span class="citation">(2016)</span>. Throughout this vignette we refer to a <strong>treatment</strong> as a specific <strong>dose</strong> or a specific <strong>agent</strong></p>
<p>This package has been developed alongside <code>MBNMAtime</code>, a package that allows users to perform time-course MBNMA to incorporate multiple time points within different studies. However, <em>they should not be loaded into R at the same time</em> as there are a number of functions with shared names that perform similar tasks yet are specific to dealing with either time-course <em>or</em> dose-response data.</p>
<div class="section level3">
<h3 id="workflow-within-the-package">Workflow within the package<a class="anchor" aria-label="anchor" href="#workflow-within-the-package"></a>
</h3>
<p>Functions within <code>MBNMAdose</code> follow a clear pattern of use:</p>
<ol style="list-style-type: decimal">
<li>Load your data into the correct format using <code><a href="../reference/mbnma.network.html">mbnma.network()</a></code>
</li>
<li>Analyse your data using <code><a href="../reference/mbnma.run.html">mbnma.run()</a></code>, or any of the available wrapper dose-response functions</li>
<li>Test for consistency at the treatment-level using functions like <code><a href="../reference/nma.nodesplit.html">nma.nodesplit()</a></code> and <code><a href="../reference/nma.run.html">nma.run()</a></code>
</li>
<li>Examine model results using forest plots and treatment rankings</li>
<li>Use your model to predict responses using <code><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict()</a></code>
</li>
<li>Calculate relative effects between any doses (even those not in the original dataset) using <code><a href="../reference/get.relative.html">get.relative()</a></code>
</li>
</ol>
<p>At each of these stages there are a number of informative plots that can be generated to help understand the data and to make decisions regarding model fitting.</p>
</div>
</div>
<div class="section level2">
<h2 id="datasets-included-in-the-package">Datasets Included in the Package<a class="anchor" aria-label="anchor" href="#datasets-included-in-the-package"></a>
</h2>
<div class="section level3">
<h3 id="triptans-for-migraine-pain-relief">Triptans for migraine pain relief<a class="anchor" aria-label="anchor" href="#triptans-for-migraine-pain-relief"></a>
</h3>
<p><code>triptans</code> is from a systematic review of interventions for pain relief in migraine <span class="citation">(Thorlund et al. 2014)</span>. The outcome is binary, and represents (as aggregate data) the number of participants who were headache-free at 2 hours. Data are from patients who had had at least one migraine attack, who were not lost to follow-up, and who did not violate the trial protocol. The dataset includes 70 Randomised-Controlled Trials (RCTs), comparing 7 triptans with placebo. Doses are standardised as relative to a “common” dose, and in total there are 23 different treatments (combination of dose and agent). <code>triptans</code> is a data frame in long format (one row per arm and study), with the variables <code>studyID</code>, <code>AuthorYear</code>, <code>N</code>, <code>r</code>, <code>dose</code> and <code>agent</code>.</p>
<table class="table">
<thead><tr class="header">
<th align="right">studyID</th>
<th align="left">AuthorYear</th>
<th align="right">n</th>
<th align="right">r</th>
<th align="right">dose</th>
<th align="left">agent</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="left">Tfelt-Hansen P 2006</td>
<td align="right">22</td>
<td align="right">6</td>
<td align="right">0</td>
<td align="left">placebo</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="left">Tfelt-Hansen P 2006</td>
<td align="right">30</td>
<td align="right">14</td>
<td align="right">1</td>
<td align="left">sumatriptan</td>
</tr>
<tr class="odd">
<td align="right">2</td>
<td align="left">Goadsby PJ 2007</td>
<td align="right">467</td>
<td align="right">213</td>
<td align="right">1</td>
<td align="left">almotriptan</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="left">Goadsby PJ 2007</td>
<td align="right">472</td>
<td align="right">229</td>
<td align="right">1</td>
<td align="left">zolmitriptan</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="left">Tuchman M2006</td>
<td align="right">160</td>
<td align="right">15</td>
<td align="right">0</td>
<td align="left">placebo</td>
</tr>
<tr class="even">
<td align="right">3</td>
<td align="left">Tuchman M2006</td>
<td align="right">174</td>
<td align="right">48</td>
<td align="right">1</td>
<td align="left">zolmitriptan</td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="biologics-for-treatment-of-moderate-to-severe-psoriasis">Biologics for treatment of moderate-to-severe psoriasis<a class="anchor" aria-label="anchor" href="#biologics-for-treatment-of-moderate-to-severe-psoriasis"></a>
</h3>
<p>There are 3 psoriasis datasets from a systematic review of RCTs comparing biologics at different doses and placebo <span class="citation">(Warren et al. 2019)</span>. Each dataset contains a different binary outcome, all based on the number of patients experiencing degrees of improvement on the Psoriasis Area and Severity Index (PASI) measured at 12 weeks follow-up. Each dataset contains information on the number of participants who achieved <span class="math inline">\(\geq75\%\)</span> (<code>psoriasis75</code>), <span class="math inline">\(\geq90\%\)</span> (<code>psoriasis90</code>), or <span class="math inline">\(100\%\)</span> (<code>psoriasis100</code>).</p>
</div>
<div class="section level3">
<h3 id="selective-serotonin-reuptake-inhibitors-ssris-for-major-depression">Selective Serotonin Reuptake Inhibitors (SSRIs) for major depression<a class="anchor" aria-label="anchor" href="#selective-serotonin-reuptake-inhibitors-ssris-for-major-depression"></a>
</h3>
<p><code>ssri</code> is from a systematic review examining the efficacy of different doses of SSRI antidepressant drugs and placebo <span class="citation">(Furukawa et al. 2019)</span>. The response to treatment is defined as a 50% reduction in depressive symptoms after 8 weeks (4-12 week range) follow-up. The dataset includes 60 RCTs comparing 5 different SSRIs with placebo.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">kable</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">ssri</span><span class="op">)</span>, digits<span class="op">=</span><span class="fl">2</span><span class="op">)</span> </code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">studyID</th>
<th align="left">bias</th>
<th align="right">age</th>
<th align="right">weeks</th>
<th align="left">agent</th>
<th align="right">dose</th>
<th align="right">n</th>
<th align="right">r</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="left">Moderate risk</td>
<td align="right">43.0</td>
<td align="right">6</td>
<td align="left">placebo</td>
<td align="right">0</td>
<td align="right">149</td>
<td align="right">69</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="left">Moderate risk</td>
<td align="right">42.9</td>
<td align="right">6</td>
<td align="left">fluoxetine</td>
<td align="right">20</td>
<td align="right">137</td>
<td align="right">77</td>
</tr>
<tr class="odd">
<td align="right">2</td>
<td align="left">Low risk</td>
<td align="right">41.2</td>
<td align="right">6</td>
<td align="left">placebo</td>
<td align="right">0</td>
<td align="right">137</td>
<td align="right">63</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="left">Low risk</td>
<td align="right">40.9</td>
<td align="right">6</td>
<td align="left">paroxetine</td>
<td align="right">20</td>
<td align="right">138</td>
<td align="right">74</td>
</tr>
<tr class="odd">
<td align="right">7</td>
<td align="left">Low risk</td>
<td align="right">41.6</td>
<td align="right">6</td>
<td align="left">placebo</td>
<td align="right">0</td>
<td align="right">158</td>
<td align="right">91</td>
</tr>
<tr class="even">
<td align="right">7</td>
<td align="left">Low risk</td>
<td align="right">41.3</td>
<td align="right">6</td>
<td align="left">fluoxetine</td>
<td align="right">20</td>
<td align="right">148</td>
<td align="right">89</td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="interventions-for-serum-uric-acid-sua-reduction-in-gout">Interventions for Serum Uric Acid (SUA) reduction in gout<a class="anchor" aria-label="anchor" href="#interventions-for-serum-uric-acid-sua-reduction-in-gout"></a>
</h3>
<p><code>gout</code> is from a systematic review of interventions for lowering Serum Uric Acid (SUA) concentration in patients with gout <em>[not published previously]</em>. The outcome is continuous, and aggregate data responses correspond to the mean change from baseline in SUA in mg/dL at 2 weeks follow-up. The dataset includes 10 Randomised-Controlled Trials (RCTs), comparing 5 different agents, and placebo. Data for one agent (RDEA) arises from an RCT that is not placebo-controlled, and so is not connected to the network directly. In total there were 19 different treatments (combination of dose and agent). <code>gout</code> is a data frame in long format (one row per arm and study), with the variables <code>studyID</code>, <code>y</code>, <code>se</code>, <code>agent</code> and <code>dose</code>.</p>
<table class="table">
<thead><tr class="header">
<th align="left"></th>
<th align="right">studyID</th>
<th align="right">y</th>
<th align="right">se</th>
<th align="left">agent</th>
<th align="right">dose</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">4</td>
<td align="right">1102</td>
<td align="right">-0.53</td>
<td align="right">0.25</td>
<td align="left">RDEA</td>
<td align="right">100</td>
</tr>
<tr class="even">
<td align="left">5</td>
<td align="right">1102</td>
<td align="right">-1.37</td>
<td align="right">0.18</td>
<td align="left">RDEA</td>
<td align="right">200</td>
</tr>
<tr class="odd">
<td align="left">6</td>
<td align="right">1102</td>
<td align="right">-1.73</td>
<td align="right">0.25</td>
<td align="left">RDEA</td>
<td align="right">400</td>
</tr>
<tr class="even">
<td align="left">53</td>
<td align="right">2001</td>
<td align="right">-6.82</td>
<td align="right">0.06</td>
<td align="left">Febu</td>
<td align="right">240</td>
</tr>
<tr class="odd">
<td align="left">54</td>
<td align="right">2001</td>
<td align="right">0.15</td>
<td align="right">0.04</td>
<td align="left">Plac</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">92</td>
<td align="right">2003</td>
<td align="right">-3.43</td>
<td align="right">0.03</td>
<td align="left">Allo</td>
<td align="right">300</td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="interventions-for-pain-relief-in-osteoarthritis">Interventions for pain relief in osteoarthritis<a class="anchor" aria-label="anchor" href="#interventions-for-pain-relief-in-osteoarthritis"></a>
</h3>
<p><code>osteopain</code> is from a systematic review of interventions for pain relief in osteoarthritis, used previously in Pedder et al. <span class="citation">(2019)</span>. The outcome is continuous, and aggregate data responses correspond to the mean WOMAC pain score at 2 weeks follow-up. The dataset includes 18 Randomised-Controlled Trials (RCTs), comparing 8 different agents with placebo. In total there were 26 different treatments (combination of dose and agent). The active treatments can also be grouped into 3 different classes, within which they have similar mechanisms of action. <code>osteopain_2wkabs</code> is a data frame in long format (one row per arm and study), with the variables <code>studyID</code>, <code>agent</code>, <code>dose</code>, <code>class</code>, <code>y</code>, <code>se</code>, and <code>N</code>.</p>
<table class="table">
<thead><tr class="header">
<th align="left"></th>
<th align="right">studyID</th>
<th align="left">agent</th>
<th align="right">dose</th>
<th align="left">class</th>
<th align="right">y</th>
<th align="right">se</th>
<th align="right">n</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">13</td>
<td align="right">1</td>
<td align="left">Placebo</td>
<td align="right">0</td>
<td align="left">Placebo</td>
<td align="right">6.26</td>
<td align="right">0.23</td>
<td align="right">60</td>
</tr>
<tr class="even">
<td align="left">14</td>
<td align="right">1</td>
<td align="left">Etoricoxib</td>
<td align="right">10</td>
<td align="left">Cox2Inhib</td>
<td align="right">5.08</td>
<td align="right">0.16</td>
<td align="right">114</td>
</tr>
<tr class="odd">
<td align="left">15</td>
<td align="right">1</td>
<td align="left">Etoricoxib</td>
<td align="right">30</td>
<td align="left">Cox2Inhib</td>
<td align="right">4.42</td>
<td align="right">0.17</td>
<td align="right">102</td>
</tr>
<tr class="even">
<td align="left">16</td>
<td align="right">1</td>
<td align="left">Etoricoxib</td>
<td align="right">5</td>
<td align="left">Cox2Inhib</td>
<td align="right">5.34</td>
<td align="right">0.16</td>
<td align="right">117</td>
</tr>
<tr class="odd">
<td align="left">17</td>
<td align="right">1</td>
<td align="left">Etoricoxib</td>
<td align="right">60</td>
<td align="left">Cox2Inhib</td>
<td align="right">3.62</td>
<td align="right">0.17</td>
<td align="right">112</td>
</tr>
<tr class="even">
<td align="left">18</td>
<td align="right">1</td>
<td align="left">Etoricoxib</td>
<td align="right">90</td>
<td align="left">Cox2Inhib</td>
<td align="right">4.08</td>
<td align="right">0.17</td>
<td align="right">112</td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="alogliptin-for-lowering-blood-glucose-concentration-in-type-ii-diabetes">Alogliptin for lowering blood glucose concentration in type II diabetes<a class="anchor" aria-label="anchor" href="#alogliptin-for-lowering-blood-glucose-concentration-in-type-ii-diabetes"></a>
</h3>
<p><code>alog_pcfb</code> is from a systematic review of Randomised-Controlled Trials (RCTs) comparing different doses of alogliptin with placebo <span class="citation">(Langford et al. 2016)</span>. The systematic review was simply performed and was intended to provide data to illustrate a statistical methodology rather than for clinical inference. Alogliptin is a treatment aimed at reducing blood glucose concentration in type II diabetes. The outcome is continuous, and aggregate data responses correspond to the mean change in HbA1c from baseline to follow-up in studies of at least 12 weeks follow-up. The dataset includes 14 RCTs, comparing 5 different doses of alogliptin with placebo, leading to 6 different treatments (combination of dose and agent) within the network. <code>alog_pcfb</code> is a data frame in long format (one row per arm and study), with the variables <code>studyID</code>, <code>agent</code>, <code>dose</code>, <code>y</code>, <code>se</code>, and <code>N</code>.</p>
<table class="table">
<thead><tr class="header">
<th align="left">studyID</th>
<th align="left">agent</th>
<th align="right">dose</th>
<th align="right">y</th>
<th align="right">se</th>
<th align="right">n</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">NCT01263470</td>
<td align="left">alogliptin</td>
<td align="right">0.00</td>
<td align="right">0.06</td>
<td align="right">0.05</td>
<td align="right">75</td>
</tr>
<tr class="even">
<td align="left">NCT01263470</td>
<td align="left">alogliptin</td>
<td align="right">6.25</td>
<td align="right">-0.51</td>
<td align="right">0.08</td>
<td align="right">79</td>
</tr>
<tr class="odd">
<td align="left">NCT01263470</td>
<td align="left">alogliptin</td>
<td align="right">12.50</td>
<td align="right">-0.70</td>
<td align="right">0.06</td>
<td align="right">84</td>
</tr>
<tr class="even">
<td align="left">NCT01263470</td>
<td align="left">alogliptin</td>
<td align="right">25.00</td>
<td align="right">-0.76</td>
<td align="right">0.06</td>
<td align="right">79</td>
</tr>
<tr class="odd">
<td align="left">NCT01263470</td>
<td align="left">alogliptin</td>
<td align="right">50.00</td>
<td align="right">-0.82</td>
<td align="right">0.05</td>
<td align="right">79</td>
</tr>
<tr class="even">
<td align="left">NCT00286455</td>
<td align="left">alogliptin</td>
<td align="right">0.00</td>
<td align="right">-0.13</td>
<td align="right">0.08</td>
<td align="right">63</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section level2">
<h2 id="inspecting-the-data">Inspecting the data<a class="anchor" aria-label="anchor" href="#inspecting-the-data"></a>
</h2>
<p>Before embarking on an analysis, the first step is to have a look at the raw data. Two features (network connectivity and dose-response relationship) are particularly important for MBNMA. For this we want to get our dataset into the right format for the package. We can do this using <code><a href="../reference/mbnma.network.html">mbnma.network()</a></code>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Using the triptans dataset</span>
<span class="va">network</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mbnma.network.html">mbnma.network</a></span><span class="op">(</span><span class="va">triptans</span><span class="op">)</span>
<span class="co">#&gt; Values for `agent` with dose = 0 have been recoded to `Placebo`</span>
<span class="co">#&gt; agent is being recoded to enforce sequential numbering and allow inclusion of `Placebo`</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">network</span><span class="op">)</span>
<span class="co">#&gt; <span style="font-weight: bold; text-decoration: underline;">Description: Network </span></span>
<span class="co"><span style="font-weight: bold; text-decoration: underline;">#&gt; </span>Number of studies: 70 </span>
<span class="co">#&gt; Number of treatments: 23 </span>
<span class="co">#&gt; Number of agents: 8 </span>
<span class="co">#&gt; Median (min, max) doses per agent (incl placebo): 4 (3, 6)</span>
<span class="co">#&gt; Agent-level network is <span style="color: #00BB00; font-weight: bold;">CONNECTED</span><span style="font-weight: bold;"> </span></span>
<span class="co"><span style="font-weight: bold;">#&gt; </span></span>
<span class="co">#&gt; Ttreatment-level network is <span style="color: #00BB00; font-weight: bold;">CONNECTED</span><span style="font-weight: bold;"> </span></span>
<span class="co"><span style="font-weight: bold;">#&gt; </span></span></code></pre></div>
<p>This function takes a dataset with the columns:</p>
<ul>
<li>
<code>studyID</code> Study identifiers</li>
<li>
<code>agent</code> Agent identifiers (can be character, factor or numeric)</li>
<li>
<code>dose</code> Numeric data indicating the dose of the given agent within the study arm</li>
<li>
<code>class</code> An optional column indicating a particular class code. Agents with the same name/identifier must also have the same class code.</li>
</ul>
<p>Depending on the type of data (and the likelihood) the following columns are required:</p>
<ul>
<li>Normal likelihood
<ul>
<li>
<code>y</code> Numeric data indicating the mean response for a given study arm</li>
<li>
<code>se</code> Numeric data indicating the standard error for a given study arm</li>
</ul>
</li>
<li>Binomial likelihood
<ul>
<li>
<code>r</code> Numeric data indicating the number of responders in a given study arm</li>
<li>
<code>n</code> Numeric data indicating the total number of participants in a given study arm</li>
</ul>
</li>
<li>Poisson likelihood
<ul>
<li>
<code>r</code> Numeric data indicating the number of events in a given study arm</li>
<li>
<code>E</code> Numeric data indicating the total exposure time in a given study arm</li>
</ul>
</li>
</ul>
<p>It then performs the following checks on the data:</p>
<ul>
<li>The dataset has the required column names</li>
<li>There are no missing values</li>
<li>All doses are positive</li>
<li>All SE, r, N and E are positive</li>
<li>Class labels are consistent within each agent</li>
<li>Studies have at least two arms</li>
<li>Studies do not only compare the same agent at the same dose</li>
</ul>
<p>Finally it converts the data frame into an object of <code>class("mbnma.network")</code>, which contains indices for study arms, numeric variables for treatments, agents and classes, and stores a vector of treatment, agent and class names as an element within the object. By convention, agents are numbered alphabetically, though if the original data for agents is provided as a factor then the factor codes will be used. This then contains all the necessary information for subsequent <code>MBNMAdose</code> functions.</p>
<div class="section level3">
<h3 id="examining-network-connectivity">Examining network connectivity<a class="anchor" aria-label="anchor" href="#examining-network-connectivity"></a>
</h3>
<p>Examining how the evidence in the network is connected and identifying which studies compare which treatments/agents helps to understand which effects can be estimated, what information will be helping to inform those estimates, and whether linking via the dose-response relationship is possible if the network is disconnected at the treatment-level. The complexity of dose-response relationships that can be estimated is dependent on the number of doses of each agent available, so this is also important to know.</p>
<p>Network plots can be plotted which shows which treatments/agents have been compared in head-to-head trials. Typically the thickness of connecting lines (“edges”) is proportional to the number of studies that make a particular comparison and the size of treatment nodes (“vertices”) is proportional to the total number of patients in the network who were randomised to a given treatment/agent (provided <code>N</code> is included as a variable in the original dataset for <code><a href="../reference/mbnma.network.html">mbnma.network()</a></code>).</p>
<p>In <code>MBNMAdose</code> these plots are generated using <code>igraph</code>, and can be plotted by calling <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code>. The generated plots are objects of <code>class("igraph")</code> meaning that, in addition to the options specified in <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code>, various <code>igraph</code> functions can subsequently be used to make more detailed edits to them.</p>
<p>Within these network plots, vertices are automatically aligned in a circle (as the default) and can be tidied by shifting the label distance away from the nodes.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Prepare data using the triptans dataset</span>
<span class="va">tripnet</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mbnma.network.html">mbnma.network</a></span><span class="op">(</span><span class="va">triptans</span><span class="op">)</span>
<span class="co">#&gt; Values for `agent` with dose = 0 have been recoded to `Placebo`</span>
<span class="co">#&gt; agent is being recoded to enforce sequential numbering and allow inclusion of `Placebo`</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">tripnet</span><span class="op">)</span>
<span class="co">#&gt; <span style="font-weight: bold; text-decoration: underline;">Description: Network </span></span>
<span class="co"><span style="font-weight: bold; text-decoration: underline;">#&gt; </span>Number of studies: 70 </span>
<span class="co">#&gt; Number of treatments: 23 </span>
<span class="co">#&gt; Number of agents: 8 </span>
<span class="co">#&gt; Median (min, max) doses per agent (incl placebo): 4 (3, 6)</span>
<span class="co">#&gt; Agent-level network is <span style="color: #00BB00; font-weight: bold;">CONNECTED</span><span style="font-weight: bold;"> </span></span>
<span class="co"><span style="font-weight: bold;">#&gt; </span></span>
<span class="co">#&gt; Ttreatment-level network is <span style="color: #00BB00; font-weight: bold;">CONNECTED</span><span style="font-weight: bold;"> </span></span>
<span class="co"><span style="font-weight: bold;">#&gt; </span></span>

<span class="co"># Draw network plot</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">tripnet</span><span class="op">)</span></code></pre></div>
<p><img src="mbnmadose_files/figure-html/unnamed-chunk-7-1.png" width="672"></p>
<p>If some vertices are not connected to the network reference treatment through any pathway of head-to-head evidence, a warning will be given. The nodes that are coloured white represent these disconnected vertices.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Prepare data using the gout dataset</span>
<span class="va">goutnet</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mbnma.network.html">mbnma.network</a></span><span class="op">(</span><span class="va">gout</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">goutnet</span><span class="op">)</span>
<span class="co">#&gt; <span style="font-weight: bold; text-decoration: underline;">Description: Network </span></span>
<span class="co"><span style="font-weight: bold; text-decoration: underline;">#&gt; </span>Number of studies: 10 </span>
<span class="co">#&gt; Number of treatments: 19 </span>
<span class="co">#&gt; Number of agents: 6 </span>
<span class="co">#&gt; Median (min, max) doses per agent (incl placebo): 5 (3, 6)</span>
<span class="co">#&gt; Agent-level network is <span style="color: #BB0000; font-weight: bold;">DISCONNECTED</span><span style="font-weight: bold;"> </span></span>
<span class="co"><span style="font-weight: bold;">#&gt; </span></span>
<span class="co">#&gt; Treatment-level network is <span style="color: #BB0000; font-weight: bold;">DISCONNECTED</span><span style="font-weight: bold;"> </span></span>
<span class="co"><span style="font-weight: bold;">#&gt; </span></span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">goutnet</span>, label.distance <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>
<span class="co">#&gt; Warning in check.network(g): The following treatments/agents are not connected</span>
<span class="co">#&gt; to the network reference:</span>
<span class="co">#&gt; Allo_245</span>
<span class="co">#&gt; Allo_256</span>
<span class="co">#&gt; Allo_300</span>
<span class="co">#&gt; Allo_400</span>
<span class="co">#&gt; Benz_50</span>
<span class="co">#&gt; Benz_139</span>
<span class="co">#&gt; Benz_143</span>
<span class="co">#&gt; Benz_200</span>
<span class="co">#&gt; Febu_40</span>
<span class="co">#&gt; Febu_80</span>
<span class="co">#&gt; Febu_120</span>
<span class="co">#&gt; RDEA_100</span>
<span class="co">#&gt; RDEA_200</span>
<span class="co">#&gt; RDEA_400</span></code></pre></div>
<p><img src="mbnmadose_files/figure-html/unnamed-chunk-9-1.png" width="672"></p>
<p>However, whilst at the treatment-level (specific dose of a specific agent), many of these vertices are disconnected, at the agent level they are connected (via different doses of the same agent), meaning that <em>via the dose-response relationship</em> it is possible to estimate results.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Plot at the agent-level</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">goutnet</span>, level<span class="op">=</span><span class="st">"agent"</span>, label.distance <span class="op">=</span> <span class="fl">6</span><span class="op">)</span>
<span class="co">#&gt; Warning in check.network(g): The following treatments/agents are not connected</span>
<span class="co">#&gt; to the network reference:</span>
<span class="co">#&gt; RDEA</span></code></pre></div>
<p><img src="mbnmadose_files/figure-html/unnamed-chunk-10-1.png" width="672"></p>
<p>One agent (RDEA) is still not connected to the network, but <code>MBNMAdose</code> allows agents to connect via a placebo response <em>even if they do not include placebo in a head-to-head trial</em> (see [Linking disconnected treatments via the dose-response relationship]).</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Plot connections to placebo via a two-parameter dose-response function (e.g. Emax)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">goutnet</span>, level<span class="op">=</span><span class="st">"agent"</span>, doselink <span class="op">=</span> <span class="fl">2</span>, remove.loops <span class="op">=</span> <span class="cn">TRUE</span>, label.distance <span class="op">=</span> <span class="fl">6</span><span class="op">)</span>
<span class="co">#&gt; Dose-response connections to placebo plotted based on a dose-response</span>
<span class="co">#&gt;                    function with 1 degrees of freedom</span></code></pre></div>
<p><img src="mbnmadose_files/figure-html/unnamed-chunk-11-1.png" width="672"></p>
<p>It is also possible to plot a network at the treatment level but to colour the doses by the agent that they belong to.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Colour vertices by agent</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">goutnet</span>, v.color <span class="op">=</span> <span class="st">"agent"</span>, label.distance <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>
<span class="co">#&gt; Warning in check.network(g): The following treatments/agents are not connected</span>
<span class="co">#&gt; to the network reference:</span>
<span class="co">#&gt; Allo_245</span>
<span class="co">#&gt; Allo_256</span>
<span class="co">#&gt; Allo_300</span>
<span class="co">#&gt; Allo_400</span>
<span class="co">#&gt; Benz_50</span>
<span class="co">#&gt; Benz_139</span>
<span class="co">#&gt; Benz_143</span>
<span class="co">#&gt; Benz_200</span>
<span class="co">#&gt; Febu_40</span>
<span class="co">#&gt; Febu_80</span>
<span class="co">#&gt; Febu_120</span>
<span class="co">#&gt; RDEA_100</span>
<span class="co">#&gt; RDEA_200</span>
<span class="co">#&gt; RDEA_400</span></code></pre></div>
<p><img src="mbnmadose_files/figure-html/unnamed-chunk-12-1.png" width="672"></p>
<p>Several further options exist to allow for inclusion of disconnected treatments, such as assuming some sort of common effect among agents within the same class. This is discussed in more detail later in the vignette.</p>
</div>
<div class="section level3">
<h3 id="examining-the-dose-response-relationship">Examining the dose-response relationship<a class="anchor" aria-label="anchor" href="#examining-the-dose-response-relationship"></a>
</h3>
<p>In order to consider which functional forms may be appropriate for modelling the dose-response relationship, it is useful to look at results from a “split” network meta-analysis (NMA), in which each dose of an agent is considered as separate and unrelated (i.e. we are not assuming any dose-response relationship). The <code><a href="../reference/nma.run.html">nma.run()</a></code> function performs a simple NMA, and by default it drops studies that are disconnected at the treatment-level (since estimates for these will be very uncertain if included).</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Run a random effect split NMA using the alogliptin dataset</span>
<span class="va">alognet</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mbnma.network.html">mbnma.network</a></span><span class="op">(</span><span class="va">alog_pcfb</span><span class="op">)</span>
<span class="va">nma.alog</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nma.run.html">nma.run</a></span><span class="op">(</span><span class="va">alognet</span>, method<span class="op">=</span><span class="st">"random"</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">nma.alog</span><span class="op">)</span>
<span class="co">#&gt; $jagsresult</span>
<span class="co">#&gt; Inference for Bugs model at "/tmp/Rtmp6v0Osl/file43d622e1ee0f", fit using jags,</span>
<span class="co">#&gt;  3 chains, each with 20000 iterations (first 10000 discarded), n.thin = 10</span>
<span class="co">#&gt;  n.sims = 3000 iterations saved</span>
<span class="co">#&gt;            mu.vect sd.vect     2.5%      25%      50%      75%    97.5%  Rhat</span>
<span class="co">#&gt; d[1]         0.000   0.000    0.000    0.000    0.000    0.000    0.000 1.000</span>
<span class="co">#&gt; d[2]        -0.455   0.091   -0.638   -0.515   -0.454   -0.394   -0.273 1.001</span>
<span class="co">#&gt; d[3]        -0.654   0.046   -0.744   -0.683   -0.655   -0.626   -0.563 1.002</span>
<span class="co">#&gt; d[4]        -0.709   0.046   -0.799   -0.740   -0.710   -0.680   -0.614 1.001</span>
<span class="co">#&gt; d[5]        -0.758   0.087   -0.922   -0.816   -0.760   -0.701   -0.579 1.002</span>
<span class="co">#&gt; d[6]        -0.677   0.167   -1.003   -0.788   -0.675   -0.567   -0.343 1.001</span>
<span class="co">#&gt; sd           0.123   0.028    0.075    0.104    0.120    0.140    0.182 1.001</span>
<span class="co">#&gt; totresdev   46.819   9.885   29.257   39.720   46.135   53.227   68.483 1.001</span>
<span class="co">#&gt; deviance  -124.495   9.885 -142.057 -131.594 -125.179 -118.087 -102.831 1.002</span>
<span class="co">#&gt;           n.eff</span>
<span class="co">#&gt; d[1]          1</span>
<span class="co">#&gt; d[2]       3000</span>
<span class="co">#&gt; d[3]       1700</span>
<span class="co">#&gt; d[4]       3000</span>
<span class="co">#&gt; d[5]       1700</span>
<span class="co">#&gt; d[6]       2800</span>
<span class="co">#&gt; sd         3000</span>
<span class="co">#&gt; totresdev  3000</span>
<span class="co">#&gt; deviance   3000</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; For each parameter, n.eff is a crude measure of effective sample size,</span>
<span class="co">#&gt; and Rhat is the potential scale reduction factor (at convergence, Rhat=1).</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; DIC info (using the rule, pD = var(deviance)/2)</span>
<span class="co">#&gt; pD = 36.6 and DIC = -88.6</span>
<span class="co">#&gt; DIC is an estimate of expected predictive error (lower deviance is better).</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $trt.labs</span>
<span class="co">#&gt; [1] "Placebo_0"       "alogliptin_6.25" "alogliptin_12.5" "alogliptin_25"  </span>
<span class="co">#&gt; [5] "alogliptin_50"   "alogliptin_100" </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $UME</span>
<span class="co">#&gt; [1] FALSE</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; attr(,"class")</span>
<span class="co">#&gt; [1] "nma"</span>

<span class="co"># Draw plot of NMA estimates plotted by dose</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">nma.alog</span><span class="op">)</span></code></pre></div>
<p><img src="mbnmadose_files/figure-html/unnamed-chunk-14-1.png" width="672"></p>
<p>In the alogliptin dataset there appears to be a dose-response relationship, and it also appears to be non-linear.</p>
<p>One additional use of <code><a href="../reference/nma.run.html">nma.run()</a></code> is that is can be used after fitting an MBNMA to ensure that fitting a dose-response function is not leading to poorer model fit than when conducting a conventional NMA. Comparing the total residual deviance between NMA and MBNMA models is useful to identify if introducing a dose-response relationship is leading to poorer model fit. However, it is important to note that if treatments are disconnected in the NMA and have been dropped (<code>drop.discon=TRUE</code>), there will be fewer observations present in the dataset, which will subsequently lead to lower pD and lower residual deviance, meaning that model fit statistics from NMA and MBNMA may not be directly comparable.</p>
</div>
</div>
<div class="section level2">
<h2 id="analysis-using-mbnma-run">Analysis using <code>mbnma.run()</code><a class="anchor" aria-label="anchor" href="#analysis-using-mbnma-run"></a>
</h2>
<p>MBNMA is performed in <code>MBNMAdose</code> by applying <code><a href="../reference/mbnma.run.html">mbnma.run()</a></code>. A <code>"mbnma.network"</code> object must be provided as the data for <code><a href="../reference/mbnma.run.html">mbnma.run()</a></code>. The key arguments within <code><a href="../reference/mbnma.run.html">mbnma.run()</a></code> involve specifying the functional form used to model the dose-response, and the dose-response parameters that comprise that functional form.</p>
<div class="section level4">
<h4 id="dose-response-functions">Dose-response functions<a class="anchor" aria-label="anchor" href="#dose-response-functions"></a>
</h4>
<p>Various functional forms are implemented within <code>MBNMAdose</code>, that allow a variety of parameterizations and dose-response shapes. These are provided as an object of class <code>"dosefun"</code> to the <code>fun</code> argument in <code><a href="../reference/mbnma.run.html">mbnma.run()</a></code>. The interpretation of the dose-response parameter estimates will therefore depend on the dose-response function used. In previous versions of <code>MBNMAdose</code> (prior to version 0.4.0), wrapper functions were provided for each of the commonly used dose-response functions in <code><a href="../reference/mbnma.run.html">mbnma.run()</a></code>. For example, <code><a href="../reference/mbnma.emax.html">mbnma.emax()</a></code> is equivalent to <code>mbnma.run(fun=demax())</code>. This will be deprecated in future versions.</p>
<p>For the following functions <span class="math inline">\(x_{i,k}\)</span> refers to the dose and <span class="math inline">\(t_{i,k}\)</span> to the agent in arm <span class="math inline">\(k\)</span> of study <span class="math inline">\(i\)</span>.</p>
<ul>
<li><p>Log-linear (<code><a href="../reference/dloglin.html">dloglin()</a></code>): <span class="math inline">\(f(x_{i,k}, t_{i,k})=\lambda_{t_{i,k}} \times ln(x_{i,k} + 1)\)</span> where <span class="math inline">\(lambda\)</span> controls the gradient of the dose-response relationship.</p></li>
<li><p>Exponential (<code><a href="../reference/dexp.html">dexp()</a></code>): <span class="math inline">\(f(x_{i,k}, t_{i,k})=Emax_{t_{i,k}} (1 - e^{-x_{i,k}})\)</span> where <span class="math inline">\(Emax\)</span> is the maximum efficacy of an agent.</p></li>
<li><p>Emax (<code><a href="../reference/demax.html">demax()</a></code>): <span class="math inline">\(f(x_{i,k}, t_{i,k})=\dfrac{Emax_{t_{i,k}} \times {x_{i,k}^{\gamma_{t_{i,k}}}}} {ED50_{t_{i,k}}^{\gamma_{t_{i,k}}} + x_{i,k}^{\gamma_{t_{i,k}}}}\)</span> where <span class="math inline">\(Emax\)</span> is the maximum efficacy that can be achieved, <span class="math inline">\(ED50\)</span> is the dose at which 50% of the maximum efficacy is achieved, and <span class="math inline">\(\gamma\)</span> is the Hill parameter that controls the sigmoidal shape of the function. By default, <code><a href="../reference/demax.html">demax()</a></code> fits a 2-parameter Emax function in which <span class="math inline">\(\gamma_{t_{i,k}}=1\)</span> (<code>hill=NULL</code> in function argument).</p></li>
<li><p>Polynomial (e.g. linear) (<code><a href="../reference/dpoly.html">dpoly()</a></code>): <span class="math inline">\(f(x_{i,k}, t_{i,k})=\beta_{1_{t_{i,k}}}x_{i,k}+...+\beta_{p_{t_{i,k}}}x^p_{i,k}\)</span> where <span class="math inline">\(p\)</span> is the degree of the polynomial (e.g. 1 for linear) and <span class="math inline">\(\beta_p\)</span> are the coefficients</p></li>
<li><p>Fractional polynomial (<code><a href="../reference/dfpoly.html">dfpoly()</a></code>): <span class="math inline">\(f(x_{i,k}, t_{i,k})=\beta_{1_{t_{i,k}}}x_{i,k}^{\gamma_1}+...+\beta_{p_{t_{i,k}}}x^{\gamma_p}_{i,k}\)</span> where <span class="math inline">\(p\)</span> is the degree of the polynomial, <span class="math inline">\(\beta_p\)</span> are the coefficients, and <span class="math inline">\(x_{i,k}^{\gamma_p}\)</span> is a regular power except where <span class="math inline">\(\gamma_p=0\)</span> where <span class="math inline">\({x_{i,k}^{(0)}=ln(x_{i,k})}\)</span>. If a fractional polynomial power <span class="math inline">\({\gamma_p}\)</span> repeats within the function it is multiplied by another <span class="math inline">\({ln(x_{i,k})}\)</span>.</p></li>
<li><p>Spline functions (<code><a href="../reference/dspline.html">dspline()</a></code>): B-splines (<code>type="bs"</code>), natural cubic splines (<code>type="ns"</code>) and piecewise linear splines (<code>type="ls"</code>) can be fitted. <span class="math inline">\(f(x_{i,k}, t_{i,k})=\sum_{p=1}^{P} \beta_{p,t_{i,k}} X_{p,i,k}\)</span> where <span class="math inline">\(\beta_{p,t_{i,k}}\)</span> is the regression coefficient for the <span class="math inline">\(p^{th}\)</span> spline and <span class="math inline">\(X_{1:P,i,k}\)</span> is the basis matrix for the spline, defined by the spline type.</p></li>
<li><p>Non-parametric monotonic function (<code><a href="../reference/dnonparam.html">dnonparam()</a></code>): Follows the approach of Owen et al. <span class="citation">(2015)</span>. The <code>direction</code> can be specified as <code>"increasing"</code> or <code>"decreasing"</code>.</p></li>
<li><p>User-defined function (<code><a href="../reference/duser.html">duser()</a></code>): Any function that can be explicitly defined by the user within (see <a href="#user-defined-dose-response-function">User-defined dose-response function</a>)</p></li>
<li><p>Agent-specific functions (<code><a href="../reference/dmulti.html">dmulti()</a></code>): Allows for a separate dose-response function to be fitted to each agent in the network (see <a href="#agent-specific-dose-response-functions">Agent-specific dose-response functions</a>)</p></li>
</ul>
</div>
<div class="section level4">
<h4 id="dose-response-parameters">Dose-response parameters<a class="anchor" aria-label="anchor" href="#dose-response-parameters"></a>
</h4>
<p>Dose-response parameters can be specified in different ways which affects the key parameters estimated by the model and implies different modelling assumptions. Three different specifications are available for each parameter:</p>
<ul>
<li>
<code>"rel"</code> indicates that relative effects should be pooled for this dose-response parameter separately for each agent in the network. This preserves randomisation within included studies and is likely to vary less between studies (only due to effect modification).</li>
<li>
<code>"common"</code> indicates that a single absolute value for this dose-response parameter should be estimated across the whole network <em>that does not vary by agent</em>. This is particularly useful for parameters expected to be constant (e.g. Hill parameters in <code><a href="../reference/demax.html">demax()</a></code> or fractional polynomial power parameters in <code>fpoly()</code>).</li>
<li>
<code>"random"</code> indicates that a single absolute value should be estimated separately for each agent, but that all the agent values vary randomly around a single mean absolute network effect. It is similar to <code>"common"</code> but makes slightly less strong assumptions.</li>
<li>
<code><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric()</a></code> Assigned a numeric value - this is similar to assigning <code>"common"</code>, but the single absolute value is assigned as a numeric value by the user, rather than estimated from the data.</li>
</ul>
<p>In <code><a href="../reference/mbnma.run.html">mbnma.run()</a></code>, an additional argument, <code>method</code>, indicates what method to use for pooling relative effects and can take either the values <code>"common"</code>, implying that all studies estimate the same true effect (akin to a “fixed effect” meta-analysis), or <code>"random"</code>, implying that all studies estimate a separate true effect, but that each of these true effects vary randomly around a true mean effect. This approach allows for modelling of between-study heterogeneity.</p>
<p>If relative effects (<code>"rel"</code>) are modelled on more than one dose-response parameter then by default, a correlation will be assumed between the dose-response parameters, which will typically improve estimation (provided the parameters are correlated…they usually are). This can be prevented by setting <code>cor=FALSE</code>.</p>
</div>
<div class="section level3">
<h3 id="output">Output<a class="anchor" aria-label="anchor" href="#output"></a>
</h3>
<p><code><a href="../reference/mbnma.run.html">mbnma.run()</a></code> returns an object of class <code>c("rjags", "mbnma")</code>. <code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code> provides posterior medians and 95% credible intervals (95%CrI) for different parameters in the model, naming them by agent and giving some explanation of the way they have been specified in the model. <code><a href="https://rdrr.io/r/base/print.html" class="external-link">print()</a></code> can also be used to give full summary statistics of the posterior distributions for monitored nodes in the JAGS model. Estimates are automatically reported for parameters of interest depending on the model specification (unless otherwise specified in <code>parameters.to.save</code>).</p>
<p>Dose-response parameters will be named in the output, with a separate coefficient for each agent (if specified as <code>"rel"</code>). If class effects are modelled, parameters for classes are represented by the upper case name of the dose-response parameter they correspond to (e.g. <code>EMAX</code> will be the class effects on <code>emax</code>). The SD of the class effect (e.g. <code>sd.EMAX</code>, <code>sd.BETA.1</code>) is the SD of agents within a class for the dose-response parameter they correspond to.</p>
<p><code>sd</code> corresponds to the between-study SD. However, <code>sd.</code> followed by a dose-response parameter name (e.g. <code>sd.emax</code>, <code>sd.beta.1</code>) is the between-agent SD for dose response parameters modeled using <code>"common"</code> or <code>"random"</code>.</p>
<p><code>totresdev</code> is the residual deviance, and <code>deviance</code> the deviance of the model. Model fit statistics for <code>pD</code> (effective number of parameters) and <code>DIC</code> (Deviance Information Criterion) are also reported, with an explanation as to how they have been calculated.</p>
<div class="section level4">
<h4 id="examples">Examples<a class="anchor" aria-label="anchor" href="#examples"></a>
</h4>
<p>An example MBNMA of the triptans dataset using an Emax dose-response function and common treatment effects that pool relative effects for each agent separately on both Emax and ED50 parameters follows:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Run an Emax dose-response MBNMA</span>
<span class="va">mbnma</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mbnma.run.html">mbnma.run</a></span><span class="op">(</span><span class="va">tripnet</span>, fun<span class="op">=</span><span class="fu"><a href="../reference/demax.html">demax</a></span><span class="op">(</span>emax<span class="op">=</span><span class="st">"rel"</span>, ed50<span class="op">=</span><span class="st">"rel"</span><span class="op">)</span>, 
                   method<span class="op">=</span><span class="st">"random"</span><span class="op">)</span>
<span class="co">#&gt; 'ed50' parameters are on exponential scale to ensure they take positive values on the natural scale</span>
<span class="co">#&gt; `likelihood` not given by user - set to `binomial` based on data provided</span>
<span class="co">#&gt; `link` not given by user - set to `logit` based on assigned value for `likelihood`</span></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Print neat summary of output</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mbnma</span><span class="op">)</span>
<span class="co">#&gt; <span style="font-weight: bold;">========================================</span></span>
<span class="co"><span style="font-weight: bold;">#&gt; Dose-response MBNMA</span></span>
<span class="co"><span style="font-weight: bold;">#&gt; ========================================</span></span>
<span class="co"><span style="font-weight: bold;">#&gt; </span></span>
<span class="co"><span style="font-weight: bold;">#&gt; </span>Dose-response function: emax</span>
<span class="co"><span style="font-weight: bold; text-decoration: underline;">#&gt; </span></span>
<span class="co"><span style="font-weight: bold; text-decoration: underline;">#&gt; Pooling method</span></span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Method: Correlation modelled between relative effect dose-response parametersRandom effects estimated for relative effects</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; <span style="font-weight: bold;">Parameter                    Median (95%CrI)</span></span>
<span class="co"><span style="font-weight: bold;">#&gt; -----------------------------------------------------------------------</span></span>
<span class="co">#&gt; Between-study SD for relative effects        0.244 (0.161, 0.333)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; <span style="font-weight: bold; text-decoration: underline;">emax dose-response parameter results</span></span>
<span class="co"><span style="font-weight: bold; text-decoration: underline;">#&gt; </span></span>
<span class="co"><span style="font-weight: bold; text-decoration: underline;">#&gt; </span>Pooling: relative effects for each agent</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; |Agent        |Parameter | Median|   2.5%|  97.5%|</span>
<span class="co">#&gt; |:------------|:---------|------:|------:|------:|</span>
<span class="co">#&gt; |eletriptan   |emax[2]   | 2.5864| 2.1469| 3.2582|</span>
<span class="co">#&gt; |sumatriptan  |emax[3]   | 1.8317| 1.4827| 2.4117|</span>
<span class="co">#&gt; |frovatriptan |emax[4]   | 1.9523| 1.2803| 3.3867|</span>
<span class="co">#&gt; |almotriptan  |emax[5]   | 1.8361| 1.3052| 3.1432|</span>
<span class="co">#&gt; |zolmitriptan |emax[6]   | 2.0992| 1.5627| 3.1407|</span>
<span class="co">#&gt; |naratriptan  |emax[7]   | 1.0792| 0.4218| 2.2481|</span>
<span class="co">#&gt; |rizatriptan  |emax[8]   | 2.4828| 1.8594| 3.9745|</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; <span style="font-weight: bold; text-decoration: underline;">ed50 dose-response parameter results</span></span>
<span class="co"><span style="font-weight: bold; text-decoration: underline;">#&gt; </span></span>
<span class="co"><span style="font-weight: bold; text-decoration: underline;">#&gt; </span>Parameter modelled on exponential scale to ensure it takes positive values</span>
<span class="co">#&gt; on the natural scale</span>
<span class="co">#&gt; Pooling: relative effects for each agent</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; |Agent        |Parameter |  Median|    2.5%|   97.5%|</span>
<span class="co">#&gt; |:------------|:---------|-------:|-------:|-------:|</span>
<span class="co">#&gt; |eletriptan   |ed50[2]   | -0.6451| -1.2760| -0.0289|</span>
<span class="co">#&gt; |sumatriptan  |ed50[3]   | -0.5039| -1.3825|  0.2663|</span>
<span class="co">#&gt; |frovatriptan |ed50[4]   | -0.4594| -1.5938|  0.5782|</span>
<span class="co">#&gt; |almotriptan  |ed50[5]   | -0.2784| -1.2189|  0.7669|</span>
<span class="co">#&gt; |zolmitriptan |ed50[6]   | -0.3683| -1.2729|  0.4978|</span>
<span class="co">#&gt; |naratriptan  |ed50[7]   | -0.1355| -1.3858|  1.0842|</span>
<span class="co">#&gt; |rizatriptan  |ed50[8]   | -0.5830| -1.5005|  0.3889|</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; <span style="font-weight: bold; text-decoration: underline;">Model Fit Statistics</span></span>
<span class="co"><span style="font-weight: bold; text-decoration: underline;">#&gt; </span>Effective number of parameters:</span>
<span class="co">#&gt; pD calculated using the Kullback-Leibler divergence = 121.9</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Deviance = 1094.9</span>
<span class="co">#&gt; Residual deviance = 191.8</span>
<span class="co">#&gt; Deviance Information Criterion (DIC) = 1216.9</span></code></pre></div>
<p>In this example the <code>emax</code> parameters are the maximum efficacy that can be achieved for each agent. The <code>ed50</code> parameters are the the dose at which 50% of the maximum efficacy is achieved for each agent. Results for ED50 are given on the log scale as it is constrained to be greater than zero. <code>sd</code> corresponds to the between-study SD (included because <code>method="random"</code>).</p>
<p>Instead of estimating a separate relative effect for each agent, a simpler dose-response model that makes stronger assumptions could estimate a single parameter across the whole network for ED50, but still estimate a separate effect for each agent for Emax:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Emax model with single parameter estimated for Emax</span>
<span class="va">emax</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mbnma.run.html">mbnma.run</a></span><span class="op">(</span><span class="va">tripnet</span>, fun<span class="op">=</span><span class="fu"><a href="../reference/demax.html">demax</a></span><span class="op">(</span>emax<span class="op">=</span><span class="st">"rel"</span>, ed50<span class="op">=</span><span class="st">"common"</span><span class="op">)</span>, 
                  method<span class="op">=</span><span class="st">"random"</span><span class="op">)</span>
<span class="co">#&gt; 'ed50' parameters are on exponential scale to ensure they take positive values on the natural scale</span>
<span class="co">#&gt; `likelihood` not given by user - set to `binomial` based on data provided</span>
<span class="co">#&gt; `link` not given by user - set to `logit` based on assigned value for `likelihood`</span></code></pre></div>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">emax</span><span class="op">)</span>
<span class="co">#&gt; <span style="font-weight: bold;">========================================</span></span>
<span class="co"><span style="font-weight: bold;">#&gt; Dose-response MBNMA</span></span>
<span class="co"><span style="font-weight: bold;">#&gt; ========================================</span></span>
<span class="co"><span style="font-weight: bold;">#&gt; </span></span>
<span class="co"><span style="font-weight: bold;">#&gt; </span>Dose-response function: emax</span>
<span class="co"><span style="font-weight: bold; text-decoration: underline;">#&gt; </span></span>
<span class="co"><span style="font-weight: bold; text-decoration: underline;">#&gt; Pooling method</span></span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Method: Random effects estimated for relative effects</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; <span style="font-weight: bold;">Parameter                    Median (95%CrI)</span></span>
<span class="co"><span style="font-weight: bold;">#&gt; -----------------------------------------------------------------------</span></span>
<span class="co">#&gt; Between-study SD for relative effects        0.242 (0.155, 0.333)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; <span style="font-weight: bold; text-decoration: underline;">emax dose-response parameter results</span></span>
<span class="co"><span style="font-weight: bold; text-decoration: underline;">#&gt; </span></span>
<span class="co"><span style="font-weight: bold; text-decoration: underline;">#&gt; </span>Pooling: relative effects for each agent</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; |Agent        |Parameter | Median|   2.5%|  97.5%|</span>
<span class="co">#&gt; |:------------|:---------|------:|------:|------:|</span>
<span class="co">#&gt; |eletriptan   |emax[2]   | 2.8302| 2.3384| 3.5120|</span>
<span class="co">#&gt; |sumatriptan  |emax[3]   | 1.8898| 1.5979| 2.2946|</span>
<span class="co">#&gt; |frovatriptan |emax[4]   | 2.0849| 1.3542| 2.9901|</span>
<span class="co">#&gt; |almotriptan  |emax[5]   | 1.7629| 1.3349| 2.3391|</span>
<span class="co">#&gt; |zolmitriptan |emax[6]   | 2.1072| 1.7037| 2.6583|</span>
<span class="co">#&gt; |naratriptan  |emax[7]   | 1.0318| 0.4361| 1.7029|</span>
<span class="co">#&gt; |rizatriptan  |emax[8]   | 2.7030| 2.1797| 3.4840|</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; <span style="font-weight: bold; text-decoration: underline;">ed50 dose-response parameter results</span></span>
<span class="co"><span style="font-weight: bold; text-decoration: underline;">#&gt; </span></span>
<span class="co"><span style="font-weight: bold; text-decoration: underline;">#&gt; </span>Parameter modelled on exponential scale to ensure it takes positive values</span>
<span class="co">#&gt; on the natural scale</span>
<span class="co">#&gt; Pooling: single parameter across all agents in the network</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; |Parameter |  Median|    2.5%| 97.5%|</span>
<span class="co">#&gt; |:---------|-------:|-------:|-----:|</span>
<span class="co">#&gt; |ed50      | -0.3796| -0.8773| 0.118|</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; <span style="font-weight: bold; text-decoration: underline;">Model Fit Statistics</span></span>
<span class="co"><span style="font-weight: bold; text-decoration: underline;">#&gt; </span>Effective number of parameters:</span>
<span class="co">#&gt; pD calculated using the Kullback-Leibler divergence = 119.5</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Deviance = 1094.4</span>
<span class="co">#&gt; Residual deviance = 191.3</span>
<span class="co">#&gt; Deviance Information Criterion (DIC) = 1213.9</span></code></pre></div>
<p>In this example <code>ed50</code> only has a single parameter, which corresponds to the dose at which 50% of the maximum efficacy is achieved, assumed to be equal across all agents in the network.</p>
</div>
<div class="section level4">
<h4 id="parameter-interpretation">Parameter interpretation<a class="anchor" aria-label="anchor" href="#parameter-interpretation"></a>
</h4>
<p>Parameter interpretation depends both on the link scale on which the outcome is modeled, and on the dose-response function used in the model.</p>
<p>For example for a binomial outcome modeled using a logit link function and an Emax dose-response function, the <code>emax</code> parameter represents the maximum efficacy on the logit scale - it is modeled on the outcome scale and hence is dependent on the link function. As indicated in the help file (<code>?demax()</code>), the <code>ed50</code> parameter is modeled on the log-scale to ensure that it takes positive values on the natural scale, but is not modeled on the outcome scale so is not dependent on the link function. Therefore it can be interpreted as the log-dose at which 50% of the maximum efficacy is achieved. The <code>hill</code> parameter is also modeled on the log-scale, and it can be interpreted as a log-value that controls the sigmoidicity of the dose-response function for the outcome on the logit scale.</p>
<p>For a continuous outcome modeled using <code>link="smd"</code>, whilst not a true link function it implies modelling Standardised Mean Differences (SMD). For a linear dose-response function (<code>dpoly(degree=1)</code>), <code>beta.1</code> represents the change in SMD for each additional unit of dose. For a quadratic dose-response function (<code>dpoly(degree=2)</code>), <code>beta.2</code> represents the change in <code>beta.1</code> for each additional unit of dose.</p>
<p>With some dose-response functions (e.g. splines, fractional polynomials) parameter interpretation can be challenging. The <code><a href="../reference/get.relative.html">get.relative()</a></code> function can make this easier as this allows relative effects to be estimated between agents at specific doses, which is typically much more easily understandable and presentable (see <a href="#estimating-relative-effects">Estimating relative effects</a>).</p>
</div>
</div>
<div class="section level3">
<h3 id="additional-arguments-for-mbnma-run">Additional arguments for <code>mbnma.run()</code><a class="anchor" aria-label="anchor" href="#additional-arguments-for-mbnma-run"></a>
</h3>
<p>Several additional arguments can be given to <code><a href="../reference/mbnma.run.html">mbnma.run()</a></code> that require further explanation.</p>
<div class="section level4">
<h4 id="class-effects">Class effects<a class="anchor" aria-label="anchor" href="#class-effects"></a>
</h4>
<p>Similar effects between agents within the network can be modelled using class effects. This requires assuming that different agents have some sort of common class effect, perhaps due to similar mechanisms of action. Advantages of this is that class effects can be used to connect agents that might otherwise be disconnected from the network, and they can also provide additional information on agents that might otherwise have insufficient data available to estimate a desired dose-response. The drawback is that this requires making additional assumptions regarding similarity of efficacy.</p>
<p>One difficult of this modelling aspect in particular is that the scales for dose-response parameters must be the same across different agents within a class for this assumption to be valid. For example, in an Emax model it may be reasonable to assume a class effect on the Emax parameter, as this is parameterised on the response scale and so could be similar across agents of the same class. However, the ED50 parameter is parameterised on the dose scale, which is likely to differ for each agent and so an assumption of similarity between agents for this parameter may be less valid. One way to try to account for this issue and make dose scales more consistent across agents is to standardise doses for each agent relative to its “common” dose (see Thorlund et al. <span class="citation">(<span class="citeproc-not-found" data-reference-id="thorlund2015"><strong>???</strong></span>)</span>), though we expect that this may lead to bias if the common dose is located at a different point along the dose-response curve.</p>
<p>Class effects can only be applied to dose-response parameters which vary by agent. In <code><a href="../reference/mbnma.run.html">mbnma.run()</a></code> they are supplied as a list, in which each element is named following the name of the corresponding dose-response parameter as defined in the dose-response function. The names will therefore differ when using wrapper functions for <code><a href="../reference/mbnma.run.html">mbnma.run()</a></code>. The class effect for each dose-response parameter can be either <code>"common"</code>, in which the effects for each agent within the same class are constrained to a common class effect, or <code>"random"</code>, in which the effects for each agent within the same class are assumed to be randomly distributed around a shared class mean.</p>
<p>When working with class effects in <code>MBNMAdose</code> a variable named <code>class</code> must be included in the original data frame provided to <code><a href="../reference/mbnma.network.html">mbnma.network()</a></code>. Below we assign a class for two similar agents in the dataset - Naproxcinod and Naproxen. We will estimate separate effects for all other agents, so we set their classes to be equal to their agents.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Using the osteoarthritis dataset</span>
<span class="va">pain.df</span> <span class="op">&lt;-</span> <span class="va">osteopain</span>

<span class="co"># Set class equal to agent for all agents</span>
<span class="va">pain.df</span><span class="op">$</span><span class="va">class</span> <span class="op">&lt;-</span> <span class="va">pain.df</span><span class="op">$</span><span class="va">class</span>

<span class="co"># Set a shared class (NSAID) only for Naproxcinod and Naproxen</span>
<span class="va">pain.df</span><span class="op">$</span><span class="va">class</span><span class="op">[</span><span class="va">pain.df</span><span class="op">$</span><span class="va">agent</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Naproxcinod"</span>, <span class="st">"Naproxen"</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> 
  <span class="st">"NSAID"</span>

<span class="co"># Run a restricted cubic spline MBNMA with a random class effect on beta.1</span>
<span class="va">classnet</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mbnma.network.html">mbnma.network</a></span><span class="op">(</span><span class="va">pain.df</span><span class="op">)</span>
<span class="va">splines</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mbnma.run.html">mbnma.run</a></span><span class="op">(</span><span class="va">classnet</span>, fun<span class="op">=</span><span class="fu"><a href="../reference/dspline.html">dspline</a></span><span class="op">(</span>type<span class="op">=</span><span class="st">"bs"</span>, knots<span class="op">=</span><span class="fl">2</span><span class="op">)</span>, class.effect <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>beta.1<span class="op">=</span><span class="st">"random"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Mean class effects are given in the output as <code>D.ed50</code>/<code>D.1</code> parameters. These can be interpreted as the effect of each class for Emax parameters (<code>beta.1</code>). Note the number of <code>D.ed50</code> parameters is therefore equal to the number of classes defined in the dataset.</p>
<p>If we had specified that the class effects were <code>"random"</code>, each treatment effect for Emax (<code>beta.1</code>) would be assumed to be randomly distributed around its class mean with SD given in the output as <code>sd.D.ed50</code>/<code>sd.D.1</code>.</p>
<p>Mean class effects are represented in the output by the upper case name of the dose-response parameter they correspond to. In this case, <code>BETA.1</code> is the class effects on <code>beta.1</code>, the first spline coefficient. The SD of the class effect is the SD of agents within a class for the dose-response parameter they correspond to. In this case <code>sd.BETA.1</code> is the within-class SD for <code>beta.1</code>.</p>
</div>
<div class="section level4">
<h4 id="user-defined-dose-response-function">User-defined dose-response function<a class="anchor" aria-label="anchor" href="#user-defined-dose-response-function"></a>
</h4>
<p>Users can define their own dose-response function using <code><a href="../reference/duser.html">duser()</a></code> rather than using one of the functions provided in <code>MBNMAdose</code>. The dose-response is specified in terms of <code>beta</code> parameters and <code>dose</code>. This allows a huge degree of flexibility when defining the dose-response relationship.</p>
<p>The function assigned needs to fulfil a few criteria to be valid: * <code>dose</code> must always be included in the function * At least one <code>beta</code> dose-response parameter must be specified, up to a maximum of four. These must always be named <code>beta.1</code>, <code>beta.2</code>, <code>beta.3</code> and <code>beta.4</code>, and must be included sequentially (i.e. don’t include <code>beta.3</code> if <code>beta.2</code> is not included) * Indices used by JAGS should <em>not</em> be added (e.g. use <code>dose</code> rather than <code>dose[i,k]</code>) * Any mathematical/logical operators that can be implemented in JAGS can be added to the function (e.g. <code><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp()</a></code>, <code><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse()</a></code>). See the JAGS manual <span class="citation">(JAGS Computer Program 2017)</span> for further details.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a><span class="co"># Using the depression SSRI dataset</span></span>
<span id="cb16-2"><a href="#cb16-2"></a>depnet &lt;-<span class="st"> </span><span class="kw">mbnma.network</span>(ssri)</span>
<span id="cb16-3"><a href="#cb16-3"></a></span>
<span id="cb16-4"><a href="#cb16-4"></a><span class="co"># An example specifying a quadratic dose-response function</span></span>
<span id="cb16-5"><a href="#cb16-5"></a>quadfun &lt;-<span class="st"> </span><span class="er">~</span><span class="st"> </span>(beta<span class="fl">.1</span> <span class="op">*</span><span class="st"> </span>dose) <span class="op">+</span><span class="st"> </span>(beta<span class="fl">.2</span> <span class="op">*</span><span class="st"> </span>(dose<span class="op">^</span><span class="dv">2</span>))</span>
<span id="cb16-6"><a href="#cb16-6"></a></span>
<span id="cb16-7"><a href="#cb16-7"></a>quad &lt;-<span class="st"> </span><span class="kw">mbnma.run</span>(depnet, <span class="dt">fun=</span><span class="kw">duser</span>(<span class="dt">fun=</span>quadfun, <span class="dt">beta.1 =</span> <span class="st">"rel"</span>, <span class="dt">beta.2 =</span> <span class="st">"rel"</span>))<span class="op">|</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="agent-specific-dose-response-functions">Agent-specific dose-response functions<a class="anchor" aria-label="anchor" href="#agent-specific-dose-response-functions"></a>
</h4>
<p>Different dose-response functions can be used for different agents within the network. This allows for the modelling of more complex dose-response functions in agents for which there are many doses available, and less complex functions in agents for which there are fewer doses available. Note that these models are typically less computationally stable than single dose-response function models, and they are likely to benefit less from modelling correlation between multiple dose-response parameters since there are fewer agents informing correlations between each dose-response parameter.</p>
<p>This can be modeled using the <code><a href="../reference/dmulti.html">dmulti()</a></code> dose-response function and assigning a list of objects of class <code>"dosefun"</code> to it. Each element in the list corresponds to an agent in the network (the order of which should be the same as the order of agents in the <code>"mbnma.network"</code> object). A dose-response function for Placebo should be included in the list, though which function is used is typically irrelevant since evaluating the function at dose=0 will typically equal 0.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Using the depression SSRI dataset</span>
<span class="va">depnet</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mbnma.network.html">mbnma.network</a></span><span class="op">(</span><span class="va">ssri</span><span class="op">)</span>

<span class="va">dr.funs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dmulti.html">dmulti</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>
  <span class="st">"Placebo"</span><span class="op">=</span><span class="fu"><a href="../reference/dpoly.html">dpoly</a></span><span class="op">(</span>degree<span class="op">=</span><span class="fl">2</span><span class="op">)</span>,
  <span class="st">"citalopram"</span><span class="op">=</span><span class="fu"><a href="../reference/dpoly.html">dpoly</a></span><span class="op">(</span>degree<span class="op">=</span><span class="fl">2</span><span class="op">)</span>,
  <span class="st">"escitalopram"</span><span class="op">=</span><span class="fu"><a href="../reference/dpoly.html">dpoly</a></span><span class="op">(</span>degree<span class="op">=</span><span class="fl">2</span><span class="op">)</span>,
  <span class="st">"fluoxetine"</span><span class="op">=</span><span class="fu"><a href="../reference/dspline.html">dspline</a></span><span class="op">(</span>type<span class="op">=</span><span class="st">"ns"</span>,knots<span class="op">=</span><span class="fl">2</span><span class="op">)</span>,
  <span class="st">"paroxetine"</span><span class="op">=</span><span class="fu"><a href="../reference/dpoly.html">dpoly</a></span><span class="op">(</span>degree<span class="op">=</span><span class="fl">2</span><span class="op">)</span>,
  <span class="st">"sertraline"</span><span class="op">=</span><span class="fu"><a href="../reference/dspline.html">dspline</a></span><span class="op">(</span>type<span class="op">=</span><span class="st">"ns"</span>,knots<span class="op">=</span><span class="fl">2</span><span class="op">)</span>
  <span class="op">)</span><span class="op">)</span>

<span class="va">multifun</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mbnma.run.html">mbnma.run</a></span><span class="op">(</span><span class="va">depnet</span>, fun<span class="op">=</span><span class="va">dr.funs</span>, method<span class="op">=</span><span class="st">"common"</span>, n.iter<span class="op">=</span><span class="fl">50000</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">multifun</span><span class="op">)</span></code></pre></div>
<p>Because an MBNMA model with a linear dose-response function (<code>dpoly(degree=1)</code>) is mathematically equivalent to a standard NMA model, using agent-specific dose-response functions allows analysis of datasets that both include multiple doses of different drugs <em>and</em> interventions for which a dose-response relationship is not realistic (e.g. surgery) or difficult to assume (e.g. psychotherapy, exercise interventions). Interventions without a dose-response relationship can be coded in the dataset as different agents, each of which should be assigned a dose of 1, and these can then be modeled using a linear dose-response relationship, whilst agents with a plausible dose-response can be assigned a function that appropriately captures their dose-response relationship.</p>
</div>
<div class="section level4">
<h4 id="splines-and-knots">Splines and <code>knots</code><a class="anchor" aria-label="anchor" href="#splines-and-knots"></a>
</h4>
<p>For a more flexible dose-response shape, various different splines can be fitted to the data by using <code><a href="../reference/dspline.html">dspline()</a></code>. This model is very flexible and can allow for a variety of non-monotonic dose-response relationships, though parameters can be difficult to interpret.</p>
<p>To fit this model, the number/location of <code>knots</code> (the points at which the different spline pieces meet) should be specified. If a single number is given, it represents the the number of knots to be equally spaced across the dose range of each agent. Alternatively several probabilities can be given that represent the quantiles of the dose range for each agent at which knots should be located.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/dspline.html">dspline</a></span><span class="op">(</span>type<span class="op">=</span><span class="st">"bs"</span>, knots<span class="op">=</span><span class="fl">3</span><span class="op">)</span>
<span class="co"># ...is equivalent to </span>
<span class="fu"><a href="../reference/dspline.html">dspline</a></span><span class="op">(</span>type<span class="op">=</span><span class="st">"bs"</span>, knots<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.25</span>,<span class="fl">0.5</span>,<span class="fl">0.75</span><span class="op">)</span><span class="op">)</span>

<span class="co"># Using a natural cubic spline on the SSRI dataset</span>
<span class="va">depnet</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mbnma.network.html">mbnma.network</a></span><span class="op">(</span><span class="va">ssri</span><span class="op">)</span>
<span class="va">ns</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mbnma.run.html">mbnma.run</a></span><span class="op">(</span><span class="va">depnet</span>, fun<span class="op">=</span><span class="fu"><a href="../reference/dspline.html">dspline</a></span><span class="op">(</span>type<span class="op">=</span><span class="st">"ns"</span>, knots<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.25</span>,<span class="fl">0.5</span>,<span class="fl">0.75</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level4">
<h4 id="correlation-between-dose-response-parameters">Correlation between dose-response parameters<a class="anchor" aria-label="anchor" href="#correlation-between-dose-response-parameters"></a>
</h4>
<p><code><a href="../reference/mbnma.run.html">mbnma.run()</a></code> automatically models correlation between relative effects dose-response parameters. This can be prevented by specifying <code>cor=FALSE</code> in <code><a href="../reference/mbnma.run.html">mbnma.run()</a></code>. The correlation is modeled using a vague Wishart prior, but this can be made more informative by specifying a scale matrix for the prior. This corresponds to the expectation of the Wishart prior. A different scale matrix can be given to the model in <code>omega</code>. Each row of the scale matrix corresponds to the 1st, 2nd, 3rd, etc. dose-response parameter that has been modeled using relative effects (as specified in the dose-response function).</p>
</div>
<div class="section level4">
<h4 id="priors">Priors<a class="anchor" aria-label="anchor" href="#priors"></a>
</h4>
<p>Default vague priors for the model are as follows:</p>
<p><span class="math display">\[
\begin{aligned}
  &amp;d_{p,a} \sim N(0,10000)\\
  &amp;beta_{p} \sim N(0,10000)\\
  &amp;\sigma \sim N(0,400) \text{  limited to  } x \in [0,\infty]\\
  &amp;\sigma_{p} \sim N(0,400) \text{  limited to  } x \in [0,\infty]\\
  &amp;D_{p,c} \sim N(0,1000)\\
  &amp;\sigma^D_{p} \sim N(0,400) \text{ limited to } x \in [0,\infty]\\
\end{aligned}
\]</span></p>
<p>…where <span class="math inline">\(p\)</span> is an identifier for the dose-response parameter (e.g. 1 for Emax and 2 for ED50), <span class="math inline">\(a\)</span> is an agent identifier and <span class="math inline">\(c\)</span> is a class identifier.</p>
<p>Users may wish to change these, perhaps in order to use more/less informative priors, but also because the default prior distributions in some models may lead to errors when compiling/updating models.</p>
<p>If the model fails during compilation/updating (i.e. due to a problem in JAGS), <code><a href="../reference/mbnma.run.html">mbnma.run()</a></code> will generate an error and return a list of arguments that <code><a href="../reference/mbnma.run.html">mbnma.run()</a></code> used to generate the model. Within this (as within a model that has run successfully), the priors used by the model (in JAGS syntax) are stored within <code>"model.arg"</code>:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">mbnma</span><span class="op">$</span><span class="va">model.arg</span><span class="op">$</span><span class="va">priors</span><span class="op">)</span>
<span class="co">#&gt; $mu</span>
<span class="co">#&gt; [1] "dnorm(0,0.001)"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $sd</span>
<span class="co">#&gt; [1] "dunif(0, 6.021)"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $inv.R</span>
<span class="co">#&gt; [1] "dwish(omega[,], 2)"</span></code></pre></div>
<p>In this way a model can first be run with vague priors and then rerun with different priors, perhaps to allow successful computation, perhaps to provide more informative priors, or perhaps to run a sensitivity analysis with different priors. Increasing the precision of prior distributions only a little can also often improve convergence considerably.</p>
<p>To change priors within a model, a list of replacements can be provided to <code>priors</code> in <code><a href="../reference/mbnma.run.html">mbnma.run()</a></code>. The name of each element is the name of the parameter to change (without indices) and the value of the element is the JAGS distribution to use for the prior. This can include censoring or truncation if desired. Only the priors to be changed need to be specified - priors for parameters that aren’t specified will take default values.</p>
<p>For example, if we want to use tighter priors for the half-normal SD parameters we could increase the precision:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Define replacement prior</span>
<span class="va">new.priors</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>
  sd <span class="op">=</span> <span class="st">"dnorm(0, 1) T(0,)"</span>
  <span class="op">)</span>

<span class="co"># Run an MBNMA model with new priors</span>
<span class="va">emax</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mbnma.run.html">mbnma.run</a></span><span class="op">(</span><span class="va">alognet</span>, fun<span class="op">=</span><span class="fu"><a href="../reference/demax.html">demax</a></span><span class="op">(</span><span class="op">)</span>, method<span class="op">=</span><span class="st">"random"</span>,
                   priors<span class="op">=</span><span class="va">new.priors</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level4">
<h4 id="pd-effective-number-of-parameters">pD (effective number of parameters)<a class="anchor" aria-label="anchor" href="#pd-effective-number-of-parameters"></a>
</h4>
<p>The default value in for <code>pd</code> in <code><a href="../reference/mbnma.run.html">mbnma.run()</a></code> is <code>"pv"</code>, which uses the value automatically calculated in the <code>R2jags</code> package as <code>pv = var(deviance)/2</code>. Whilst this is easy to calculate, it is numerically less stable than <code>pD</code> and may perform more poorly in certain conditions <span class="citation">(Gelman, Hwang, and Vehtari 2014)</span>.</p>
<p>A commonly-used approach for calculating pD is the plug-in method (<code>pd="plugin"</code>) <span class="citation">(Spiegelhalter et al. 2002)</span>. However, this can sometimes result in negative non-sensical values due to skewed posterior distributions for deviance contributions that can arise when fitting non-linear models.</p>
<p>Another approach that is more reliable than the plug-in method when modelling non-linear effects is using the Kullback-Leibler divergence (<code>pd="pd.kl"</code>) <span class="citation">(Plummer 2008)</span>. The disadvantage of this approach is that it requires running additional MCMC iterations, so can be slightly slower to calculate.</p>
<p>Finally, pD can also be calculated using an optimism adjustment (<code>pd="popt"</code>) which allows for calculation of the penalized expected deviance <span class="citation">(Plummer 2008)</span>. This adjustment allows for the fact that data used to estimate the model is the same as that used to assess its parsimony. It also requires running additional MCMC iterations.</p>
</div>
<div class="section level4">
<h4 id="arguments-to-be-sent-to-jags">Arguments to be sent to JAGS<a class="anchor" aria-label="anchor" href="#arguments-to-be-sent-to-jags"></a>
</h4>
<p>In addition to the arguments specific to <code><a href="../reference/mbnma.run.html">mbnma.run()</a></code> it is also possible to use any arguments to be sent to <code><a href="https://rdrr.io/pkg/R2jags/man/jags.html" class="external-link">R2jags::jags()</a></code>. Most of these are likely to relate to improving the performance of MCMC simulations in JAGS and may help with parameter convergence (see [Convergence]). Some of the key arguments that may be of interest are:</p>
<ul>
<li>
<code>n.chains</code> The number of Markov chains to run (default is 3)</li>
<li>
<code>n.iter</code> The total number of iterations per MCMC chain</li>
<li>
<code>n.burnin</code> The number of iterations that are discarded to ensure iterations are only saved once chains have converged</li>
<li>
<code>n.thin</code> The thinning rate which ensures that results are only saved for 1 in every <code>n.thin</code> iterations per chain. This can be increased to reduce autocorrelation</li>
</ul>
</div>
</div>
<div class="section level3">
<h3 id="connecting-networks-via-the-dose-response-relationship">Connecting networks via the dose-response relationship<a class="anchor" aria-label="anchor" href="#connecting-networks-via-the-dose-response-relationship"></a>
</h3>
<p>One of the strengths of dose-response MBNMA is that it allows treatments to be connected in a network that might otherwise be disconnected, by linking up different doses of the same agent via the dose-response relationship <span class="citation">(Pedder, Dias, Bennetts, et al. 2021)</span>. To illustrate this we can generate a version of the gout dataset which excludes placebo (to artificially disconnect the network):</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Generate dataset without placebo</span>
<span class="va">noplac.gout</span> <span class="op">&lt;-</span> 
  <span class="va">gout</span><span class="op">[</span><span class="op">!</span><span class="va">gout</span><span class="op">$</span><span class="va">studyID</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2001</span>, <span class="fl">3102</span><span class="op">)</span>,<span class="op">]</span> <span class="co"># Drop two-arm placebo studies</span>
<span class="va">noplac.gout</span> <span class="op">&lt;-</span> 
  <span class="va">noplac.gout</span><span class="op">[</span><span class="va">noplac.gout</span><span class="op">$</span><span class="va">agent</span><span class="op">!=</span><span class="st">"Plac"</span>,<span class="op">]</span> <span class="co"># Drop placebo arm from multi-arm studies</span>

<span class="co"># Create mbnma.network object</span>
<span class="va">noplac.net</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mbnma.network.html">mbnma.network</a></span><span class="op">(</span><span class="va">noplac.gout</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Plot network</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">noplac.net</span>, label.distance<span class="op">=</span><span class="fl">5</span><span class="op">)</span>
<span class="co">#&gt; Warning in check.network(g): The following treatments/agents are not connected</span>
<span class="co">#&gt; to the network reference:</span>
<span class="co">#&gt; Allo_300</span>
<span class="co">#&gt; Allo_400</span>
<span class="co">#&gt; Arha_400</span>
<span class="co">#&gt; Arha_600</span>
<span class="co">#&gt; Benz_50</span>
<span class="co">#&gt; Benz_200</span>
<span class="co">#&gt; Febu_40</span>
<span class="co">#&gt; Febu_80</span>
<span class="co">#&gt; Febu_120</span>
<span class="co">#&gt; RDEA_100</span>
<span class="co">#&gt; RDEA_200</span>
<span class="co">#&gt; RDEA_400</span></code></pre></div>
<p><img src="mbnmadose_files/figure-html/unnamed-chunk-26-1.png" width="672"></p>
<p>This results in a very disconnected network, and if we were to conduct a conventional “split” NMA (whereby different doses of an agent are considered to be independent), we would only be able to estimate relative effects for a very small number of treatments. However, if we assume a dose-response relationship then these different doses can be connected via this relationship, and we can connect up more treatments and agents in the network.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Network plot at the agent level illustrates how doses can connect using MBNMA</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">noplac.net</span>, level<span class="op">=</span><span class="st">"agent"</span>, remove.loops <span class="op">=</span> <span class="cn">TRUE</span>, label.distance <span class="op">=</span> <span class="fl">4</span><span class="op">)</span>
<span class="co">#&gt; Warning in check.network(g): The following treatments/agents are not connected</span>
<span class="co">#&gt; to the network reference:</span>
<span class="co">#&gt; Arha</span>
<span class="co">#&gt; RDEA</span></code></pre></div>
<p><img src="mbnmadose_files/figure-html/unnamed-chunk-27-1.png" width="672"></p>
<p>There are still two agents that do not connect to the network because they involve comparisons of different doses of the same agent. However, multiple doses of an agent within a study allow us to estimate the dose-response relationship and tell us something about the placebo (dose = 0) response - the number of different doses of an agent within a study will determine the degrees of freedom with which we are able to estimate a given dose-response function. Although the placebo response is not estimated directly in the MBNMA framework (it is modelled as a nuisance parameter), it allows us to connect the dose-response function estimated for an agent in one study, with that in another.</p>
<p>To visualise this, we can use the <code>doselink</code> argument in <code>plot(mbnma.network)</code>. The integer given to this argument indicates the minimum number of doses from which a dose-response function could be estimated, and is equivalent to the number of parameters in the desired dose-response function plus one. For example for an exponential function, we would require at least two doses on a dose-response curve (including placebo), since this would allow one degree of freedom with which to estimate the one-parameter dose-response function. By modifying the <code>doselink</code> argument we can determine the complexity of a dose-response function that we might expect to be able to estimate whilst still connecting all agents within the network.</p>
<p>If placebo is not included in the original dataset then this argument will also add a node for placebo to illustrate the connection.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Network plot assuming connectivity via two doses</span>
<span class="co"># Allows estimation of a single-parameter dose-response function</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">noplac.net</span>, level<span class="op">=</span><span class="st">"agent"</span>, remove.loops <span class="op">=</span> <span class="cn">TRUE</span>, label.distance <span class="op">=</span> <span class="fl">4</span>,
     doselink<span class="op">=</span><span class="fl">2</span><span class="op">)</span>
<span class="co">#&gt; Dose-response connections to placebo plotted based on a dose-response</span>
<span class="co">#&gt;                    function with 1 degrees of freedom</span></code></pre></div>
<p><img src="mbnmadose_files/figure-html/unnamed-chunk-28-1.png" width="672"></p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="co"># Network plot assuming connectivity via three doses</span>
<span class="co"># Allows estimation of a two-parameter dose-response function</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">noplac.net</span>, level<span class="op">=</span><span class="st">"agent"</span>, remove.loops <span class="op">=</span> <span class="cn">TRUE</span>, label.distance <span class="op">=</span> <span class="fl">4</span>,
     doselink<span class="op">=</span><span class="fl">3</span><span class="op">)</span>
<span class="co">#&gt; Warning in check.network(g): The following treatments/agents are not connected</span>
<span class="co">#&gt; to the network reference:</span>
<span class="co">#&gt; Allo</span>
<span class="co">#&gt; Arha</span>
<span class="co">#&gt; Benz</span>
<span class="co">#&gt; Febu</span>
<span class="co">#&gt; Dose-response connections to placebo plotted based on a dose-response</span>
<span class="co">#&gt;                    function with 2 degrees of freedom</span></code></pre></div>
<p><img src="mbnmadose_files/figure-html/unnamed-chunk-28-2.png" width="672"></p>
<p>In this way we can fully connect up treatments in an otherwise disconnected network, though unless informative prior information is used this will be limited by the number of doses of agents within included studies. See Pedder et al. <span class="citation">(2021)</span> for more details on this.</p>
</div>
<div class="section level3">
<h3 id="non-parametric-dose-response-functions">Non-parametric dose-response functions<a class="anchor" aria-label="anchor" href="#non-parametric-dose-response-functions"></a>
</h3>
<p>In addition to the parametric dose-response functions described above, a non-parametric monotonic dose-response relationship can also be specified in <code><a href="../reference/mbnma.run.html">mbnma.run()</a></code>. <code>fun=dnonparam()</code> can be used to specify a monotonically increasing (<code>direction="increasing"</code>) or decreasing (<code>direction="decreasing"</code>) dose-response respectively. This is achieved in the model by imposing restrictions on the prior distributions of treatment effects that ensure that each increasing dose of an agent has an effect that is either the same or greater than the previous dose. The approach results in a similar model to that developed by Owen et al. <span class="citation">(2015)</span>.</p>
<p>By making this assumption, this model is slightly more informative, and can lead to some slight gains in precision if relative effects are otherwise imprecisely estimated. However, because a functional form for the dose-response is not modeled, it cannot be used to connect networks that are disconnected at the treatment-level, unlike a parametric MBNMA.</p>
<p>In the case of MBNMA, it may be useful to compare the fit of a non-parametric model to that of a parametric dose-response function, to ensure that fitting a parametric dose-response function does not lead to significantly poorer model fit.</p>
<p>When fitting a non-parametric dose-response model, it is important to correctly choose the expected <code>direction</code> of the monotonic response, otherwise it can lead to computation error.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">nonparam</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mbnma.run.html">mbnma.run</a></span><span class="op">(</span><span class="va">tripnet</span>, fun<span class="op">=</span><span class="fu"><a href="../reference/dnonparam.html">dnonparam</a></span><span class="op">(</span>direction<span class="op">=</span><span class="st">"increasing"</span><span class="op">)</span>, method<span class="op">=</span><span class="st">"random"</span><span class="op">)</span>
<span class="co">#&gt; `likelihood` not given by user - set to `binomial` based on data provided</span>
<span class="co">#&gt; `link` not given by user - set to `logit` based on assigned value for `likelihood`</span></code></pre></div>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">nonparam</span><span class="op">)</span>
<span class="co">#&gt; Inference for Bugs model at "/tmp/Rtmp6v0Osl/file43d627de6207", fit using jags,</span>
<span class="co">#&gt;  3 chains, each with 20000 iterations (first 10000 discarded), n.thin = 10</span>
<span class="co">#&gt;  n.sims = 3000 iterations saved</span>
<span class="co">#&gt;            mu.vect sd.vect     2.5%      25%      50%      75%    97.5%  Rhat</span>
<span class="co">#&gt; d.1[1,1]     0.000   0.000    0.000    0.000    0.000    0.000    0.000 1.000</span>
<span class="co">#&gt; d.1[1,2]     0.000   0.000    0.000    0.000    0.000    0.000    0.000 1.000</span>
<span class="co">#&gt; d.1[2,2]     1.187   0.183    0.812    1.069    1.192    1.311    1.543 1.002</span>
<span class="co">#&gt; d.1[3,2]     1.738   0.120    1.496    1.658    1.739    1.819    1.973 1.002</span>
<span class="co">#&gt; d.1[4,2]     2.039   0.145    1.770    1.938    2.037    2.134    2.330 1.002</span>
<span class="co">#&gt; d.1[1,3]     0.000   0.000    0.000    0.000    0.000    0.000    0.000 1.000</span>
<span class="co">#&gt; d.1[2,3]     0.947   0.143    0.637    0.858    0.962    1.049    1.185 1.001</span>
<span class="co">#&gt; d.1[3,3]     1.115   0.087    0.937    1.057    1.116    1.171    1.287 1.002</span>
<span class="co">#&gt; d.1[4,3]     1.254   0.115    1.041    1.173    1.251    1.333    1.482 1.001</span>
<span class="co">#&gt; d.1[5,3]     1.458   0.087    1.289    1.399    1.458    1.517    1.628 1.006</span>
<span class="co">#&gt; d.1[1,4]     0.000   0.000    0.000    0.000    0.000    0.000    0.000 1.000</span>
<span class="co">#&gt; d.1[2,4]     1.242   0.210    0.823    1.100    1.237    1.387    1.658 1.008</span>
<span class="co">#&gt; d.1[3,4]     1.631   0.328    1.060    1.398    1.609    1.839    2.330 1.003</span>
<span class="co">#&gt; d.1[1,5]     0.000   0.000    0.000    0.000    0.000    0.000    0.000 1.000</span>
<span class="co">#&gt; d.1[2,5]     0.622   0.240    0.139    0.455    0.631    0.799    1.062 1.011</span>
<span class="co">#&gt; d.1[3,5]     1.040   0.125    0.801    0.958    1.037    1.123    1.293 1.001</span>
<span class="co">#&gt; d.1[4,5]     1.458   0.210    1.064    1.315    1.457    1.595    1.872 1.001</span>
<span class="co">#&gt; d.1[1,6]     0.000   0.000    0.000    0.000    0.000    0.000    0.000 1.000</span>
<span class="co">#&gt; d.1[2,6]     0.758   0.315    0.111    0.529    0.788    1.001    1.289 1.010</span>
<span class="co">#&gt; d.1[3,6]     1.241   0.117    1.011    1.165    1.239    1.323    1.463 1.001</span>
<span class="co">#&gt; d.1[4,6]     1.542   0.189    1.206    1.405    1.530    1.664    1.938 1.001</span>
<span class="co">#&gt; d.1[5,6]     1.875   0.268    1.394    1.685    1.852    2.048    2.442 1.002</span>
<span class="co">#&gt; d.1[6,6]     2.886   0.590    1.860    2.461    2.836    3.270    4.141 1.002</span>
<span class="co">#&gt; d.1[1,7]     0.000   0.000    0.000    0.000    0.000    0.000    0.000 1.000</span>
<span class="co">#&gt; d.1[2,7]     0.553   0.206    0.147    0.412    0.548    0.689    0.965 1.007</span>
<span class="co">#&gt; d.1[3,7]     1.010   0.310    0.468    0.788    0.989    1.212    1.676 1.003</span>
<span class="co">#&gt; d.1[1,8]     0.000   0.000    0.000    0.000    0.000    0.000    0.000 1.000</span>
<span class="co">#&gt; d.1[2,8]     0.511   0.314    0.028    0.258    0.482    0.723    1.167 1.005</span>
<span class="co">#&gt; d.1[3,8]     1.269   0.161    0.948    1.164    1.273    1.378    1.575 1.005</span>
<span class="co">#&gt; d.1[4,8]     1.614   0.105    1.408    1.543    1.613    1.685    1.825 1.002</span>
<span class="co">#&gt; sd           0.262   0.047    0.175    0.230    0.261    0.293    0.359 1.013</span>
<span class="co">#&gt; totresdev  188.546  19.596  152.690  175.029  187.794  201.378  229.440 1.009</span>
<span class="co">#&gt; deviance  1091.652  19.596 1055.796 1078.135 1090.900 1104.484 1132.546 1.010</span>
<span class="co">#&gt;           n.eff</span>
<span class="co">#&gt; d.1[1,1]      1</span>
<span class="co">#&gt; d.1[1,2]      1</span>
<span class="co">#&gt; d.1[2,2]   1200</span>
<span class="co">#&gt; d.1[3,2]   1600</span>
<span class="co">#&gt; d.1[4,2]   1800</span>
<span class="co">#&gt; d.1[1,3]      1</span>
<span class="co">#&gt; d.1[2,3]   3000</span>
<span class="co">#&gt; d.1[3,3]   3000</span>
<span class="co">#&gt; d.1[4,3]   2100</span>
<span class="co">#&gt; d.1[5,3]    370</span>
<span class="co">#&gt; d.1[1,4]      1</span>
<span class="co">#&gt; d.1[2,4]    270</span>
<span class="co">#&gt; d.1[3,4]    910</span>
<span class="co">#&gt; d.1[1,5]      1</span>
<span class="co">#&gt; d.1[2,5]    640</span>
<span class="co">#&gt; d.1[3,5]   3000</span>
<span class="co">#&gt; d.1[4,5]   3000</span>
<span class="co">#&gt; d.1[1,6]      1</span>
<span class="co">#&gt; d.1[2,6]    620</span>
<span class="co">#&gt; d.1[3,6]   2200</span>
<span class="co">#&gt; d.1[4,6]   3000</span>
<span class="co">#&gt; d.1[5,6]   1600</span>
<span class="co">#&gt; d.1[6,6]   2200</span>
<span class="co">#&gt; d.1[1,7]      1</span>
<span class="co">#&gt; d.1[2,7]   3000</span>
<span class="co">#&gt; d.1[3,7]   1900</span>
<span class="co">#&gt; d.1[1,8]      1</span>
<span class="co">#&gt; d.1[2,8]   1100</span>
<span class="co">#&gt; d.1[3,8]    450</span>
<span class="co">#&gt; d.1[4,8]   1300</span>
<span class="co">#&gt; sd          190</span>
<span class="co">#&gt; totresdev   260</span>
<span class="co">#&gt; deviance    240</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; For each parameter, n.eff is a crude measure of effective sample size,</span>
<span class="co">#&gt; and Rhat is the potential scale reduction factor (at convergence, Rhat=1).</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; DIC info (using the rule, pD = var(deviance)/2)</span>
<span class="co">#&gt; pD = 127.0 and DIC = 1217.9</span>
<span class="co">#&gt; DIC is an estimate of expected predictive error (lower deviance is better).</span></code></pre></div>
<p>In the output from non-parametric models, <code>d.1</code> parameters represent the relative effect for each treatment (specific dose of a specific agent) versus the reference treatment, similar to in a standard Network Meta-Analysis. The first index of <code>d</code> represents the dose identifier, and the second index represents the agent identifier. Information on the specific values of the doses is not included in the model, as only the ordering of them (lowest to highest) is important.</p>
<p>Note that some post-estimation functions (e.g. ranking, prediction) cannot be performed on non-parametric models within the package.</p>
</div>
</div>
<div class="section level2">
<h2 id="post-estimation">Post-Estimation<a class="anchor" aria-label="anchor" href="#post-estimation"></a>
</h2>
<p>For looking at post-estimation in MBNMA we will demonstrate using results from an Emax MBNMA on the triptans dataset unless specified otherwise:</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tripnet</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mbnma.network.html">mbnma.network</a></span><span class="op">(</span><span class="va">triptans</span><span class="op">)</span>
<span class="co">#&gt; Values for `agent` with dose = 0 have been recoded to `Placebo`</span>
<span class="co">#&gt; agent is being recoded to enforce sequential numbering and allow inclusion of `Placebo`</span>
<span class="va">trip.emax</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mbnma.run.html">mbnma.run</a></span><span class="op">(</span><span class="va">tripnet</span>, fun<span class="op">=</span><span class="fu"><a href="../reference/demax.html">demax</a></span><span class="op">(</span>emax<span class="op">=</span><span class="st">"rel"</span>, ed50<span class="op">=</span><span class="st">"rel"</span><span class="op">)</span><span class="op">)</span> 
<span class="co">#&gt; 'ed50' parameters are on exponential scale to ensure they take positive values on the natural scale</span>
<span class="co">#&gt; `likelihood` not given by user - set to `binomial` based on data provided</span>
<span class="co">#&gt; `link` not given by user - set to `logit` based on assigned value for `likelihood`</span></code></pre></div>
<div class="section level3">
<h3 id="deviance-plots">Deviance plots<a class="anchor" aria-label="anchor" href="#deviance-plots"></a>
</h3>
<p>To assess how well a model fits the data, it can be useful to look at a plot of the contributions of each data point to the residual deviance. This can be done using <code><a href="../reference/devplot.html">devplot()</a></code>. As individual deviance contributions are not automatically monitored in <code>parameters.to.save</code>, this might require the model to be automatically run for additional iterations.</p>
<p>Results can be plotted either as a scatter plot (<code>plot.type="scatter"</code>) or a series of boxplots (<code>plot.type="box"</code>).</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Plot boxplots of residual deviance contributions (scatterplot is the default)</span>
<span class="fu"><a href="../reference/devplot.html">devplot</a></span><span class="op">(</span><span class="va">trip.emax</span>, plot.type <span class="op">=</span> <span class="st">"box"</span><span class="op">)</span>
<span class="co">#&gt; `resdev` not monitored in mbnma$parameters.to.save.</span>
<span class="co">#&gt; additional iterations will be run in order to obtain results for `resdev`</span></code></pre></div>
<p><img src="mbnmadose_files/figure-html/unnamed-chunk-31-1.png" width="672"></p>
<p>From these plots we can see that whilst the model fit does not seem to be systematically non-linear (which would suggest an alternative dose-response function may be a better fit), residual deviance is high at a dose of 1 for eletriptan, and at 2 for sumatriptan. This may indicate that fitting random effects may allow for additional variability in response which may improve the model fit.</p>
<p>If saved to an object, the output of <code><a href="../reference/devplot.html">devplot()</a></code> contains the results for individual deviance contributions, and this can be used to identify any extreme outliers.</p>
</div>
<div class="section level3">
<h3 id="fitted-values">Fitted values<a class="anchor" aria-label="anchor" href="#fitted-values"></a>
</h3>
<p>Another approach for assessing model fit can be to plot the fitted values, using <code><a href="../reference/fitplot.html">fitplot()</a></code>. As with <code><a href="../reference/devplot.html">devplot()</a></code>, this may require running additional model iterations to monitor <code>theta</code>.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Plot fitted and observed values with treatment labels</span>
<span class="fu"><a href="../reference/fitplot.html">fitplot</a></span><span class="op">(</span><span class="va">trip.emax</span><span class="op">)</span>
<span class="co">#&gt; `theta` not monitored in mbnma$parameters.to.save.</span>
<span class="co">#&gt; additional iterations will be run in order to obtain results</span></code></pre></div>
<p><img src="mbnmadose_files/figure-html/unnamed-chunk-32-1.png" width="672"></p>
<p>Fitted values are plotted as connecting lines and observed values in the original dataset are plotted as points. These plots can be used to identify if the model fits the data well for different agents and at different doses along the dose-response function.</p>
</div>
<div class="section level3">
<h3 id="forest-plots">Forest plots<a class="anchor" aria-label="anchor" href="#forest-plots"></a>
</h3>
<p>Forest plots can be easily generated from MBNMA models using the <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code> method on an <code>"mbnma"</code> object. By default this will plot a separate panel for each dose-response parameter in the model. Forest plots can only be generated for parameters which are modelled using relative effects and that vary by agent/class.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">trip.emax</span><span class="op">)</span></code></pre></div>
<p><img src="mbnmadose_files/figure-html/unnamed-chunk-33-1.png" width="672"></p>
</div>
<div class="section level3">
<h3 id="estimating-relative-effects">Estimating relative effects<a class="anchor" aria-label="anchor" href="#estimating-relative-effects"></a>
</h3>
<p>It may be of interest to calculate relative effects between different doses of agents to obtain outputs that are more similar to those from standard NMA. Relative effects can take the form of odds ratios, mean differences or rate ratios, depending on the likelihood and link function used in a model. Estimating relative effects can be particularly helpful for dose-response functions where parameter interpretation can be challenging (e.g. splines, fractional polynomials).</p>
<p>The <code><a href="../reference/get.relative.html">get.relative()</a></code> function allows for calculation of relative effects between any doses of agents as specified by the user. This includes doses not available in the original dataset, as these can be estimated via the dose-response relationship. Optional arguments allow for calculation of 95% prediction intervals rather than 95% credible intervals (the default), and for the conversion of results from the log to the natural scale. The resulting relative effects can also be ranked (see <a href="#ranking">Ranking</a> for more details).</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Specify treatments (agents and doses) for which to estimate relative effects</span>
<span class="va">treats</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"Placebo"</span><span class="op">=</span><span class="fl">0</span>,
               <span class="st">"eletriptan"</span><span class="op">=</span> <span class="fl">1</span>,
               <span class="st">"sumatriptan"</span><span class="op">=</span><span class="fl">2</span>,
               <span class="st">"almotriptan"</span><span class="op">=</span><span class="fl">1</span><span class="op">)</span>

<span class="co"># Print relative effects on the natural scale</span>
<span class="va">rels</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get.relative.html">get.relative</a></span><span class="op">(</span><span class="va">trip.emax</span>, treatments <span class="op">=</span> <span class="va">treats</span>, eform<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">rels</span><span class="op">)</span>
<span class="co">#&gt; <span style="font-weight: bold;">============================================================</span></span>
<span class="co"><span style="font-weight: bold;">#&gt; Relative treatment comparisons (95% credible intervals)</span></span>
<span class="co"><span style="font-weight: bold;">#&gt; ============================================================</span></span>
<span class="co"><span style="font-weight: bold;">#&gt; </span></span>
<span class="co">#&gt;     Placebo_0     0.18 (0.16, 0.21) 0.25 (0.22, 0.27) 0.36 (0.31, 0.42)</span>
<span class="co">#&gt;  5.5 (4.8, 6.3)     eletriptan_1     1.4 (1.2, 1.6)     2 (1.7, 2.4)   </span>
<span class="co">#&gt;   4 (3.6, 4.5)    0.74 (0.64, 0.85)   sumatriptan_2    1.5 (1.2, 1.7)  </span>
<span class="co">#&gt;  2.8 (2.4, 3.2)    0.5 (0.42, 0.6)  0.68 (0.59, 0.8)    almotriptan_1</span>

<span class="co"># Rank relative effects</span>
<span class="fu"><a href="../reference/rank.html">rank</a></span><span class="op">(</span><span class="va">rels</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co"><span style="font-weight: bold;">#&gt; ================================</span></span>
<span class="co"><span style="font-weight: bold;">#&gt; Ranking of dose-response MBNMA</span></span>
<span class="co"><span style="font-weight: bold;">#&gt; ================================</span></span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Includes ranking of relative effects between treatments from dose-response MBNMA</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; 4 agents/classes/predictions ranked with negative responses being <span style="color: #BB0000; font-weight: bold;">`worse`</span></span>
<span class="co">#&gt; </span>
<span class="co">#&gt; <span style="font-weight: bold; text-decoration: underline;">Relative Effects ranking</span> (from best to worst)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; |Treatment     | Mean| Median| 2.5%| 97.5%|</span>
<span class="co">#&gt; |:-------------|----:|------:|----:|-----:|</span>
<span class="co">#&gt; |Placebo_0     |    1|      1|    1|     1|</span>
<span class="co">#&gt; |almotriptan_1 |    2|      2|    2|     2|</span>
<span class="co">#&gt; |sumatriptan_2 |    3|      3|    3|     3|</span>
<span class="co">#&gt; |eletriptan_1  |    4|      4|    4|     4|</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="ranking">Ranking<a class="anchor" aria-label="anchor" href="#ranking"></a>
</h3>
<p>Rankings can be calculated for different dose-response parameters from MBNMA models by using <code><a href="../reference/rank.html">rank()</a></code> on an <code>"mbnma"</code> object. Any parameter monitored in an MBNMA model that varies by agent/class can be ranked. A vector of these is assigned to <code>params</code>. <code>lower_better</code> indicates whether negative responses should be ranked as “better” (<code>TRUE</code>) or “worse” (<code>FALSE</code>).</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ranks</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rank.html">rank</a></span><span class="op">(</span><span class="va">trip.emax</span>, lower_better <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">ranks</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co"><span style="font-weight: bold;">#&gt; ================================</span></span>
<span class="co"><span style="font-weight: bold;">#&gt; Ranking of dose-response MBNMA</span></span>
<span class="co"><span style="font-weight: bold;">#&gt; ================================</span></span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Includes ranking of relative effects from dose-response MBNMA:</span>
<span class="co">#&gt; <span style="font-weight: bold;">emax ed50</span></span>
<span class="co">#&gt; </span>
<span class="co">#&gt; 7 agents/classes/predictions ranked with positive responses being <span style="color: #00BB00; font-weight: bold;">`better`</span></span>
<span class="co">#&gt; </span>
<span class="co">#&gt; <span style="font-weight: bold; text-decoration: underline;">emax ranking</span> (from best to worst)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; |Treatment    | Mean| Median| 2.5%| 97.5%|</span>
<span class="co">#&gt; |:------------|----:|------:|----:|-----:|</span>
<span class="co">#&gt; |naratriptan  | 1.14|      1|    1|     3|</span>
<span class="co">#&gt; |sumatriptan  | 2.88|      3|    2|     5|</span>
<span class="co">#&gt; |almotriptan  | 3.56|      3|    2|     7|</span>
<span class="co">#&gt; |frovatriptan | 3.73|      4|    1|     7|</span>
<span class="co">#&gt; |zolmitriptan | 4.35|      4|    2|     7|</span>
<span class="co">#&gt; |rizatriptan  | 5.88|      6|    4|     7|</span>
<span class="co">#&gt; |eletriptan   | 6.46|      7|    5|     7|</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; <span style="font-weight: bold; text-decoration: underline;">ed50 ranking</span> (from best to worst)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; |Treatment    | Mean| Median| 2.5%| 97.5%|</span>
<span class="co">#&gt; |:------------|----:|------:|----:|-----:|</span>
<span class="co">#&gt; |eletriptan   | 2.60|      2|    1|     6|</span>
<span class="co">#&gt; |sumatriptan  | 2.98|      3|    1|     6|</span>
<span class="co">#&gt; |rizatriptan  | 3.40|      3|    1|     7|</span>
<span class="co">#&gt; |frovatriptan | 3.94|      4|    1|     7|</span>
<span class="co">#&gt; |zolmitriptan | 4.33|      5|    1|     7|</span>
<span class="co">#&gt; |naratriptan  | 5.34|      6|    1|     7|</span>
<span class="co">#&gt; |almotriptan  | 5.41|      6|    1|     7|</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">ranks</span><span class="op">)</span>
<span class="co">#&gt; $emax</span>
<span class="co">#&gt;     rank.param     mean        sd 2.5% 25% 50% 75% 97.5%</span>
<span class="co">#&gt; 1   eletriptan 6.456667 0.7382212    5   6   7   7     7</span>
<span class="co">#&gt; 2  sumatriptan 2.882667 0.9006497    2   2   3   3     5</span>
<span class="co">#&gt; 3 frovatriptan 3.731667 1.5609215    1   2   4   5     7</span>
<span class="co">#&gt; 4  almotriptan 3.557000 1.4443383    2   2   3   5     7</span>
<span class="co">#&gt; 5 zolmitriptan 4.349000 1.1881370    2   4   4   5     7</span>
<span class="co">#&gt; 6  naratriptan 1.144000 0.6224091    1   1   1   1     3</span>
<span class="co">#&gt; 7  rizatriptan 5.879000 0.9818420    4   5   6   7     7</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $ed50</span>
<span class="co">#&gt;     rank.param     mean       sd 2.5% 25% 50% 75% 97.5%</span>
<span class="co">#&gt; 1   eletriptan 2.603333 1.409013    1   1   2   4     6</span>
<span class="co">#&gt; 2  sumatriptan 2.982000 1.525708    1   2   3   4     6</span>
<span class="co">#&gt; 3 frovatriptan 3.935333 2.007941    1   2   4   6     7</span>
<span class="co">#&gt; 4  almotriptan 5.409333 1.601239    1   5   6   7     7</span>
<span class="co">#&gt; 5 zolmitriptan 4.332333 1.785390    1   3   5   6     7</span>
<span class="co">#&gt; 6  naratriptan 5.342000 1.876933    1   4   6   7     7</span>
<span class="co">#&gt; 7  rizatriptan 3.395667 1.770167    1   2   3   5     7</span></code></pre></div>
<p>The output is an object of <code>class("mbnma.rank")</code>, containing a list for each ranked parameter in <code>params</code>, which consists of a summary table of rankings and raw information on agent/class (depending on argument given to <code>level</code>) ranking and probabilities. The summary median ranks with 95% credible intervals can be simply displayed using <code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code>.</p>
<p>Histograms for ranking results can also be plotted using the <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code> method, which takes the raw MCMC ranking results stored in <code>mbnma.rank</code> and plots the number of MCMC iterations the parameter value for each treatment was ranked a particular position.</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Ranking histograms for Emax</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">ranks</span>, params <span class="op">=</span> <span class="st">"emax"</span><span class="op">)</span></code></pre></div>
<p><img src="mbnmadose_files/figure-html/unnamed-chunk-36-1.png" width="672"></p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="co"># Ranking histograms for ED50</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">ranks</span>, params <span class="op">=</span> <span class="st">"ed50"</span><span class="op">)</span></code></pre></div>
<p><img src="mbnmadose_files/figure-html/unnamed-chunk-36-2.png" width="672"></p>
<p>Alternatively, cumulative ranking plots for all parameters can be plotted simultaneously so as to be able to compare the effectiveness of different agents on different parameters. The surface under cumulative ranking curve (SUCRA) for each parameter can also be estimated by setting <code>sucra=TRUE</code>.</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Cumulative ranking plot for both dose-response parameters</span>
<span class="fu"><a href="../reference/cumrank.html">cumrank</a></span><span class="op">(</span><span class="va">ranks</span>, sucra<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p><img src="mbnmadose_files/figure-html/unnamed-chunk-37-1.png" width="672"></p>
<pre><code><span class="co">#&gt; <span style="color: #949494;"># A tibble: 14 × 3</span></span>
<span class="co">#&gt;    agent        parameter sucra</span>
<span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> eletriptan   ed50       4.76</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> eletriptan   emax       1.04</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> sumatriptan  ed50       4.42</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> sumatriptan  emax       4.61</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> frovatriptan ed50       3.48</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> frovatriptan emax       3.76</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> almotriptan  ed50       2.08</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> almotriptan  emax       3.93</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> zolmitriptan ed50       3.12</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">10</span> zolmitriptan emax       3.15</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">11</span> naratriptan  ed50       2.13</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">12</span> naratriptan  emax       5.89</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">13</span> rizatriptan  ed50       4.01</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">14</span> rizatriptan  emax       1.62</span></code></pre>
</div>
<div class="section level3">
<h3 id="prediction">Prediction<a class="anchor" aria-label="anchor" href="#prediction"></a>
</h3>
<p>After performing an MBNMA, responses can be predicted from the model parameter estimates using <code><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict()</a></code> on an <code>"mbnma"</code> object. A number of important arguments should be specified for prediction. See <code><a href="../reference/predict.mbnma.html">?predict.mbnma</a></code> for detailed specification of these arguments.</p>
<p><code>E0</code> This is the response at dose = 0 (equivalent to the placebo response). Since relative effects are the parameters estimated in MBNMA, the placebo response is not explicitly modelled and therefore must be provided by the user in some way. The simplest approach is to provide either a single numeric value for <code>E0</code> (deterministic approach), or a string representing a distribution for <code>E0</code> that can take any Random Number Generator (RNG) distribution for which a function exists in R (stochastic approach). Values should be given on the natural scale. For example for a binomial outcome:</p>
<ul>
<li>Deterministic: <code>E0 &lt;- 0.2</code>
</li>
<li>Stochastic: <code>E0 &lt;- "rbeta(n, shape1=2, shape2=10)"</code>
</li>
</ul>
<p>Another approach is to estimate <code>E0</code> from a set of studies. These would ideally be studies of untreated/placebo-treated patients that closely resemble the population for which predictions are desired, and the studies may be observational. However, synthesising results from the placebo arms of trials in the original network is also possible. For this, <code>E0</code> is assigned a data frame of studies in the long format (one row per study arm) with the variables <code>studyID</code>, and a selection of <code>y</code>, <code>se</code>, <code>r</code>, <code>n</code> and <code>E</code> (depending on the likelihood used in the MBNMA model). <code>synth</code> can be set to <code>"fixed"</code> or <code>"random"</code> to indicate whether this synthesis should be fixed or random effects.</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">E0</span> <span class="op">&lt;-</span> <span class="va">triptans</span><span class="op">[</span><span class="va">triptans</span><span class="op">$</span><span class="va">dose</span><span class="op">==</span><span class="fl">0</span>,<span class="op">]</span></code></pre></div>
<p>Additionally, it’s also necessary to specify the doses at which to predict responses. By default, <code><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict()</a></code> uses the maximum dose within the dataset for each agent, and predicts doses at a series of cut points. The number of cut points can be specified using <code>n.doses</code>, and the maximum dose to use for prediction for each agent can also be specified using <code>max.doses</code> (a named list of numeric values where element names correspond to agent names).</p>
<p>An alternative approach is to predict responses at specific doses for specific agents using the argument <code>exact.doses</code>. As with <code>max.doses</code>, this is a named list in which element names correspond to agent names, but each element is a numeric vector in which each value within the vector is a dose at which to predict a response for the given agent.</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Predict 20 doses for each agent, with a stochastic distribution for E0</span>
<span class="va">doses</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"Placebo"</span><span class="op">=</span><span class="fl">0</span>, 
                  <span class="st">"eletriptan"</span><span class="op">=</span><span class="fl">3</span>,
                  <span class="st">"sumatriptan"</span><span class="op">=</span><span class="fl">3</span>,
                  <span class="st">"almotriptan"</span><span class="op">=</span><span class="fl">3</span>,
                  <span class="st">"zolmitriptan"</span><span class="op">=</span><span class="fl">3</span>,
                  <span class="st">"naratriptan"</span><span class="op">=</span><span class="fl">3</span>,
                  <span class="st">"rizatriptan"</span><span class="op">=</span><span class="fl">3</span><span class="op">)</span>

<span class="va">pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">trip.emax</span>, E0<span class="op">=</span><span class="st">"rbeta(n, shape1=2, shape2=10)"</span>,
                      max.doses<span class="op">=</span><span class="va">doses</span>, n.dose<span class="op">=</span><span class="fl">20</span><span class="op">)</span>


<span class="co"># Predict exact doses for two agents, and estimate E0 from the data</span>
<span class="va">E0.data</span> <span class="op">&lt;-</span> <span class="va">triptans</span><span class="op">[</span><span class="va">triptans</span><span class="op">$</span><span class="va">dose</span><span class="op">==</span><span class="fl">0</span>,<span class="op">]</span>
<span class="va">doses</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"eletriptan"</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">3</span><span class="op">)</span>,
                  <span class="st">"sumatriptan"</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">3</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">trip.emax</span>, E0<span class="op">=</span><span class="va">E0.data</span>,
                      exact.doses<span class="op">=</span><span class="va">doses</span><span class="op">)</span>
<span class="co">#&gt; Values for `agent` with dose = 0 have been recoded to `Placebo`</span>
<span class="co">#&gt; agent is being recoded to enforce sequential numbering and allow inclusion of `Placebo`</span></code></pre></div>
<p>An object of class <code>"mbnma.predict"</code> is returned, which is a list of summary tables and MCMC prediction matrices for each treatment (combination of dose and agent). The <code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code> method can be used to print mean posterior predictions at each time point for each treatment.</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">pred</span><span class="op">)</span>
<span class="co">#&gt;         agent dose      mean          sd      2.5%       25%       50%</span>
<span class="co">#&gt; 1     Placebo    0 0.1239234 0.003314659 0.1175166 0.1216321 0.1238544</span>
<span class="co">#&gt; 2  eletriptan    0 0.1239234 0.003314659 0.1175166 0.1216321 0.1238544</span>
<span class="co">#&gt; 3  eletriptan    1 0.4372192 0.018748568 0.4015645 0.4241595 0.4370961</span>
<span class="co">#&gt; 4  eletriptan    3 0.5554795 0.025962306 0.5048505 0.5382250 0.5544769</span>
<span class="co">#&gt; 5 sumatriptan    0 0.1239234 0.003314659 0.1175166 0.1216321 0.1238544</span>
<span class="co">#&gt; 6 sumatriptan    3 0.3878595 0.017311905 0.3545228 0.3761121 0.3879320</span>
<span class="co">#&gt;         75%     97.5%</span>
<span class="co">#&gt; 1 0.1261965 0.1303876</span>
<span class="co">#&gt; 2 0.1261965 0.1303876</span>
<span class="co">#&gt; 3 0.4501417 0.4742725</span>
<span class="co">#&gt; 4 0.5731223 0.6070183</span>
<span class="co">#&gt; 5 0.1261965 0.1303876</span>
<span class="co">#&gt; 6 0.3992613 0.4228987</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="plotting-predicted-responses">Plotting predicted responses<a class="anchor" aria-label="anchor" href="#plotting-predicted-responses"></a>
</h3>
<p>Predicted responses can also be plotted using the <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code> method on an object of <code>class("mbnma.predict")</code>. The predicted responses are joined by a line to form the dose-response curve for each agent predicted, with 95% credible intervals (CrI). Therefore, when plotting the response it is important to predict a sufficient number of doses (using <code>n.doses</code>) to get a smooth curve.</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Predict responses using default doses up to the maximum of each agent in the dataset</span>
<span class="va">pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">trip.emax</span>, E0<span class="op">=</span><span class="fl">0.2</span>, n.dose<span class="op">=</span><span class="fl">20</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">pred</span><span class="op">)</span></code></pre></div>
<p><img src="mbnmadose_files/figure-html/unnamed-chunk-42-1.png" width="672"></p>
<p>Shaded counts of the number of studies in the original dataset that investigate each dose of an agent can be plotted over the 95% CrI for each treatment by setting <code>disp.obs = TRUE</code>, though this requires that the original <code>"mbnma.network"</code> object used to estimate the MBNMA be provided via <code>network</code>.</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">pred</span>, disp.obs <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="co">#&gt; 66 placebo arms in the dataset are not shown within the plots</span></code></pre></div>
<p><img src="mbnmadose_files/figure-html/unnamed-chunk-43-1.png" width="672"></p>
<p>This can be used to identify any extrapolation/interpretation of the dose-response that might be occurring for a particular agent. As you can see, more observations typically leads to tighter 95% CrI for the predicted response at a particular point along the dose-response curve.</p>
<p>We can also plot the results of a “split” Network Meta-Analysis (NMA) in which all doses of an agent are assumed to be independent. As with <code>disp.obs</code> we also need to provide the original <code>mbnma.network</code> object to be able to estimate this, and we can also specify if we want to perform a common or random effects NMA using <code>method</code>. Treatments that are only connected to the network via the dose-response relationship (rather than by a direct head-to-head comparison) will not be included.</p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">alognet</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mbnma.network.html">mbnma.network</a></span><span class="op">(</span><span class="va">alog_pcfb</span><span class="op">)</span>
<span class="va">alog.emax</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mbnma.run.html">mbnma.run</a></span><span class="op">(</span><span class="va">alognet</span>, fun<span class="op">=</span><span class="fu"><a href="../reference/demax.html">demax</a></span><span class="op">(</span><span class="op">)</span>, method<span class="op">=</span><span class="st">"random"</span><span class="op">)</span>
<span class="va">pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">alog.emax</span>, E0<span class="op">=</span><span class="fl">0</span>, n.dose<span class="op">=</span><span class="fl">20</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">pred</span>, overlay.split <span class="op">=</span> <span class="cn">TRUE</span>, method<span class="op">=</span><span class="st">"random"</span><span class="op">)</span></code></pre></div>
<p><img src="mbnmadose_files/figure-html/unnamed-chunk-44-1.png" width="672"></p>
<p>By plotting these, as well as observing how responses can be extrapolated/interpolated, we can also see which doses are likely to be providing most information to the dose-response relationship. The tighter 95% CrI on the predicted responses from the MBNMA also show that modelling the dose-response function also gives some additional precision even at doses for which there is information available.</p>
<p>More detailed documentation can be accessed using <code><a href="../reference/plot.mbnma.predict.html">?plot.mbnma.predict</a></code>.</p>
</div>
<div class="section level3">
<h3 id="ranking-predicted-responses">Ranking predicted responses<a class="anchor" aria-label="anchor" href="#ranking-predicted-responses"></a>
</h3>
<p>Predicted responses from an object of <code>class("mbnma.predict")</code> can also be ranked using the <code><a href="../reference/rank.html">rank()</a></code> method. As when applied to an object of <code>class("mbnma")</code>, this method will rank parameters (in this case predictions) in order from either highest to lowest (<code>direction=1</code>) or lowest to highest (<code>direction=-1</code>), and return an object of <code>class("mbnma.rank")</code>.</p>
<p>If there have been predictions at dose = 0 for several agents only one of these will be included in the rankings, in order to avoid duplication (since the predicted response at dose = 0 is the same for all agents).</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">trip.emax</span>, E0<span class="op">=</span><span class="fl">0.2</span>, n.doses<span class="op">=</span><span class="fl">4</span>,
                max.doses <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"eletriptan"</span><span class="op">=</span><span class="fl">5</span>, <span class="st">"sumatriptan"</span><span class="op">=</span><span class="fl">5</span>, 
                              <span class="st">"frovatriptan"</span><span class="op">=</span><span class="fl">5</span>, <span class="st">"zolmitriptan"</span><span class="op">=</span><span class="fl">5</span><span class="op">)</span><span class="op">)</span>

<span class="va">ranks</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rank.html">rank</a></span><span class="op">(</span><span class="va">pred</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">ranks</span><span class="op">)</span></code></pre></div>
<p><img src="mbnmadose_files/figure-html/unnamed-chunk-45-1.png" width="672"></p>
</div>
</div>
<div class="section level2">
<h2 id="consistency-testing">Consistency Testing<a class="anchor" aria-label="anchor" href="#consistency-testing"></a>
</h2>
<p>When performing a MBNMA by pooling relative treatment effects, the modelling approach assumes consistency between direct and indirect evidence within a network. This is an incredibly useful assumption as it allows us to improve precision on existing direct estimates, or to estimate relative effects between treatments that have not been compared in head-to-head trials, by making use of indirect evidence.</p>
<p>However, if this assumption does not hold, this is extremely problematic for inference, so it is important to be able to test it. A number of different approaches exist to allow for this in standard Network Meta-Analysis (NMA) <span class="citation">(Dias et al. 2013)</span>, but within dose-response MBNMA there is added complexity because the consistency assumption can be conceptualised either for each treatment comparison (combination of dose and agent), or for each agent, where consistency is required for the agent-level parameters governing the dose-response relationship. A detailed description of consistency testing in MBNMA models is given in Pedder et al. <span class="citation">(2021)</span>.</p>
<p>Testing for consistency at the agent-level is challenging as there is unlikely to be the required data available to be able to do this - included studies in the dataset must have multiple doses of multiple agents, so that sufficient information is available to estimate dose-response parameters <em>within that study</em>. However, testing for consistency at the treatment-level is possible in MBNMA, and this is described below. In practice, testing for consistency at the treatment-level should suffice, as any inconsistency identified at the treatment level should also translate to inconsistency at the agent level and vice versa <span class="citation">(Pedder, Dias, Boucher, et al. 2021)</span>.</p>
<p>Consistency also depends on the functional form assumed for the dose-response relationship, and so is inextricably linked to model fit of the dose-response relationship. A thorough assessment of the validity of the fitted model is therefore important to be confident that the resulting treatment effect estimates provide a firm basis for decision making.</p>
<p>When meta-analysing dose-response studies, the potential for inconsistency testing may actually be reasonably rare, as most (if not all) trials will be multi-arm placebo-controlled. Since each study is internally consistent (the relative effects within the trial will always adhere to consistency relationships), there will be no closed loops of treatments that are informed by independent sources of evidence.</p>
<div class="section level3">
<h3 id="unrelated-mean-effects-ume-model-at-the-treatment-level">Unrelated Mean Effects (UME) model at the treatment level<a class="anchor" aria-label="anchor" href="#unrelated-mean-effects-ume-model-at-the-treatment-level"></a>
</h3>
<p>To check for consistency at the treatment level using UME we fit an NMA that does not assume consistency relationships, and that only models the direct relative effects between each arm in a study and the study reference treatment <span class="citation">(Dias et al. 2013)</span>. If the consistency assumption holds true then the results from the UME model and the NMA will be very similar. However, if there is a discrepancy between direct and indirect evidence in the network, then the consistency assumption may not be valid, and the UME results are likely differ in several ways:</p>
<ul>
<li>The UME model may provide a better fit to the data, as measured by residual deviance</li>
<li>The between-study SD for different parameters may be lower in the UME model</li>
<li>Individual relative effects may differ in magnitude or (more severely) in direction for different treatment comparisons between UME and NMA models.</li>
</ul>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Using the alogliptin dataset</span>
<span class="va">alognet</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mbnma.network.html">mbnma.network</a></span><span class="op">(</span><span class="va">alog_pcfb</span><span class="op">)</span>
<span class="va">nma</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nma.run.html">nma.run</a></span><span class="op">(</span><span class="va">alognet</span>, method<span class="op">=</span><span class="st">"random"</span><span class="op">)</span>
<span class="va">ume</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nma.run.html">nma.run</a></span><span class="op">(</span><span class="va">alognet</span>, method<span class="op">=</span><span class="st">"random"</span>, UME <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">Model</th>
<th align="right">Residual Deviance</th>
<th align="left">Betwen-study SD</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">NMA</td>
<td align="right">46.17</td>
<td align="left">0.12 (0.075, 0.18)</td>
</tr>
<tr class="even">
<td align="left">UME</td>
<td align="right">45.76</td>
<td align="left">0.14 (0.087, 0.21)</td>
</tr>
</tbody>
</table>
<p>As both the residual deviances and between-study SDs are similar, this would suggest that there is no evidence of inconsistency in this network, though comparing results for individual comparisons from the models can also be useful.</p>
<p>Deviance-deviance plots <span class="citation">(Dias et al. 2013)</span> can be compared between different models to investigate the fit of different data points. This can be done for two different models at a time using <code><a href="../reference/devdev.html">devdev()</a></code>:</p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Compares residual deviance contributions from NMA and UME models</span>
<span class="fu"><a href="../reference/devdev.html">devdev</a></span><span class="op">(</span><span class="va">nma</span>, <span class="va">ume</span>, dev.type<span class="op">=</span><span class="st">"resdev"</span><span class="op">)</span></code></pre></div>
<p><img src="mbnmadose_files/figure-html/unnamed-chunk-48-1.png" width="672"></p>
<p>In Pedder et al. <span class="citation">(2021)</span> we suggest comparing the following models using these plots to evaluate consistency in MBNMA:</p>
<ol style="list-style-type: decimal">
<li>Selected dose-response MBNMA model</li>
<li>Treatment-level NMA model (using same common/random treatment effects as for the MBNMA)</li>
<li>Treatment-level UME model (using same common/random treatment effects as for the MBNMA)</li>
</ol>
<p>Differences in deviance contributions between models 1 and 2 will highlight data points which may fit the dose-response relationship poorly. Difference in deviance contributions between models 2 and 3 will highlight data points which are suggestive of inconsistency.</p>
</div>
<div class="section level3">
<h3 id="node-splitting-at-the-treatment-level">Node-splitting at the treatment level<a class="anchor" aria-label="anchor" href="#node-splitting-at-the-treatment-level"></a>
</h3>
<p>Another approach for consistency checking is node-splitting. This splits contributions for a particular treatment comparison into direct and indirect evidence, and the two can then be compared to test their similarity <span class="citation">(Valkenhoef et al. 2016)</span>. Node-splitting in dose-response MBNMA is an extension to this method, as indirect evidence contributions can be calculated incorporating the dose-response function. <code><a href="../reference/mbnma.nodesplit.html">mbnma.nodesplit()</a></code> takes similar arguments to <code><a href="../reference/mbnma.run.html">mbnma.run()</a></code>, and returns an object of <code>class("nodesplit")</code>.</p>
<p>In addition to these, the argument <code>comparisons</code> can be used to indicate which treatment comparisons to perform a nodesplit on. If left as <code>NULL</code> (the default) node-splits will automatically be performed in all closed loops of treatments in which comparisons are informed by independent sources of evidence. This is somewhat similar to the function <code>gemtc::mtc.nodesplit.comparisons()</code>, but uses a fixed network reference treatment and therefore ensures differences between direct and indirect evidence are parameterised as inconsistency rather than as heterogeneity <span class="citation">(Dias et al. 2013)</span>. However, it also allows for indirect evidence to be informed via the dose-response relationship even if there is no pathway of evidence between the treatments, which can in fact lead to additional potentially inconsistent loops. To incorporate indirect evidence in this way <code>incldr=TRUE</code> can be set in <code><a href="../reference/inconsistency.loops.html">inconsistency.loops()</a></code>, the default when using <code><a href="../reference/mbnma.nodesplit.html">mbnma.nodesplit()</a></code></p>
<p>The complexity of the dose-response relationship fitted and the amount of indirect evidence available will also affect the number of comparisons on which node-splitting is possible <span class="citation">(Pedder, Dias, Boucher, et al. 2021)</span>. If there is only limited indirect dose-response information for a given comparison (e.g. only two doses available for the agents in the comparison), then only a simpler dose-response function (e.g. exponential) can be fitted. The values given in <code>inconsistency.loops()$path</code> can give an indication as to the number of doses available for each comparison. For example, <code>drparams 3 4</code> would indicate that the indirect evidence is estimated only via the dose-response relationship, and that within the indirect evidence there are three doses available for estimating the dose-response of the agent in <code>t1</code> of the comparison, and four doses available for estimating the dose-responses of the agent in <code>t2</code> of the comparison. This means that a three-parameter dose-response function would be the most complex function that could be used when node-splitting this comparison.</p>
<p>As several models have to be run for each closed loop of treatments, node-splitting can take some time to run, and it therefore is not shown for the purposes of this vignette.</p>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Using the psoriasis dataset (&gt;75% improvement in PASI score)</span>
<span class="va">psoriasis</span><span class="op">$</span><span class="va">r</span> <span class="op">&lt;-</span> <span class="va">psoriasis</span><span class="op">$</span><span class="va">r75</span>
<span class="va">psorinet</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mbnma.network.html">mbnma.network</a></span><span class="op">(</span><span class="va">psoriasis</span><span class="op">)</span>

<span class="co"># Identify comparisons on which node-splitting is possible</span>
<span class="va">splitcomps</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/inconsistency.loops.html">inconsistency.loops</a></span><span class="op">(</span><span class="va">psorinet</span><span class="op">$</span><span class="va">data.ab</span>, incldr<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">splitcomps</span><span class="op">)</span>

<span class="co"># If we want to fit an Emax dose-response function, there is insufficient</span>
<span class="co">#indirect evidence in all but the first 6 comparisons</span>
<span class="va">nodesplit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mbnma.nodesplit.html">mbnma.nodesplit</a></span><span class="op">(</span><span class="va">psorinet</span>, fun<span class="op">=</span><span class="fu"><a href="../reference/demax.html">demax</a></span><span class="op">(</span><span class="op">)</span>, comparisons<span class="op">=</span><span class="va">splitcomps</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">6</span>,<span class="op">]</span>, method<span class="op">=</span><span class="st">"common"</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">nodesplit</span><span class="op">)</span></code></pre></div>
<p>Performing the <code><a href="https://rdrr.io/r/base/print.html" class="external-link">print()</a></code> method on an object of <code>class("nodesplit")</code> prints a summary of the node-split results to the console, whilst the <code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code> method will return a data frame of posterior summaries for direct and indirect estimates for each split treatment comparison.</p>
<p>The nodesplit object itself is a list with results for each treatment comparison that has been split. There is a lot of information within the results, but the most useful (and easily interpretable) elements are:</p>
<ul>
<li>
<code>p.values</code> the Bayesian p-value for the posterior overlap between direct and indirect estimates</li>
<li>
<code>quantiles</code> the median and 95%CrI of the posterior distributions for direct and indirect evidence, and for the difference between them.</li>
<li>
<code>forest.plot</code> a forest plot that shows the median and 95% CrI for direct and indirect estimates</li>
<li>
<code>density.plot</code> a plot that shows the posterior distributions for direct and indirect estimates</li>
</ul>
<p>It is possible to generate different plots of each nodesplit comparison using <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code>:</p>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Plot forest plots of direct, indirect and pooled (MBNMA) results for each comparison</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">nodesplit</span>, plot.type<span class="op">=</span><span class="st">"forest"</span><span class="op">)</span>

<span class="co"># Plot posterior densities of direct and indirect results for each nodesplit comparisons</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">nodesplit</span>, plot.type<span class="op">=</span><span class="st">"density"</span><span class="op">)</span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="mcmc-convergence">MCMC Convergence<a class="anchor" aria-label="anchor" href="#mcmc-convergence"></a>
</h2>
<p><code>MBNMAdose</code> runs Bayesian models in JAGS, which uses Markov Chain Monte Carlo (MCMC) simulation. However, the validity of results is reliant on the MCMC chains having converged successfully on the posterior densities of all parameters in the model. For highly parameterised models run on relatively limited data, as is often the case with MBNMA models, convergence can often be an challenge. Note that convergence is <em>necessary</em> to be able to compare models and evaluate model fit. However, successful convergence <em>does not</em> imply good model fit.</p>
<p>A full explanation of how to facilitate and to check for convergence is outside the scope of this vignette, but below are some simple steps for checking convergence. None of these steps alone ensures convergence has been successful, but interpretation of them jointly can provide strong evidence of it.</p>
<ul>
<li>Rhat values close to 1 (&lt;1.1 is considered acceptable by some). These are shown for monitored parameters in the summary statistics table when an <code>"mbnma"</code> or <code>"nma"</code> object is printed.</li>
<li>Trace plots that have a “fuzzy caterpillar” look that shows good mixing of MCMC chains</li>
<li>Density plots that show a smooth posterior distribution that is similar across all chains</li>
<li>Autocorrelation plots that show low autocorrelation between neighbouring MCMC iterations (i.e. low correlation at higher lags)</li>
</ul>
<p>An HTML document with all the above convergence plots can easily be generated for all parameters in the model simultaneously using <code><a href="https://rdrr.io/pkg/mcmcplots/man/mcmcplot.html" class="external-link">mcmcplots::mcmcplot()</a></code>.</p>
<p>Two steps may improve convergence when using <code>MBNMAdose</code>. One step is to run models for more iterations (this can be done using the <code>n.iter</code> argument in <code><a href="../reference/mbnma.run.html">mbnma.run()</a></code>). It can take time for MCMC chains to converge, particularly for non-linear models with limited data. It is important to note that chains should only be monitored <em>after</em> they have converged - increasing the number of burn-in iterations ensures that this is the case (using the <code>n.burnin</code> argument in <code><a href="../reference/mbnma.run.html">mbnma.run()</a></code>). Another method to improve convergence is by providing more information to the model via informative priors.</p>
</div>
<div class="section level2">
<h2 id="summary">Summary<a class="anchor" aria-label="anchor" href="#summary"></a>
</h2>
<p><code>MBNMAdose</code> provides a complete set of functions that allow for performing dose-response MBNMA, model checking, prediction, and plotting of a number of informative graphics. By modelling a dose-response relationship within the network meta-analysis framework, this method can help connect networks of evidence that might otherwise be disconnected, allow extrapolation and interpolation of dose-response, and improve precision on predictions and relative effects between agents.</p>
<p>The package allows a range of dose-response functions (as well as the possibility to incorporate user-defined functions) and facilitates model specification in a way which allows users to make additional modelling assumptions to help identify parameters.</p>
</div>
<div class="section level2 unnumbered">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references">
<div id="ref-dias2013">
<p>Dias, S., N. J. Welton, A. J. Sutton, D. M. Caldwell, G. Lu, and A. E. Ades. 2013. “Evidence Synthesis for Decision Making 4: Inconsistency in Networks of Evidence Based on Randomized Controlled Trials.” Journal Article. <em>Med Decis Making</em> 33 (5): 641–56. <a href="https://doi.org/10.1177/0272989X12455847" class="external-link">https://doi.org/10.1177/0272989X12455847</a>.</p>
</div>
<div id="ref-furukawa2019">
<p>Furukawa, T. A., A. Cipriani, P. J. Cowen, S. Leucht, M. Egger, and G. Salanti. 2019. “Optimal Dose of Selective Serotonin Reuptake Inhibitors, Venlafaxine, and Mirtazapine in Major Depression: A Systematic Review and Dose-Response Meta-Analysis.” Journal Article. <em>Lancet Psychiatry</em> 6: 601–9.</p>
</div>
<div id="ref-gelman2014">
<p>Gelman, Andrew, Jessica Hwang, and Aki Vehtari. 2014. “Understanding Predictive Information Criteria for Bayesian Models.” Journal Article. <em>Statistics and Computing</em> 24 (6): 997–1016. <a href="https://doi.org/10.1007/s11222-013-9416-2" class="external-link">https://doi.org/10.1007/s11222-013-9416-2</a>.</p>
</div>
<div id="ref-jags">
<p>JAGS Computer Program. 2017. <a href="https://mcmc-jags.sourceforge.io/" class="external-link">https://mcmc-jags.sourceforge.io/</a>.</p>
</div>
<div id="ref-langford2016">
<p>Langford, O., J. K. Aronson, G. van Valkenhoef, and R. J. Stevens. 2016. “Methods for Meta-Analysis of Pharmacodynamic Dose-Response Data with Application to Multi-Arm Studies of Alogliptin.” Journal Article. <em>Stat Methods Med Res</em>. <a href="https://doi.org/10.1177/0962280216637093" class="external-link">https://doi.org/10.1177/0962280216637093</a>.</p>
</div>
<div id="ref-lu2004">
<p>Lu, G., and A. E. Ades. 2004. “Combination of Direct and Indirect Evidence in Mixed Treatment Comparisons.” Journal Article. <em>Stat Med</em> 23 (20): 3105–24. <a href="https://doi.org/10.1002/sim.1875" class="external-link">https://doi.org/10.1002/sim.1875</a>.</p>
</div>
<div id="ref-mawdsley2016">
<p>Mawdsley, D., M. Bennetts, S. Dias, M. Boucher, and N. J. Welton. 2016. “Model-Based Network Meta-Analysis: A Framework for Evidence Synthesis of Clinical Trial Data.” Journal Article. <em>CPT Pharmacometrics Syst Pharmacol</em> 5 (8): 393–401. <a href="https://doi.org/10.1002/psp4.12091" class="external-link">https://doi.org/10.1002/psp4.12091</a>.</p>
</div>
<div id="ref-owen2015">
<p>Owen, R. K., D. G. Tincello, and R. A. Keith. 2015. “Network Meta-Analysis: Development of a Three-Level Hierarchical Modeling Approach Incorporating Dose-Related Constraints.” Journal Article. <em>Value Health</em> 18 (1): 116–26. <a href="https://doi.org/10.1016/j.jval.2014.10.006" class="external-link">https://doi.org/10.1016/j.jval.2014.10.006</a>.</p>
</div>
<div id="ref-pedder2019">
<p>Pedder, H., S. Dias, M. Bennetts, M. Boucher, and N. J. Welton. 2019. “Modelling Time-Course Relationships with Multiple Treatments: Model-Based Network Meta-Analysis for Continuous Summary Outcomes.” Journal Article. <em>Res Synth Methods</em> 10 (2): 267–86.</p>
</div>
<div id="ref-pedder2021">
<p>———. 2021. “Joining the Dots: Linking Disconnected Networks of Evidence Using Dose-Response Model-Based Network Meta-Analysis.” Journal Article. <em>Medical Decision Making</em> 41 (2): 194–208.</p>
</div>
<div id="ref-pedder2021cons">
<p>Pedder, H., S. Dias, M. Boucher, M. Bennetts, D. Mawdsley, and N. J. Welton. 2021. “Methods to Assess Evidence Consistency in Dose-Response Model Based Network Meta-Analysis.” Journal Article. <em>Statistics in Medicine</em> 41 (4): 625–44. <a href="https://onlinelibrary.wiley.com/doi/10.1002/sim.9270" class="external-link">https://onlinelibrary.wiley.com/doi/10.1002/sim.9270</a>.</p>
</div>
<div id="ref-plummer2008">
<p>Plummer, M. 2008. “Penalized Loss Functions for Bayesian Model Comparison.” Journal Article. <em>Biostatistics</em> 9 (3): 523–39. <a href="https://pubmed.ncbi.nlm.nih.gov/18209015/" class="external-link">https://pubmed.ncbi.nlm.nih.gov/18209015/</a>.</p>
</div>
<div id="ref-spiegelhalter2002">
<p>Spiegelhalter, D. J., N. G. Best, B. P. Carlin, and A. van der Linde. 2002. “Bayesian Measures of Model Complexity and Fit.” Journal Article. <em>J R Statistic Soc B</em> 64 (4): 583–639.</p>
</div>
<div id="ref-thorlund2014">
<p>Thorlund, K., E. J. Mills, P. Wu, E. P. Ramos, A. Chatterjee, E. Druyts, and P. J. Godsby. 2014. “Comparative Efficacy of Triptans for the Abortive Treatment of Migraine: A Multiple Treatment Comparison Meta-Analysis.” Journal Article. <em>Cephalagia</em>. <a href="https://doi.org/10.1177/0333102413508661" class="external-link">https://doi.org/10.1177/0333102413508661</a>.</p>
</div>
<div id="ref-vanvalkenhoef2016">
<p>Valkenhoef, G. van, S. Dias, A. E. Ades, and N. J. Welton. 2016. “Automated Generation of Node-Splitting Models for Assessment of Inconsistency in Network Meta-Analysis.” Journal Article. <em>Res Synth Methods</em> 7 (1): 80–93. <a href="https://doi.org/10.1002/jrsm.1167" class="external-link">https://doi.org/10.1002/jrsm.1167</a>.</p>
</div>
<div id="ref-warren2019">
<p>Warren, R. B., M. Gooderham, R. Burge, B. Zhu, D. Amato, K. H. Liu, D. Shrom, J. Guo, A. Brnabic, and A. Blauvelt. 2019. “Comparison of Cumulative Clinical Benefits of Biologics for the Treatment of Psoriasis over 16 Weeks: Results from a Network Meta-Analysis.” Journal Article. <em>J Am Acad Dermatol</em> 82 (5): 1138–49.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Hugo Pedder.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
