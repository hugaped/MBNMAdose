<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MBNMAdose: Checking for consistency • MBNMAdose</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="MBNMAdose: Checking for consistency">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">MBNMAdose</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.5.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/consistencychecking-3.html">MBNMAdose: Checking for consistency</a>
    </li>
    <li>
      <a href="../articles/dataexploration-1.html">MBNMAdose: Exploring the data</a>
    </li>
    <li>
      <a href="../articles/mbnmadose-overview.html">MBNMAdose: Package Overview</a>
    </li>
    <li>
      <a href="../articles/metaregression-6.html">MBNMAdose: Perform Network Meta-Regression</a>
    </li>
    <li>
      <a href="../articles/nma_in_mbnmadose.html">Class effect NMA analysis using MBNMAdose</a>
    </li>
    <li>
      <a href="../articles/outputs-4.html">MBNMAdose outputs: Relative effects, forest plots and rankings</a>
    </li>
    <li>
      <a href="../articles/predictions-5.html">MBNMAdose: Calculating model predictions</a>
    </li>
    <li>
      <a href="../articles/runmbnmadose-2.html">MBNMAdose: Perform a Model-Based Network Meta-Analysis (MBNMA)</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>MBNMAdose: Checking for consistency</h1>
                        <h4 data-toc-skip class="author">Hugo
Pedder</h4>
            
            <h4 data-toc-skip class="date">2025-02-06</h4>
      

      <div class="hidden name"><code>consistencychecking-3.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="consistency-testing">Consistency Testing<a class="anchor" aria-label="anchor" href="#consistency-testing"></a>
</h2>
<p>When performing a MBNMA by pooling relative treatment effects, the
modelling approach assumes consistency between direct and indirect
evidence within a network. This is an incredibly useful assumption as it
allows us to improve precision on existing direct estimates, or to
estimate relative effects between treatments that have not been compared
in head-to-head trials, by making use of indirect evidence.</p>
<p>However, if this assumption does not hold, this is extremely
problematic for inference, so it is important to be able to test it. A
number of different approaches exist to allow for this in standard
Network Meta-Analysis (NMA) <span class="citation">(Dias et al.
2013)</span>, but within dose-response MBNMA there is added complexity
because the consistency assumption can be conceptualised either for each
treatment comparison (combination of dose and agent), or for each agent,
where consistency is required for the agent-level parameters governing
the dose-response relationship. A detailed description of consistency
testing in MBNMA models is given in Pedder et al. <span class="citation">(2021)</span>.</p>
<p>Testing for consistency at the agent-level is challenging as there is
unlikely to be the required data available to be able to do this -
included studies in the dataset must have multiple doses of multiple
agents, so that sufficient information is available to estimate
dose-response parameters <em>within that study</em>. However, testing
for consistency at the treatment-level is possible in MBNMA, and this is
described below. In practice, testing for consistency at the
treatment-level should suffice, as any inconsistency identified at the
treatment level should also translate to inconsistency at the agent
level and vice versa <span class="citation">(Pedder et al.
2021)</span>.</p>
<p>Consistency also depends on the functional form assumed for the
dose-response relationship, and so is inextricably linked to model fit
of the dose-response relationship. A thorough assessment of the validity
of the fitted model is therefore important to be confident that the
resulting treatment effect estimates provide a firm basis for decision
making.</p>
<p>When meta-analysing dose-response studies, the potential for
inconsistency testing may actually be reasonably rare, as most (if not
all) trials will be multi-arm placebo-controlled. Since each study is
internally consistent (the relative effects within the trial will always
adhere to consistency relationships), there will be no closed loops of
treatments that are informed by independent sources of evidence.</p>
<div class="section level3">
<h3 id="unrelated-mean-effects-ume-model-at-the-treatment-level">Unrelated Mean Effects (UME) model at the treatment level<a class="anchor" aria-label="anchor" href="#unrelated-mean-effects-ume-model-at-the-treatment-level"></a>
</h3>
<p>To check for consistency at the treatment level using UME we fit an
NMA that does not assume consistency relationships, and that only models
the direct relative effects between each arm in a study and the study
reference treatment <span class="citation">(Dias et al. 2013)</span>. If
the consistency assumption holds true then the results from the UME
model and the NMA will be very similar. However, if there is a
discrepancy between direct and indirect evidence in the network, then
the consistency assumption may not be valid, and the UME results are
likely differ in several ways:</p>
<ul>
<li>The UME model may provide a better fit to the data, as measured by
residual deviance</li>
<li>The between-study SD for different parameters may be lower in the
UME model</li>
<li>Individual relative effects may differ in magnitude or (more
severely) in direction for different treatment comparisons between UME
and NMA models.</li>
</ul>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Using the alogliptin dataset</span></span>
<span><span class="va">alognet</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mbnma.network.html">mbnma.network</a></span><span class="op">(</span><span class="va">alog_pcfb</span><span class="op">)</span></span>
<span><span class="va">nma</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nma.run.html">nma.run</a></span><span class="op">(</span><span class="va">alognet</span>, method <span class="op">=</span> <span class="st">"random"</span><span class="op">)</span></span>
<span><span class="va">ume</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nma.run.html">nma.run</a></span><span class="op">(</span><span class="va">alognet</span>, method <span class="op">=</span> <span class="st">"random"</span>, UME <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">Model</th>
<th align="right">Residual Deviance</th>
<th align="left">Betwen-study SD</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">NMA</td>
<td align="right">46.37</td>
<td align="left">0.12 (0.073, 0.18)</td>
</tr>
<tr class="even">
<td align="left">UME</td>
<td align="right">45.69</td>
<td align="left">0.14 (0.087, 0.22)</td>
</tr>
</tbody>
</table>
<p>As both the residual deviances and between-study SDs are similar,
this would suggest that there is no evidence of inconsistency in this
network, though comparing results for individual comparisons from the
models can also be useful.</p>
<p>Deviance-deviance plots <span class="citation">(Dias et al.
2013)</span> can be compared between different models to investigate the
fit of different data points. This can be done for two different models
at a time using <code><a href="../reference/devdev.html">devdev()</a></code>:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Compares residual deviance contributions from NMA and UME models</span></span>
<span><span class="fu"><a href="../reference/devdev.html">devdev</a></span><span class="op">(</span><span class="va">nma</span>, <span class="va">ume</span>, dev.type <span class="op">=</span> <span class="st">"resdev"</span><span class="op">)</span></span></code></pre></div>
<p><img src="consistencychecking-3_files/figure-html/unnamed-chunk-3-1.png" width="672"></p>
<p>In Pedder et al. <span class="citation">(2021)</span> we suggest
comparing the following models using these plots to evaluate consistency
in MBNMA:</p>
<ol style="list-style-type: decimal">
<li>Selected dose-response MBNMA model</li>
<li>Treatment-level NMA model (using same common/random treatment
effects as for the MBNMA)</li>
<li>Treatment-level UME model (using same common/random treatment
effects as for the MBNMA)</li>
</ol>
<p>Differences in deviance contributions between models 1 and 2 will
highlight data points which may fit the dose-response relationship
poorly. Difference in deviance contributions between models 2 and 3 will
highlight data points which are suggestive of inconsistency.</p>
</div>
<div class="section level3">
<h3 id="node-splitting-at-the-treatment-level">Node-splitting at the treatment level<a class="anchor" aria-label="anchor" href="#node-splitting-at-the-treatment-level"></a>
</h3>
<p>Another approach for consistency checking is node-splitting. This
splits contributions for a particular treatment comparison into direct
and indirect evidence, and the two can then be compared to test their
similarity <span class="citation">(Valkenhoef et al. 2016)</span>.
Node-splitting in dose-response MBNMA is an extension to this method, as
indirect evidence contributions can be calculated incorporating the
dose-response function. <code><a href="../reference/mbnma.nodesplit.html">mbnma.nodesplit()</a></code> takes similar
arguments to <code><a href="../reference/mbnma.run.html">mbnma.run()</a></code>, and returns an object of
<code>class("nodesplit")</code>.</p>
<p>In addition to these, the argument <code>comparisons</code> can be
used to indicate which treatment comparisons to perform a nodesplit on.
If left as <code>NULL</code> (the default) node-splits will
automatically be performed in all closed loops of treatments in which
comparisons are informed by independent sources of evidence. This is
somewhat similar to the function
<code>gemtc::mtc.nodesplit.comparisons()</code>, but uses a fixed
network reference treatment and therefore ensures differences between
direct and indirect evidence are parameterised as inconsistency rather
than as heterogeneity <span class="citation">(Dias et al. 2013)</span>.
However, it also allows for indirect evidence to be informed via the
dose-response relationship even if there is no pathway of evidence
between the treatments, which can in fact lead to additional potentially
inconsistent loops. To incorporate indirect evidence in this way
<code>incldr=TRUE</code> can be set in
<code><a href="../reference/inconsistency.loops.html">inconsistency.loops()</a></code>, the default when using
<code><a href="../reference/mbnma.nodesplit.html">mbnma.nodesplit()</a></code></p>
<p>The complexity of the dose-response relationship fitted and the
amount of indirect evidence available will also affect the number of
comparisons on which node-splitting is possible <span class="citation">(Pedder et al. 2021)</span>. If there is only limited
indirect dose-response information for a given comparison (e.g. only two
doses available for the agents in the comparison), then only a simpler
dose-response function (e.g. exponential) can be fitted. The values
given in <code>inconsistency.loops()$path</code> can give an indication
as to the number of doses available for each comparison. For example,
<code>drparams 3 4</code> would indicate that the indirect evidence is
estimated only via the dose-response relationship, and that within the
indirect evidence there are three doses available for estimating the
dose-response of the agent in <code>t1</code> of the comparison, and
four doses available for estimating the dose-responses of the agent in
<code>t2</code> of the comparison. This means that a three-parameter
dose-response function would be the most complex function that could be
used when node-splitting this comparison.</p>
<p>As several models have to be run for each closed loop of treatments,
node-splitting can take some time to run, and it therefore is not shown
for the purposes of this vignette.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Using the psoriasis dataset (&gt;75% improvement in PASI score)</span></span>
<span><span class="va">psoriasis</span><span class="op">$</span><span class="va">r</span> <span class="op">&lt;-</span> <span class="va">psoriasis</span><span class="op">$</span><span class="va">r75</span></span>
<span><span class="va">psorinet</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mbnma.network.html">mbnma.network</a></span><span class="op">(</span><span class="va">psoriasis</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Identify comparisons on which node-splitting is possible</span></span>
<span><span class="va">splitcomps</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/inconsistency.loops.html">inconsistency.loops</a></span><span class="op">(</span><span class="va">psorinet</span><span class="op">$</span><span class="va">data.ab</span>, incldr <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">splitcomps</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># If we want to fit an Emax dose-response function, there is insufficient</span></span>
<span><span class="co"># indirect evidence in all but the first 6 comparisons</span></span>
<span><span class="va">nodesplit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mbnma.nodesplit.html">mbnma.nodesplit</a></span><span class="op">(</span><span class="va">psorinet</span>, fun <span class="op">=</span> <span class="fu"><a href="../reference/demax.html">demax</a></span><span class="op">(</span><span class="op">)</span>, comparisons <span class="op">=</span> <span class="va">splitcomps</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">6</span>,</span>
<span>    <span class="op">]</span>, method <span class="op">=</span> <span class="st">"common"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">nodesplit</span><span class="op">)</span></span></code></pre></div>
<p>Performing the <code><a href="https://rdrr.io/r/base/print.html" class="external-link">print()</a></code> method on an object of
<code>class("nodesplit")</code> prints a summary of the node-split
results to the console, whilst the <code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code> method will
return a data frame of posterior summaries for direct and indirect
estimates for each split treatment comparison.</p>
<p>The nodesplit object itself is a list with results for each treatment
comparison that has been split. There is a lot of information within the
results, but the most useful (and easily interpretable) elements
are:</p>
<ul>
<li>
<code>p.values</code> the Bayesian p-value for the posterior overlap
between direct and indirect estimates</li>
<li>
<code>quantiles</code> the median and 95%CrI of the posterior
distributions for direct and indirect evidence, and for the difference
between them.</li>
<li>
<code>forest.plot</code> a forest plot that shows the median and 95%
CrI for direct and indirect estimates</li>
<li>
<code>density.plot</code> a plot that shows the posterior
distributions for direct and indirect estimates</li>
</ul>
<p>It is possible to generate different plots of each nodesplit
comparison using <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code>:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Plot forest plots of direct, indirect and pooled (MBNMA) results for each</span></span>
<span><span class="co"># comparison</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">nodesplit</span>, plot.type <span class="op">=</span> <span class="st">"forest"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot posterior densities of direct and indirect results for each nodesplit</span></span>
<span><span class="co"># comparisons</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">nodesplit</span>, plot.type <span class="op">=</span> <span class="st">"density"</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2 unnumbered">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-dias2013" class="csl-entry">
Dias, S., N. J. Welton, A. J. Sutton, D. M. Caldwell, G. Lu, and A. E.
Ades. 2013. <span>“Evidence Synthesis for Decision Making 4:
Inconsistency in Networks of Evidence Based on Randomized Controlled
Trials.”</span> Journal Article. <em>Med Decis Making</em> 33 (5):
641–56. <a href="https://doi.org/10.1177/0272989X12455847" class="external-link">https://doi.org/10.1177/0272989X12455847</a>.
</div>
<div id="ref-pedder2021cons" class="csl-entry">
Pedder, H., S. Dias, M. Boucher, M. Bennetts, D. Mawdsley, and N. J.
Welton. 2021. <span>“Methods to Assess Evidence Consistency in
Dose-Response Model Based Network Meta-Analysis.”</span> Journal
Article. <em>Statistics in Medicine</em> 41 (4): 625–44.
</div>
<div id="ref-vanvalkenhoef2016" class="csl-entry">
Valkenhoef, G. van, S. Dias, A. E. Ades, and N. J. Welton. 2016.
<span>“Automated Generation of Node-Splitting Models for Assessment of
Inconsistency in Network Meta-Analysis.”</span> Journal Article. <em>Res
Synth Methods</em> 7 (1): 80–93. <a href="https://doi.org/10.1002/jrsm.1167" class="external-link">https://doi.org/10.1002/jrsm.1167</a>.
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Hugo Pedder.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

      </footer>
</div>






  </body>
</html>
