<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MBNMAdose: Perform a Model-Based Network Meta-Analysis (MBNMA) • MBNMAdose</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="MBNMAdose: Perform a Model-Based Network Meta-Analysis (MBNMA)">
<meta property="og:description" content="MBNMAdose">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">MBNMAdose</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.4.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/consistencychecking-3.html">MBNMAdose: Checking for consistency</a>
    </li>
    <li>
      <a href="../articles/dataexploration-1.html">MBNMAdose: Exploring the data</a>
    </li>
    <li>
      <a href="../articles/mbnmadose-overview.html">MBNMAdose: Package Overview</a>
    </li>
    <li>
      <a href="../articles/metaregression-6.html">MBNMAdose: Perform Network Meta-Regression</a>
    </li>
    <li>
      <a href="../articles/nma_in_mbnmadose.html">Class effect NMA analysis using MBNMAdose</a>
    </li>
    <li>
      <a href="../articles/outputs-4.html">MBNMAdose outputs: Relative effects, forest plots and rankings</a>
    </li>
    <li>
      <a href="../articles/predictions-5.html">MBNMAdose: Calculating model predictions</a>
    </li>
    <li>
      <a href="../articles/runmbnmadose-2.html">MBNMAdose: Perform a Model-Based Network Meta-Analysis (MBNMA)</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>MBNMAdose: Perform a Model-Based Network
Meta-Analysis (MBNMA)</h1>
                        <h4 data-toc-skip class="author">Hugo
Pedder</h4>
            
            <h4 data-toc-skip class="date">2024-04-18</h4>
      
      
      <div class="hidden name"><code>runmbnmadose-2.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="analysis-using-mbnma-run">Analysis using <code>mbnma.run()</code><a class="anchor" aria-label="anchor" href="#analysis-using-mbnma-run"></a>
</h2>
<p>MBNMA is performed in <code>MBNMAdose</code> by applying
<code><a href="../reference/mbnma.run.html">mbnma.run()</a></code>. A <code>"mbnma.network"</code> object must be
provided as the data for <code><a href="../reference/mbnma.run.html">mbnma.run()</a></code>. The key arguments
within <code><a href="../reference/mbnma.run.html">mbnma.run()</a></code> involve specifying the functional form
used to model the dose-response, and the dose-response parameters that
comprise that functional form.</p>
<div class="section level3">
<h3 id="dose-response-functions">Dose-response functions<a class="anchor" aria-label="anchor" href="#dose-response-functions"></a>
</h3>
<p>Various functional forms are implemented within
<code>MBNMAdose</code>, that allow a variety of parameterizations and
dose-response shapes. These are provided as an object of class
<code>"dosefun"</code> to the <code>fun</code> argument in
<code><a href="../reference/mbnma.run.html">mbnma.run()</a></code>. The interpretation of the dose-response
parameter estimates will therefore depend on the dose-response function
used. In previous versions of <code>MBNMAdose</code> (prior to version
0.4.0), wrapper functions were provided for each of the commonly used
dose-response functions in <code><a href="../reference/mbnma.run.html">mbnma.run()</a></code>. For example,
<code>mbnma.emax()</code> is equivalent to
<code>mbnma.run(fun=demax())</code>. This will be deprecated in future
versions.</p>
<p>For the following functions <span class="math inline">\(x_{i,k}\)</span> refers to the dose and <span class="math inline">\(t_{i,k}\)</span> to the agent in arm <span class="math inline">\(k\)</span> of study <span class="math inline">\(i\)</span>.</p>
<p><strong>Log-linear (<code><a href="../reference/dloglin.html">dloglin()</a></code>)</strong> <span class="math display">\[f(x_{i,k}, t_{i,k})=\lambda_{t_{i,k}} \times
ln(x_{i,k} + 1)\]</span> where <span class="math inline">\(lambda\)</span> controls the gradient of the
dose-response relationship.</p>
<p><strong>Exponential (<code><a href="../reference/dexp.html">dexp()</a></code>)</strong> <span class="math display">\[f(x_{i,k}, t_{i,k})=Emax_{t_{i,k}} (1 -
e^{-x_{i,k}})\]</span> where <span class="math inline">\(Emax\)</span>
is the maximum efficacy of an agent.</p>
<p><strong>Emax (<code><a href="../reference/demax.html">demax()</a></code>)</strong> <span class="math display">\[f(x_{i,k}, t_{i,k})=\dfrac{Emax_{t_{i,k}} \times
{x_{i,k}^{\gamma_{t_{i,k}}}}} {ED50_{t_{i,k}}^{\gamma_{t_{i,k}}} +
x_{i,k}^{\gamma_{t_{i,k}}}}\]</span> where <span class="math inline">\(Emax\)</span> is the maximum efficacy that can be
achieved, <span class="math inline">\(ED50\)</span> is the dose at which
50% of the maximum efficacy is achieved, and <span class="math inline">\(\gamma\)</span> is the Hill parameter that
controls the sigmoidal shape of the function. By default,
<code><a href="../reference/demax.html">demax()</a></code> fits a 2-parameter Emax function in which <span class="math inline">\(\gamma_{t_{i,k}}=1\)</span>
(<code>hill=NULL</code> in function argument).</p>
<p><strong>Polynomial (e.g. linear) (<code><a href="../reference/dpoly.html">dpoly()</a></code>)</strong>
<span class="math display">\[f(x_{i,k},
t_{i,k})=\beta_{1_{t_{i,k}}}x_{i,k}+...+\beta_{p_{t_{i,k}}}x^p_{i,k}\]</span>
where <span class="math inline">\(p\)</span> is the degree of the
polynomial (e.g. 1 for linear) and <span class="math inline">\(\beta_p\)</span> are the coefficients</p>
<p><strong>Fractional polynomial (<code><a href="../reference/dfpoly.html">dfpoly()</a></code>)</strong> <span class="math display">\[f(x_{i,k},
t_{i,k})=\beta_{1_{t_{i,k}}}x_{i,k}^{\gamma_1}+...+\beta_{p_{t_{i,k}}}x^{\gamma_p}_{i,k}\]</span>
where <span class="math inline">\(p\)</span> is the degree of the
polynomial, <span class="math inline">\(\beta_p\)</span> are the
coefficients, and <span class="math inline">\(x_{i,k}^{\gamma_p}\)</span> is a regular power
except where <span class="math inline">\(\gamma_p=0\)</span> where <span class="math inline">\({x_{i,k}^{(0)}=ln(x_{i,k})}\)</span>. If a
fractional polynomial power <span class="math inline">\({\gamma_p}\)</span> repeats within the function it
is multiplied by another <span class="math inline">\({ln(x_{i,k})}\)</span>.</p>
<p><strong>Spline functions (<code><a href="../reference/dspline.html">dspline()</a></code>)</strong> B-splines
(<code>type="bs"</code>), natural cubic splines (<code>type="ns"</code>)
and piecewise linear splines (<code>type="ls"</code>) can be fitted.
<span class="math display">\[f(x_{i,k}, t_{i,k})=\sum_{p=1}^{P}
\beta_{p,t_{i,k}} X_{p,i,k}\]</span> where <span class="math inline">\(\beta_{p,t_{i,k}}\)</span> is the regression
coefficient for the <span class="math inline">\(p^{th}\)</span> spline
and <span class="math inline">\(X_{1:P,i,k}\)</span> is the basis matrix
for the spline, defined by the spline type.</p>
<p><strong>Non-parametric monotonic function
(<code><a href="../reference/dnonparam.html">dnonparam()</a></code>)</strong> Follows the approach of Owen et al.
<span class="citation">(2015)</span>. The <code>direction</code> can
bespecified as <code>"increasing"</code> or
<code>"decreasing"</code>.</p>
<p><strong>User-defined function (<code><a href="../reference/duser.html">duser()</a></code>)</strong> Any
function that can be explicitly defined by the user within (see <a href="#user-defined-dose-response-function">User-defined dose-response
function</a>)</p>
<p><strong>Agent-specific functions (<code><a href="../reference/dmulti.html">dmulti()</a></code>)</strong>
Allows for a separate dose-response function to be fitted to each agent
in the network (see <a href="#agent-specific-dose-response-functions">Agent-specific
dose-response functions</a>)</p>
</div>
<div class="section level3">
<h3 id="dose-response-parameters">Dose-response parameters<a class="anchor" aria-label="anchor" href="#dose-response-parameters"></a>
</h3>
<p>Dose-response parameters can be specified in different ways which
affects the key parameters estimated by the model and implies different
modelling assumptions. Three different specifications are available for
each parameter:</p>
<ul>
<li>
<code>"rel"</code> indicates that relative effects should be pooled
for this dose-response parameter separately for each agent in the
network. This preserves randomisation within included studies and is
likely to vary less between studies (only due to effect
modification).</li>
<li>
<code>"common"</code> indicates that a single absolute value for
this dose-response parameter should be estimated across the whole
network <em>that does not vary by agent</em>. This is particularly
useful for parameters expected to be constant (e.g. Hill parameters in
<code><a href="../reference/demax.html">demax()</a></code> or fractional polynomial power parameters in
<code>fpoly()</code>).</li>
<li>
<code>"random"</code> indicates that a single absolute value should
be estimated separately for each agent, but that all the agent values
vary randomly around a single mean absolute network effect. It is
similar to <code>"common"</code> but makes slightly less strong
assumptions.</li>
<li>
<code><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric()</a></code> Assigned a numeric value - this is similar to
assigning <code>"common"</code>, but the single absolute value is
assigned as a numeric value by the user, rather than estimated from the
data.</li>
</ul>
<p>In <code><a href="../reference/mbnma.run.html">mbnma.run()</a></code>, an additional argument,
<code>method</code>, indicates what method to use for pooling relative
effects and can take either the values <code>"common"</code>, implying
that all studies estimate the same true effect (akin to a “fixed effect”
meta-analysis), or <code>"random"</code>, implying that all studies
estimate a separate true effect, but that each of these true effects
vary randomly around a true mean effect. This approach allows for
modelling of between-study heterogeneity.</p>
<p>If relative effects (<code>"rel"</code>) are modelled on more than
one dose-response parameter then by default, a correlation will be
assumed between the dose-response parameters, which will typically
improve estimation (provided the parameters are correlated…they usually
are). This can be prevented by setting <code>cor=FALSE</code>.</p>
</div>
<div class="section level3">
<h3 id="output">Output<a class="anchor" aria-label="anchor" href="#output"></a>
</h3>
<p><code><a href="../reference/mbnma.run.html">mbnma.run()</a></code> returns an object of class
<code>c("rjags", "mbnma")</code>. <code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code> provides
posterior medians and 95% credible intervals (95%CrI) for different
parameters in the model, naming them by agent and giving some
explanation of the way they have been specified in the model.
<code><a href="https://rdrr.io/r/base/print.html" class="external-link">print()</a></code> can also be used to give full summary statistics of
the posterior distributions for monitored nodes in the JAGS model.
Estimates are automatically reported for parameters of interest
depending on the model specification (unless otherwise specified in
<code>parameters.to.save</code>).</p>
<p>Dose-response parameters will be named in the output, with a separate
coefficient for each agent (if specified as <code>"rel"</code>). If
class effects are modelled, parameters for classes are represented by
the upper case name of the dose-response parameter they correspond to
(e.g. <code>EMAX</code> will be the class effects on <code>emax</code>).
The SD of the class effect (e.g. <code>sd.EMAX</code>,
<code>sd.BETA.1</code>) is the SD of agents within a class for the
dose-response parameter they correspond to.</p>
<p><code>sd</code> corresponds to the between-study SD. However,
<code>sd.</code> followed by a dose-response parameter name
(e.g. <code>sd.emax</code>, <code>sd.beta.1</code>) is the between-agent
SD for dose response parameters modeled using <code>"common"</code> or
<code>"random"</code>.</p>
<p><code>totresdev</code> is the residual deviance, and
<code>deviance</code> the deviance of the model. Model fit statistics
for <code>pD</code> (effective number of parameters) and
<code>DIC</code> (Deviance Information Criterion) are also reported,
with an explanation as to how they have been calculated.</p>
</div>
<div class="section level3">
<h3 id="examples">Examples<a class="anchor" aria-label="anchor" href="#examples"></a>
</h3>
<p>An example MBNMA of the triptans dataset using an Emax dose-response
function and common treatment effects that pool relative effects for
each agent separately on both Emax and ED50 parameters follows:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Prepare data using the triptans dataset</span></span>
<span><span class="va">tripnet</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mbnma.network.html">mbnma.network</a></span><span class="op">(</span><span class="va">triptans</span><span class="op">)</span></span>
<span><span class="co">#&gt; Values for `agent` with dose = 0 have been recoded to `Placebo`</span></span>
<span><span class="co">#&gt; agent is being recoded to enforce sequential numbering</span></span>
<span></span>
<span><span class="co"># Run an Emax dose-response MBNMA</span></span>
<span><span class="va">mbnma</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mbnma.run.html">mbnma.run</a></span><span class="op">(</span><span class="va">tripnet</span>, fun <span class="op">=</span> <span class="fu"><a href="../reference/demax.html">demax</a></span><span class="op">(</span>emax <span class="op">=</span> <span class="st">"rel"</span>, ed50 <span class="op">=</span> <span class="st">"rel"</span><span class="op">)</span>, method <span class="op">=</span> <span class="st">"random"</span><span class="op">)</span></span>
<span><span class="co">#&gt; `likelihood` not given by user - set to `binomial` based on data provided</span></span>
<span><span class="co">#&gt; `link` not given by user - set to `logit` based on assigned value for `likelihood`</span></span>
<span><span class="co">#&gt; module glm loaded</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Print neat summary of output</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mbnma</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">========================================</span></span></span>
<span><span class="co"><span style="font-weight: bold;">#&gt; Dose-response MBNMA</span></span></span>
<span><span class="co"><span style="font-weight: bold;">#&gt; ========================================</span></span></span>
<span><span class="co"><span style="font-weight: bold;">#&gt; </span></span></span>
<span><span class="co"><span style="font-weight: bold;">#&gt; </span>Likelihood: binomial</span></span>
<span><span class="co">#&gt; Link function: logit</span></span>
<span><span class="co">#&gt; Dose-response function: emax</span></span>
<span><span class="co"><span style="font-weight: bold; text-decoration: underline;">#&gt; </span></span></span>
<span><span class="co"><span style="font-weight: bold; text-decoration: underline;">#&gt; Pooling method</span></span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Method: Random effects estimated for relative effects</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">Parameter                    Median (95%CrI)</span></span></span>
<span><span class="co"><span style="font-weight: bold;">#&gt; -----------------------------------------------------------------------</span></span></span>
<span><span class="co">#&gt; Between-study SD for relative effects        0.31 (0.222, 0.408)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="font-weight: bold; text-decoration: underline;">emax dose-response parameter results</span></span></span>
<span><span class="co"><span style="font-weight: bold; text-decoration: underline;">#&gt; </span></span></span>
<span><span class="co"><span style="font-weight: bold; text-decoration: underline;">#&gt; </span>Pooling: relative effects for each agent</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; |Agent        |Parameter |  Median|   2.5%|    97.5%|</span></span>
<span><span class="co">#&gt; |:------------|:---------|-------:|------:|--------:|</span></span>
<span><span class="co">#&gt; |eletriptan   |emax[2]   |  2.7468| 2.0855|   3.8224|</span></span>
<span><span class="co">#&gt; |sumatriptan  |emax[3]   |  2.2280| 1.5041|   5.7750|</span></span>
<span><span class="co">#&gt; |frovatriptan |emax[4]   | 73.8410| 5.3802| 181.5962|</span></span>
<span><span class="co">#&gt; |almotriptan  |emax[5]   | 64.9145| 4.8699| 166.3348|</span></span>
<span><span class="co">#&gt; |zolmitriptan |emax[6]   |  2.8738| 1.6952|   5.1088|</span></span>
<span><span class="co">#&gt; |naratriptan  |emax[7]   | 44.2414| 6.5802| 120.5205|</span></span>
<span><span class="co">#&gt; |rizatriptan  |emax[8]   | 91.5845| 5.0873| 216.0724|</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="font-weight: bold; text-decoration: underline;">ed50 dose-response parameter results</span></span></span>
<span><span class="co"><span style="font-weight: bold; text-decoration: underline;">#&gt; </span></span></span>
<span><span class="co"><span style="font-weight: bold; text-decoration: underline;">#&gt; </span>Pooling: relative effects for each agent</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; |Agent        |Parameter |  Median|    2.5%|    97.5%|</span></span>
<span><span class="co">#&gt; |:------------|:---------|-------:|-------:|--------:|</span></span>
<span><span class="co">#&gt; |eletriptan   |ed50[2]   |  0.6479|  0.2599|   1.4542|</span></span>
<span><span class="co">#&gt; |sumatriptan  |ed50[3]   |  1.1245|  0.3205|   5.9756|</span></span>
<span><span class="co">#&gt; |frovatriptan |ed50[4]   | 77.2307|  3.7741| 195.8473|</span></span>
<span><span class="co">#&gt; |almotriptan  |ed50[5]   | 77.6310|  4.1451| 195.5089|</span></span>
<span><span class="co">#&gt; |zolmitriptan |ed50[6]   |  1.4850|  0.4132|   4.2453|</span></span>
<span><span class="co">#&gt; |naratriptan  |ed50[7]   | 99.4281| 16.2121| 241.6199|</span></span>
<span><span class="co">#&gt; |rizatriptan  |ed50[8]   | 56.6349|  2.2844| 137.5161|</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="font-weight: bold; text-decoration: underline;">Model Fit Statistics</span></span></span>
<span><span class="co"><span style="font-weight: bold; text-decoration: underline;">#&gt; </span>Effective number of parameters:</span></span>
<span><span class="co">#&gt; pD calculated using the Kullback-Leibler divergence = 130.5</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Deviance = 1090.6</span></span>
<span><span class="co">#&gt; Residual deviance = 187.5</span></span>
<span><span class="co">#&gt; Deviance Information Criterion (DIC) = 1221.1</span></span></code></pre></div>
<p>In this example the <code>emax</code> parameters are the maximum
efficacy that can be achieved for each agent. The <code>ed50</code>
parameters are the the dose at which 50% of the maximum efficacy is
achieved for each agent. Results for ED50 are given on the log scale as
it is constrained to be greater than zero. <code>sd</code> corresponds
to the between-study SD (included because
<code>method="random"</code>).</p>
<p>Instead of estimating a separate relative effect for each agent, a
simpler dose-response model that makes stronger assumptions could
estimate a single parameter across the whole network for ED50, but still
estimate a separate effect for each agent for Emax:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Emax model with single parameter estimated for Emax</span></span>
<span><span class="va">emax</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mbnma.run.html">mbnma.run</a></span><span class="op">(</span><span class="va">tripnet</span>, fun <span class="op">=</span> <span class="fu"><a href="../reference/demax.html">demax</a></span><span class="op">(</span>emax <span class="op">=</span> <span class="st">"rel"</span>, ed50 <span class="op">=</span> <span class="st">"common"</span><span class="op">)</span>, method <span class="op">=</span> <span class="st">"random"</span><span class="op">)</span></span>
<span><span class="co">#&gt; `likelihood` not given by user - set to `binomial` based on data provided</span></span>
<span><span class="co">#&gt; `link` not given by user - set to `logit` based on assigned value for `likelihood`</span></span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">emax</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in rhat.warning(object): The following parameters have Rhat values &gt; 1.2</span></span>
<span><span class="co">#&gt; which could be due to convergence issues:</span></span>
<span><span class="co">#&gt; ed50</span></span>
<span><span class="co">#&gt; emax[2]</span></span>
<span><span class="co">#&gt; emax[3]</span></span>
<span><span class="co">#&gt; emax[4]</span></span>
<span><span class="co">#&gt; emax[5]</span></span>
<span><span class="co">#&gt; emax[6]</span></span>
<span><span class="co">#&gt; emax[7]</span></span>
<span><span class="co">#&gt; emax[8]</span></span>
<span><span class="co">#&gt; sd</span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">========================================</span></span></span>
<span><span class="co"><span style="font-weight: bold;">#&gt; Dose-response MBNMA</span></span></span>
<span><span class="co"><span style="font-weight: bold;">#&gt; ========================================</span></span></span>
<span><span class="co"><span style="font-weight: bold;">#&gt; </span></span></span>
<span><span class="co"><span style="font-weight: bold;">#&gt; </span>Likelihood: binomial</span></span>
<span><span class="co">#&gt; Link function: logit</span></span>
<span><span class="co">#&gt; Dose-response function: emax</span></span>
<span><span class="co"><span style="font-weight: bold; text-decoration: underline;">#&gt; </span></span></span>
<span><span class="co"><span style="font-weight: bold; text-decoration: underline;">#&gt; Pooling method</span></span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Method: Random effects estimated for relative effects</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">Parameter                    Median (95%CrI)</span></span></span>
<span><span class="co"><span style="font-weight: bold;">#&gt; -----------------------------------------------------------------------</span></span></span>
<span><span class="co">#&gt; Between-study SD for relative effects        0.268 (0.157, 0.616)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="font-weight: bold; text-decoration: underline;">emax dose-response parameter results</span></span></span>
<span><span class="co"><span style="font-weight: bold; text-decoration: underline;">#&gt; </span></span></span>
<span><span class="co"><span style="font-weight: bold; text-decoration: underline;">#&gt; </span>Pooling: relative effects for each agent</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; |Agent        |Parameter | Median|   2.5%|    97.5%|</span></span>
<span><span class="co">#&gt; |:------------|:---------|------:|------:|--------:|</span></span>
<span><span class="co">#&gt; |eletriptan   |emax[2]   | 3.0735| 2.4038| 140.0550|</span></span>
<span><span class="co">#&gt; |sumatriptan  |emax[3]   | 2.0308| 1.6537|  94.8045|</span></span>
<span><span class="co">#&gt; |frovatriptan |emax[4]   | 2.3785| 1.4961| 139.9150|</span></span>
<span><span class="co">#&gt; |almotriptan  |emax[5]   | 1.9740| 1.4161| 108.1797|</span></span>
<span><span class="co">#&gt; |zolmitriptan |emax[6]   | 2.3123| 1.7545|  61.1024|</span></span>
<span><span class="co">#&gt; |naratriptan  |emax[7]   | 1.2295| 0.4283|  66.8817|</span></span>
<span><span class="co">#&gt; |rizatriptan  |emax[8]   | 2.9554| 2.2439| 202.4891|</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="font-weight: bold; text-decoration: underline;">ed50 dose-response parameter results</span></span></span>
<span><span class="co"><span style="font-weight: bold; text-decoration: underline;">#&gt; </span></span></span>
<span><span class="co"><span style="font-weight: bold; text-decoration: underline;">#&gt; </span>Pooling: single parameter across all agents in the network</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; |Parameter | Median|   2.5%|    97.5%|</span></span>
<span><span class="co">#&gt; |:---------|------:|------:|--------:|</span></span>
<span><span class="co">#&gt; |ed50      | 0.8362| 0.4555| 131.6718|</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="font-weight: bold; text-decoration: underline;">Model Fit Statistics</span></span></span>
<span><span class="co"><span style="font-weight: bold; text-decoration: underline;">#&gt; </span>Effective number of parameters:</span></span>
<span><span class="co">#&gt; pD calculated using the Kullback-Leibler divergence = 141.4</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Deviance = 1092.2</span></span>
<span><span class="co">#&gt; Residual deviance = 189.1</span></span>
<span><span class="co">#&gt; Deviance Information Criterion (DIC) = 1233.6</span></span></code></pre></div>
<p>In this example <code>ed50</code> only has a single parameter, which
corresponds to the dose at which 50% of the maximum efficacy is
achieved, assumed to be equal across all agents in the network.</p>
</div>
<div class="section level3">
<h3 id="parameter-interpretation">Parameter interpretation<a class="anchor" aria-label="anchor" href="#parameter-interpretation"></a>
</h3>
<p>Parameter interpretation depends both on the link scale on which the
outcome is modeled, and on the dose-response function used in the
model.</p>
<p>For example for a binomial outcome modeled using a logit link
function and an Emax dose-response function, the <code>emax</code>
parameter represents the maximum efficacy on the logit scale - it is
modeled on the outcome scale and hence is dependent on the link
function. As indicated in the help file (<code>?demax()</code>), the
<code>ed50</code> parameter is modeled on the log-scale to ensure that
it takes positive values on the natural scale, but is not modeled on the
outcome scale so is not dependent on the link function. Therefore it can
be interpreted as the log-dose at which 50% of the maximum efficacy is
achieved. The <code>hill</code> parameter is also modeled on the
log-scale, and it can be interpreted as a log-value that controls the
sigmoidicity of the dose-response function for the outcome on the logit
scale.</p>
<p>For a continuous outcome modeled using <code>link="smd"</code>,
whilst not a true link function it implies modelling Standardised Mean
Differences (SMD). For a linear dose-response function
(<code>dpoly(degree=1)</code>), <code>beta.1</code> represents the
change in SMD for each additional unit of dose. For a quadratic
dose-response function (<code>dpoly(degree=2)</code>),
<code>beta.2</code> represents the change in <code>beta.1</code> for
each additional unit of dose.</p>
<p>With some dose-response functions (e.g. splines, fractional
polynomials) parameter interpretation can be challenging. The
<code><a href="../reference/get.relative.html">get.relative()</a></code> function can make this easier as this allows
relative effects to be estimated between agents at specific doses, which
is typically much more easily understandable and presentable (see
[Estimating relative effects]).</p>
</div>
<div class="section level3">
<h3 id="additional-arguments-for-mbnma-run">Additional arguments for <code>mbnma.run()</code><a class="anchor" aria-label="anchor" href="#additional-arguments-for-mbnma-run"></a>
</h3>
<p>Several additional arguments can be given to <code><a href="../reference/mbnma.run.html">mbnma.run()</a></code>
that require further explanation.</p>
<div class="section level4">
<h4 id="link-functions-for-likelihoodnormal">Link functions for <code>likelihood=="normal"</code><a class="anchor" aria-label="anchor" href="#link-functions-for-likelihoodnormal"></a>
</h4>
<p>For data with normal likelihood, users are likely to typically
analyse data using an identity link function, the default given to the
<code>link</code> argument in <code><a href="../reference/mbnma.run.html">mbnma.run()</a></code> when
<code>likelihood="normal"</code>. This assumes an additive treatment
effect (e.g. mean difference).</p>
<p>However, by specifying <code>link="log"</code> a user can model a log
link and therefore assume a multiplicative treatment effect. For
continuous data this models the treatment effect as a Ratio of Means
(RoM) <span class="citation">(Friedrich, Adhikari, and Beyene
2011)</span>. This also provides an advantage as the treatment effect is
scale independent (i.e. studies measuring the same outcome using
different measurement scales can be analysed simultaneously). However,
within-study treatment effects must all be of the same direction (either
positive or negative), and change from baseline measures must be
adjusted so that they are also expressed as RoMs (log(follow-up) -
log(baseline)) to avoid combining additive and multiplicative
assumptions within the same analysis.</p>
<p>An alternative approach for modelling a measurement scale-independent
treatment effect whilst still assuming additive treatment effects is to
perform the analysis using Standardised Mean Differences (SMD). Whilst
not strictly a different link function, this can be specified using
<code>link="smd"</code>. The resulting treatment effects are reported in
units of SD as SMDs.</p>
<p>By default, <code>MBNMAdose</code> standardises treatment effects
using the pooled standard deviation (SD) in each study (“study-specific”
SDs). However, a more robust approach to minimise bias from estimation
of study-specific SD is to use a “reference” SD that is the same for
each scale included in the dataset. Such a reference could be estimated
from all the included studies within the dataset that report outcomes on
the scale (an “internal reference SD”), but the best approach is to
obtain a SD from an observational study <em>that is specific to the
target population of interest</em>.</p>
<p>Once this has been obtained for each scale, it can be included in the
original data frame as an additional variable, <code>standsd</code>. For
the analysis to be meaningful, <code>stansd</code> should be the same
for all arms within a study and for all studies that report the same
outcome. If this has been included in the dataset used to create an
<code>"mbnma.network"</code> object, then <code>sdscale=TRUE</code>
argument can be specified in <code><a href="../reference/mbnma.run.html">mbnma.run()</a></code> to indicate that
this variable should be used to standardise SMDs.</p>
<p>Note that for outputting results from a model using SMDs, results
should be back-transformed to a clinically relevant scale to make robust
interpretation. This can be done by multiplying the effect estimates or
predictions by the standard deviation of the relevant scale in the
population of interest. For further details of analysis of continuous
data that include discussion of both RoM and SMD see <span class="citation">(Daly et al. 2021)</span>.</p>
</div>
<div class="section level4">
<h4 id="class-effects">Class effects<a class="anchor" aria-label="anchor" href="#class-effects"></a>
</h4>
<p>Similar effects between agents within the network can be modelled
using class effects. This requires assuming that different agents have
some sort of common class effect, perhaps due to similar mechanisms of
action. Advantages of this is that class effects can be used to connect
agents that might otherwise be disconnected from the network, and they
can also provide additional information on agents that might otherwise
have insufficient data available to estimate a desired dose-response.
The drawback is that this requires making additional assumptions
regarding similarity of efficacy.</p>
<p>One difficult of this modelling aspect in particular is that the
scales for dose-response parameters must be the same across different
agents within a class for this assumption to be valid. For example, in
an Emax model it may be reasonable to assume a class effect on the Emax
parameter, as this is parameterised on the response scale and so could
be similar across agents of the same class. However, the ED50 parameter
is parameterised on the dose scale, which is likely to differ for each
agent and so an assumption of similarity between agents for this
parameter may be less valid. One way to try to account for this issue
and make dose scales more consistent across agents is to standardise
doses for each agent relative to its “common” dose (see Thorlund et al.
<span class="citation">(2014)</span>), though we expect that this may
lead to bias if the common dose is located at a different point along
the dose-response curve.</p>
<p>Class effects can only be applied to dose-response parameters which
vary by agent. In <code><a href="../reference/mbnma.run.html">mbnma.run()</a></code> they are supplied as a list,
in which each element is named following the name of the corresponding
dose-response parameter as defined in the dose-response function. The
names will therefore differ when using wrapper functions for
<code><a href="../reference/mbnma.run.html">mbnma.run()</a></code>. The class effect for each dose-response
parameter can be either <code>"common"</code>, in which the effects for
each agent within the same class are constrained to a common class
effect, or <code>"random"</code>, in which the effects for each agent
within the same class are assumed to be randomly distributed around a
shared class mean.</p>
<p>When working with class effects in <code>MBNMAdose</code> a variable
named <code>class</code> must be included in the original data frame
provided to <code><a href="../reference/mbnma.network.html">mbnma.network()</a></code>. Below we assign a class for
two similar agents in the dataset - Naproxcinod and Naproxen. We will
estimate separate effects for all other agents, so we set their classes
to be equal to their agents.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Using the osteoarthritis dataset</span></span>
<span><span class="va">pain.df</span> <span class="op">&lt;-</span> <span class="va">osteopain</span></span>
<span></span>
<span><span class="co"># Set class equal to agent for all agents</span></span>
<span><span class="va">pain.df</span><span class="op">$</span><span class="va">class</span> <span class="op">&lt;-</span> <span class="va">pain.df</span><span class="op">$</span><span class="va">class</span></span>
<span></span>
<span><span class="co"># Set a shared class (NSAID) only for Naproxcinod and Naproxen</span></span>
<span><span class="va">pain.df</span><span class="op">$</span><span class="va">class</span><span class="op">[</span><span class="va">pain.df</span><span class="op">$</span><span class="va">agent</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Naproxcinod"</span>, <span class="st">"Naproxen"</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"NSAID"</span></span>
<span></span>
<span><span class="co"># Run a restricted cubic spline MBNMA with a random class effect on beta.1</span></span>
<span><span class="va">painnet</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mbnma.network.html">mbnma.network</a></span><span class="op">(</span><span class="va">pain.df</span><span class="op">)</span></span>
<span><span class="va">splines</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mbnma.run.html">mbnma.run</a></span><span class="op">(</span><span class="va">painnet</span>, fun <span class="op">=</span> <span class="fu"><a href="../reference/dspline.html">dspline</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"bs"</span>, knots <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>, class.effect <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>beta.1 <span class="op">=</span> <span class="st">"random"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Mean class effects are given in the output as
<code>D.ed50</code>/<code>D.1</code> parameters. These can be
interpreted as the effect of each class for Emax parameters
(<code>beta.1</code>). Note the number of <code>D.ed50</code> parameters
is therefore equal to the number of classes defined in the dataset.</p>
<p>If we had specified that the class effects were
<code>"random"</code>, each treatment effect for Emax
(<code>beta.1</code>) would be assumed to be randomly distributed around
its class mean with SD given in the output as
<code>sd.D.ed50</code>/<code>sd.D.1</code>.</p>
<p>Mean class effects are represented in the output by the upper case
name of the dose-response parameter they correspond to. In this case,
<code>BETA.1</code> is the class effects on <code>beta.1</code>, the
first spline coefficient. The SD of the class effect is the SD of agents
within a class for the dose-response parameter they correspond to. In
this case <code>sd.BETA.1</code> is the within-class SD for
<code>beta.1</code>.</p>
</div>
<div class="section level4">
<h4 id="user-defined-dose-response-function">User-defined dose-response function<a class="anchor" aria-label="anchor" href="#user-defined-dose-response-function"></a>
</h4>
<p>Users can define their own dose-response function using
<code><a href="../reference/duser.html">duser()</a></code> rather than using one of the functions provided in
<code>MBNMAdose</code>. The dose-response is specified in terms of
<code>beta</code> parameters and <code>dose</code>. This allows a huge
degree of flexibility when defining the dose-response relationship.</p>
<p>The function assigned needs to fulfil a few criteria to be valid: *
<code>dose</code> must always be included in the function * At least one
<code>beta</code> dose-response parameter must be specified, up to a
maximum of four. These must always be named <code>beta.1</code>,
<code>beta.2</code>, <code>beta.3</code> and <code>beta.4</code>, and
must be included sequentially (i.e. don’t include <code>beta.3</code> if
<code>beta.2</code> is not included) * Indices used by JAGS should
<em>not</em> be added (e.g. use <code>dose</code> rather than
<code>dose[i,k]</code>) * Any mathematical/logical operators that can be
implemented in JAGS can be added to the function
(e.g. <code><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp()</a></code>, <code><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse()</a></code>). See the JAGS manual
<span class="citation">(2017)</span> for further details.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Using the depression SSRI dataset</span></span>
<span><span class="va">depnet</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mbnma.network.html">mbnma.network</a></span><span class="op">(</span><span class="va">ssri</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># An example specifying a quadratic dose-response function</span></span>
<span><span class="va">quadfun</span> <span class="op">&lt;-</span> <span class="op">~</span><span class="op">(</span><span class="va">beta.1</span> <span class="op">*</span> <span class="va">dose</span><span class="op">)</span> <span class="op">+</span> <span class="op">(</span><span class="va">beta.2</span> <span class="op">*</span> <span class="op">(</span><span class="va">dose</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">quad</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mbnma.run.html">mbnma.run</a></span><span class="op">(</span><span class="va">depnet</span>, fun <span class="op">=</span> <span class="fu"><a href="../reference/duser.html">duser</a></span><span class="op">(</span>fun <span class="op">=</span> <span class="va">quadfun</span>, beta.1 <span class="op">=</span> <span class="st">"rel"</span>, beta.2 <span class="op">=</span> <span class="st">"rel"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="agent-specific-dose-response-functions">Agent-specific dose-response functions<a class="anchor" aria-label="anchor" href="#agent-specific-dose-response-functions"></a>
</h4>
<p>Different dose-response functions can be used for different agents
within the network. This allows for the modelling of more complex
dose-response functions in agents for which there are many doses
available, and less complex functions in agents for which there are
fewer doses available. Note that these models are typically less
computationally stable than single dose-response function models, and
they are likely to benefit less from modelling correlation between
multiple dose-response parameters since there are fewer agents informing
correlations between each dose-response parameter.</p>
<p>This can be modeled using the <code><a href="../reference/dmulti.html">dmulti()</a></code> dose-response
function and assigning a list of objects of class <code>"dosefun"</code>
to it. Each element in the list corresponds to an agent in the network
(the order of which should be the same as the order of agents in the
<code>"mbnma.network"</code> object). A dose-response function for
Placebo should be included in the list, though which function is used is
typically irrelevant since evaluating the function at dose=0 will
typically equal 0.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Using the depression SSRI dataset</span></span>
<span><span class="va">depnet</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mbnma.network.html">mbnma.network</a></span><span class="op">(</span><span class="va">ssri</span><span class="op">)</span></span>
<span></span>
<span><span class="va">dr.funs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dmulti.html">dmulti</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>Placebo <span class="op">=</span> <span class="fu"><a href="../reference/dfpoly.html">dfpoly</a></span><span class="op">(</span>degree <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>, citalopram <span class="op">=</span> <span class="fu"><a href="../reference/dfpoly.html">dfpoly</a></span><span class="op">(</span>degree <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,</span>
<span>    escitalopram <span class="op">=</span> <span class="fu"><a href="../reference/dfpoly.html">dfpoly</a></span><span class="op">(</span>degree <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>, fluoxetine <span class="op">=</span> <span class="fu"><a href="../reference/dspline.html">dspline</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"ns"</span>, knots <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,</span>
<span>    paroxetine <span class="op">=</span> <span class="fu"><a href="../reference/dfpoly.html">dfpoly</a></span><span class="op">(</span>degree <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>, sertraline <span class="op">=</span> <span class="fu"><a href="../reference/dspline.html">dspline</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"ns"</span>, knots <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">multifun</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mbnma.run.html">mbnma.run</a></span><span class="op">(</span><span class="va">depnet</span>, fun <span class="op">=</span> <span class="va">dr.funs</span>, method <span class="op">=</span> <span class="st">"common"</span>, n.iter <span class="op">=</span> <span class="fl">50000</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">multifun</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="incorporating-agentsinterventions-without-a-dose-response">Incorporating agents/interventions without a dose-response<a class="anchor" aria-label="anchor" href="#incorporating-agentsinterventions-without-a-dose-response"></a>
</h4>
<p>Because an MBNMA model with a linear dose-response function
(<code>dpoly(degree=1)</code>) is mathematically equivalent to a
standard NMA model, using agent-specific dose-response functions allows
analysis of datasets that both include multiple doses of different drugs
<em>and</em> interventions for which a dose-response relationship is not
realistic (e.g. surgery) or difficult to assume (e.g. psychotherapy,
exercise interventions). Interventions without a dose-response
relationship can be coded in the dataset as different agents, each of
which should be assigned a dose of 1, and these can then be modeled
using a linear dose-response relationship, whilst agents with a
plausible dose-response can be assigned a function that appropriately
captures their dose-response relationship. Further details of this
approach can be found in the vignette on <a href="nma_in_mbnmadose.html">NMA in MBNMAdose</a></p>
</div>
<div class="section level4">
<h4 id="splines-and-knots">Splines and <code>knots</code><a class="anchor" aria-label="anchor" href="#splines-and-knots"></a>
</h4>
<p>For a more flexible dose-response shape, various different splines
can be fitted to the data by using <code><a href="../reference/dspline.html">dspline()</a></code>. This model is
very flexible and can allow for a variety of non-monotonic dose-response
relationships, though parameters can be difficult to interpret and the
resulting dose-response shape is often best visualised by calculating
and plotting predictions (<a href="predictions-5.html">Predictions</a>.</p>
<p>To fit this model, the number/location of <code>knots</code> (the
points at which the different spline pieces meet) should be specified.
If a single number is given, it represents the the number of knots to be
equally spaced across the dose range of each agent. Alternatively
several probabilities can be given that represent the quantiles of the
dose range for each agent at which knots should be located. Note that by
default, a boundary knot will be placed at the maximum of the dose range
to limit the function extrapolating to extreme values.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/dspline.html">dspline</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"bs"</span>, knots <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="co"># ...is equivalent to</span></span>
<span><span class="fu"><a href="../reference/dspline.html">dspline</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"bs"</span>, knots <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Using a natural cubic spline on the SSRI dataset</span></span>
<span><span class="va">depnet</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mbnma.network.html">mbnma.network</a></span><span class="op">(</span><span class="va">ssri</span><span class="op">)</span></span>
<span><span class="va">ns</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mbnma.run.html">mbnma.run</a></span><span class="op">(</span><span class="va">depnet</span>, fun <span class="op">=</span> <span class="fu"><a href="../reference/dspline.html">dspline</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"ns"</span>, knots <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="correlation-between-dose-response-parameters">Correlation between dose-response parameters<a class="anchor" aria-label="anchor" href="#correlation-between-dose-response-parameters"></a>
</h4>
<p><code><a href="../reference/mbnma.run.html">mbnma.run()</a></code> can model correlation between relative
effects dose-response parameters, allowing information on one parameter
to inform the other(s). This can be implemented by specifying
<code>cor=TRUE</code> in <code><a href="../reference/mbnma.run.html">mbnma.run()</a></code>. The correlation is
modeled using a vague Wishart prior, but this can be made more
informative by specifying a scale matrix for the prior. This corresponds
to the expectation of the Wishart prior. A different scale matrix can be
given to the model in <code>omega</code>. Each row of the scale matrix
corresponds to the 1st, 2nd, 3rd, etc. dose-response parameter that has
been modeled using relative effects (as specified in the dose-response
function).</p>
</div>
<div class="section level4">
<h4 id="priors">Priors<a class="anchor" aria-label="anchor" href="#priors"></a>
</h4>
<p>Default vague priors for the model are as follows:</p>
<p><span class="math display">\[
\begin{aligned}
  &amp;d_{p,a} \sim N(0,10000)\\
  &amp;beta_{p} \sim N(0,10000)\\
  &amp;\sigma \sim N(0,400) \text{  limited to  } x \in [0,\infty]\\
  &amp;\sigma_{p} \sim N(0,400) \text{  limited to  } x \in [0,\infty]\\
  &amp;D_{p,c} \sim N(0,1000)\\
  &amp;\sigma^D_{p} \sim N(0,400) \text{ limited to } x \in [0,\infty]\\
\end{aligned}
\]</span></p>
<p>…where <span class="math inline">\(p\)</span> is an identifier for
the dose-response parameter (e.g. 1 for Emax and 2 for ED50), <span class="math inline">\(a\)</span> is an agent identifier and <span class="math inline">\(c\)</span> is a class identifier.</p>
<p>For dose-response parameters that are constrained to be non-negative
(<code>ed50</code>, <code>hill</code>, <code>onset</code>), default
prior distributions are truncated (normal). An alternative is to model
these parameters using a log-normal distribution
(<code>"dlnorm(mean, prec)"</code>).</p>
<p>Users may wish to change these, perhaps in order to use more/less
informative priors. For default prior distributions on some parameters
this may lead to errors when compiling/updating models due to
implausibly high values. Or in some cases they can constrain the
posterior distribution when the user may wish to allow for a wider range
of values.</p>
<p>If the model fails during compilation/updating (i.e. due to a problem
in JAGS), <code><a href="../reference/mbnma.run.html">mbnma.run()</a></code> will generate an error and return a
list of arguments that <code><a href="../reference/mbnma.run.html">mbnma.run()</a></code> used to generate the
model. Within this (as within a model that has run successfully), the
priors used by the model (in JAGS syntax) are stored within
<code>"model.arg"</code>:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">mbnma</span><span class="op">$</span><span class="va">model.arg</span><span class="op">$</span><span class="va">priors</span><span class="op">)</span></span>
<span><span class="co">#&gt; $mu</span></span>
<span><span class="co">#&gt; [1] "dnorm(0,0.0001)"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $ed50</span></span>
<span><span class="co">#&gt; [1] "dnorm(0,0.0001) T(0,)"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $emax</span></span>
<span><span class="co">#&gt; [1] "dnorm(0,0.0001)"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $sd</span></span>
<span><span class="co">#&gt; [1] "dunif(0, 6.021)"</span></span></code></pre></div>
<p>In this way a model can first be run with vague priors and then rerun
with different priors, perhaps to allow successful computation, perhaps
to provide more informative priors, or perhaps to run a sensitivity
analysis with different priors. Increasing the precision of prior
distributions only a little can also often improve convergence
considerably.</p>
<p>To change priors within a model, a list of replacements can be
provided to <code>priors</code> in <code><a href="../reference/mbnma.run.html">mbnma.run()</a></code>. The name of
each element is the name of the parameter to change (without indices)
and the value of the element is the JAGS distribution to use for the
prior. This can include censoring or truncation if desired. Only the
priors to be changed need to be specified - priors for parameters that
aren’t specified will take default values.</p>
<p>For example, if we want to use tighter priors for the half-normal SD
parameters we could increase the precision:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Define replacement prior</span></span>
<span><span class="va">new.priors</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>sd <span class="op">=</span> <span class="st">"dnorm(0, 1) T(0,)"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Run an MBNMA model with new priors</span></span>
<span><span class="va">emax</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mbnma.run.html">mbnma.run</a></span><span class="op">(</span><span class="va">alognet</span>, fun <span class="op">=</span> <span class="fu"><a href="../reference/demax.html">demax</a></span><span class="op">(</span><span class="op">)</span>, method <span class="op">=</span> <span class="st">"random"</span>, priors <span class="op">=</span> <span class="va">new.priors</span><span class="op">)</span></span></code></pre></div>
<p>Different prior distributions can be assigned for different indices
of a parameter by specifying the list element for a parameter as a
character vector. This allows (for example) for the user to fit specific
priors for specific agents. The length of this vector must be equal to
the number of indices of the parameter. The ordering will also be
important - for example for agent-specific priors the order of the
elements within the vector must match the order of the agents in the
network.</p>
<p>For example for an Emax function we may have different prior beliefs
about the ED50 parameter, as the dose scale will be different for
different agents:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ed50.priors</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>ed50 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>Celebrex <span class="op">=</span> <span class="st">"dnorm(100, 0.0025) T(0,)"</span>, Etoricoxib <span class="op">=</span> <span class="st">"dnorm(20, 0.01) T(0,)"</span>,</span>
<span>    Lumiracoxib <span class="op">=</span> <span class="st">"dnorm(50, 0.0025) T(0,)"</span>, Naproxcinod <span class="op">=</span> <span class="st">"dnorm(500, 0.0004) T(0,)"</span>,</span>
<span>    Naproxen <span class="op">=</span> <span class="st">"dnorm(500, 0.0004) T(0,)"</span>, Rofecoxib <span class="op">=</span> <span class="st">"dnorm(35, 0.04) T(0,)"</span>, Tramadol <span class="op">=</span> <span class="st">"dnorm(200, 0.0004) T(0,)"</span>,</span>
<span>    Valdecoxib <span class="op">=</span> <span class="st">"dnorm(4, 0.04) T(0,)"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Using the osteoarthritis dataset</span></span>
<span><span class="va">mbnma</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mbnma.run.html">mbnma.run</a></span><span class="op">(</span><span class="va">painnet</span>, fun <span class="op">=</span> <span class="fu"><a href="../reference/demax.html">demax</a></span><span class="op">(</span>emax <span class="op">=</span> <span class="st">"rel"</span>, ed50 <span class="op">=</span> <span class="st">"rel"</span><span class="op">)</span>, priors <span class="op">=</span> <span class="va">ed50.priors</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="pd-effective-number-of-parameters">pD (effective number of parameters)<a class="anchor" aria-label="anchor" href="#pd-effective-number-of-parameters"></a>
</h4>
<p>The default value in for <code>pd</code> in <code><a href="../reference/mbnma.run.html">mbnma.run()</a></code>
is <code>"pv"</code>, which uses the value automatically calculated in
the <code>R2jags</code> package as <code>pv = var(deviance)/2</code>.
Whilst this is easy to calculate, it is numerically less stable than
<code>pD</code> and may perform more poorly in certain conditions <span class="citation">(Gelman, Hwang, and Vehtari 2014)</span>.</p>
<p>A commonly-used approach for calculating pD is the plug-in method
(<code>pd="plugin"</code>) <span class="citation">(Spiegelhalter et al.
2002)</span>. However, this can sometimes result in negative
non-sensical values due to skewed posterior distributions for deviance
contributions that can arise when fitting non-linear models.</p>
<p>Another approach that is more reliable than the plug-in method when
modelling non-linear effects is using the Kullback-Leibler divergence
(<code>pd="pd.kl"</code>) <span class="citation">(Plummer 2008)</span>.
The disadvantage of this approach is that it requires running additional
MCMC iterations, so can be slightly slower to calculate.</p>
<p>Finally, pD can also be calculated using an optimism adjustment
(<code>pd="popt"</code>) which allows for calculation of the penalized
expected deviance <span class="citation">(Plummer 2008)</span>. This
adjustment allows for the fact that data used to estimate the model is
the same as that used to assess its parsimony. It also requires running
additional MCMC iterations.</p>
</div>
<div class="section level4">
<h4 id="arguments-to-be-sent-to-jags">Arguments to be sent to JAGS<a class="anchor" aria-label="anchor" href="#arguments-to-be-sent-to-jags"></a>
</h4>
<p>In addition to the arguments specific to <code><a href="../reference/mbnma.run.html">mbnma.run()</a></code> it
is also possible to use any arguments to be sent to
<code><a href="https://rdrr.io/pkg/R2jags/man/jags.html" class="external-link">R2jags::jags()</a></code>. Most of these are likely to relate to
improving the performance of MCMC simulations in JAGS and may help with
parameter convergence (see [Convergence]). Some of the key arguments
that may be of interest are:</p>
<ul>
<li>
<code>n.chains</code> The number of Markov chains to run (default is
3)</li>
<li>
<code>n.iter</code> The total number of iterations per MCMC
chain</li>
<li>
<code>n.burnin</code> The number of iterations that are discarded to
ensure iterations are only saved once chains have converged</li>
<li>
<code>n.thin</code> The thinning rate which ensures that results are
only saved for 1 in every <code>n.thin</code> iterations per chain. This
can be increased to reduce autocorrelation</li>
</ul>
</div>
</div>
<div class="section level3">
<h3 id="connecting-networks-via-the-dose-response-relationship">Connecting networks via the dose-response relationship<a class="anchor" aria-label="anchor" href="#connecting-networks-via-the-dose-response-relationship"></a>
</h3>
<p>One of the strengths of dose-response MBNMA is that it allows
treatments to be connected in a network that might otherwise be
disconnected, by linking up different doses of the same agent via the
dose-response relationship <span class="citation">(Pedder, Dias,
Bennetts, et al. 2021)</span>. To illustrate this we can generate a
version of the gout dataset which excludes placebo (to artificially
disconnect the network):</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Generate dataset without placebo</span></span>
<span><span class="va">noplac.gout</span> <span class="op">&lt;-</span> <span class="va">gout</span><span class="op">[</span><span class="op">!</span><span class="va">gout</span><span class="op">$</span><span class="va">studyID</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2001</span>, <span class="fl">3102</span><span class="op">)</span>, <span class="op">]</span>  <span class="co"># Drop two-arm placebo studies</span></span>
<span><span class="va">noplac.gout</span> <span class="op">&lt;-</span> <span class="va">noplac.gout</span><span class="op">[</span><span class="va">noplac.gout</span><span class="op">$</span><span class="va">agent</span> <span class="op">!=</span> <span class="st">"Plac"</span>, <span class="op">]</span>  <span class="co"># Drop placebo arm from multi-arm studies</span></span>
<span></span>
<span><span class="co"># Create mbnma.network object</span></span>
<span><span class="va">noplac.net</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mbnma.network.html">mbnma.network</a></span><span class="op">(</span><span class="va">noplac.gout</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Plot network</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">noplac.net</span>, label.distance <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in check.network(g): The following treatments/agents are not connected</span></span>
<span><span class="co">#&gt; to the network reference:</span></span>
<span><span class="co">#&gt; Allo_300</span></span>
<span><span class="co">#&gt; Allo_400</span></span>
<span><span class="co">#&gt; Arha_400</span></span>
<span><span class="co">#&gt; Arha_600</span></span>
<span><span class="co">#&gt; Benz_50</span></span>
<span><span class="co">#&gt; Benz_200</span></span>
<span><span class="co">#&gt; Febu_40</span></span>
<span><span class="co">#&gt; Febu_80</span></span>
<span><span class="co">#&gt; Febu_120</span></span>
<span><span class="co">#&gt; RDEA_100</span></span>
<span><span class="co">#&gt; RDEA_200</span></span>
<span><span class="co">#&gt; RDEA_400</span></span></code></pre></div>
<p><img src="runmbnmadose-2_files/figure-html/unnamed-chunk-13-1.png" width="672"></p>
<p>This results in a very disconnected network, and if we were to
conduct a conventional “split” NMA (whereby different doses of an agent
are considered to be independent), we would only be able to estimate
relative effects for a very small number of treatments. However, if we
assume a dose-response relationship then these different doses can be
connected via this relationship, and we can connect up more treatments
and agents in the network.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Network plot at the agent level illustrates how doses can connect using MBNMA</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">noplac.net</span>, level <span class="op">=</span> <span class="st">"agent"</span>, remove.loops <span class="op">=</span> <span class="cn">TRUE</span>, label.distance <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in check.network(g): The following treatments/agents are not connected</span></span>
<span><span class="co">#&gt; to the network reference:</span></span>
<span><span class="co">#&gt; Arha</span></span>
<span><span class="co">#&gt; RDEA</span></span></code></pre></div>
<p><img src="runmbnmadose-2_files/figure-html/unnamed-chunk-14-1.png" width="672"></p>
<p>There are still two agents that do not connect to the network because
they involve comparisons of different doses of the same agent. However,
multiple doses of an agent within a study allow us to estimate the
dose-response relationship and tell us something about the placebo (dose
= 0) response - the number of different doses of an agent within a study
will determine the degrees of freedom with which we are able to estimate
a given dose-response function. Although the placebo response is not
estimated directly in the MBNMA framework (it is modelled as a nuisance
parameter), it allows us to connect the dose-response function estimated
for an agent in one study, with that in another.</p>
<p>To visualise this, we can use the <code>doselink</code> argument in
<code>plot(mbnma.network)</code>. The integer given to this argument
indicates the minimum number of doses from which a dose-response
function could be estimated, and is equivalent to the number of
parameters in the desired dose-response function plus one. For example
for an exponential function, we would require at least two doses on a
dose-response curve (including placebo), since this would allow one
degree of freedom with which to estimate the one-parameter dose-response
function. By modifying the <code>doselink</code> argument we can
determine the complexity of a dose-response function that we might
expect to be able to estimate whilst still connecting all agents within
the network.</p>
<p>If placebo is not included in the original dataset then this argument
will also add a node for placebo to illustrate the connection.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Network plot assuming connectivity via two doses Allows estimation of a</span></span>
<span><span class="co"># single-parameter dose-response function</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">noplac.net</span>, level <span class="op">=</span> <span class="st">"agent"</span>, remove.loops <span class="op">=</span> <span class="cn">TRUE</span>, label.distance <span class="op">=</span> <span class="fl">4</span>, doselink <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="co">#&gt; Dose-response connections to placebo plotted based on a dose-response</span></span>
<span><span class="co">#&gt;                    function with 1 degrees of freedom</span></span></code></pre></div>
<p><img src="runmbnmadose-2_files/figure-html/unnamed-chunk-15-1.png" width="672"></p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Network plot assuming connectivity via three doses Allows estimation of a</span></span>
<span><span class="co"># two-parameter dose-response function</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">noplac.net</span>, level <span class="op">=</span> <span class="st">"agent"</span>, remove.loops <span class="op">=</span> <span class="cn">TRUE</span>, label.distance <span class="op">=</span> <span class="fl">4</span>, doselink <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in check.network(g): The following treatments/agents are not connected</span></span>
<span><span class="co">#&gt; to the network reference:</span></span>
<span><span class="co">#&gt; Allo</span></span>
<span><span class="co">#&gt; Arha</span></span>
<span><span class="co">#&gt; Benz</span></span>
<span><span class="co">#&gt; Febu</span></span>
<span><span class="co">#&gt; Dose-response connections to placebo plotted based on a dose-response</span></span>
<span><span class="co">#&gt;                    function with 2 degrees of freedom</span></span></code></pre></div>
<p><img src="runmbnmadose-2_files/figure-html/unnamed-chunk-15-2.png" width="672"></p>
<p>In this way we can fully connect up treatments in an otherwise
disconnected network, though unless informative prior information is
used this will be limited by the number of doses of agents within
included studies. See Pedder et al. <span class="citation">(2021)</span>
for more details on this.</p>
</div>
<div class="section level3">
<h3 id="non-parametric-dose-response-functions">Non-parametric dose-response functions<a class="anchor" aria-label="anchor" href="#non-parametric-dose-response-functions"></a>
</h3>
<p>In addition to the parametric dose-response functions described
above, a non-parametric monotonic dose-response relationship can also be
specified in <code><a href="../reference/mbnma.run.html">mbnma.run()</a></code>. <code>fun=dnonparam()</code> can
be used to specify a monotonically increasing
(<code>direction="increasing"</code>) or decreasing
(<code>direction="decreasing"</code>) dose-response respectively. This
is achieved in the model by imposing restrictions on the prior
distributions of treatment effects that ensure that each increasing dose
of an agent has an effect that is either the same or greater than the
previous dose. The approach results in a similar model to that developed
by Owen et al. <span class="citation">(2015)</span>.</p>
<p>By making this assumption, this model is slightly more informative,
and can lead to some slight gains in precision if relative effects are
otherwise imprecisely estimated. However, because a functional form for
the dose-response is not modeled, it cannot be used to connect networks
that are disconnected at the treatment-level, unlike a parametric
MBNMA.</p>
<p>In the case of MBNMA, it may be useful to compare the fit of a
non-parametric model to that of a parametric dose-response function, to
ensure that fitting a parametric dose-response function does not lead to
significantly poorer model fit.</p>
<p>When fitting a non-parametric dose-response model, it is important to
correctly choose the expected <code>direction</code> of the monotonic
response, otherwise it can lead to computation error.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nonparam</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mbnma.run.html">mbnma.run</a></span><span class="op">(</span><span class="va">tripnet</span>, fun <span class="op">=</span> <span class="fu"><a href="../reference/dnonparam.html">dnonparam</a></span><span class="op">(</span>direction <span class="op">=</span> <span class="st">"increasing"</span><span class="op">)</span>, method <span class="op">=</span> <span class="st">"random"</span><span class="op">)</span></span>
<span><span class="co">#&gt; `likelihood` not given by user - set to `binomial` based on data provided</span></span>
<span><span class="co">#&gt; `link` not given by user - set to `logit` based on assigned value for `likelihood`</span></span></code></pre></div>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">nonparam</span><span class="op">)</span></span>
<span><span class="co">#&gt; Inference for Bugs model at "/tmp/RtmpgI1Fif/file1fee45bd01a9", fit using jags,</span></span>
<span><span class="co">#&gt;  3 chains, each with 20000 iterations (first 10000 discarded), n.thin = 10</span></span>
<span><span class="co">#&gt;  n.sims = 3000 iterations saved</span></span>
<span><span class="co">#&gt;            mu.vect sd.vect     2.5%      25%      50%      75%    97.5%  Rhat</span></span>
<span><span class="co">#&gt; d.1[1,1]     0.000   0.000    0.000    0.000    0.000    0.000    0.000 1.000</span></span>
<span><span class="co">#&gt; d.1[1,2]     0.000   0.000    0.000    0.000    0.000    0.000    0.000 1.000</span></span>
<span><span class="co">#&gt; d.1[2,2]     1.210   0.176    0.857    1.093    1.211    1.328    1.556 1.001</span></span>
<span><span class="co">#&gt; d.1[3,2]     1.749   0.117    1.517    1.672    1.749    1.825    1.982 1.001</span></span>
<span><span class="co">#&gt; d.1[4,2]     2.052   0.144    1.775    1.953    2.051    2.144    2.345 1.002</span></span>
<span><span class="co">#&gt; d.1[1,3]     0.000   0.000    0.000    0.000    0.000    0.000    0.000 1.000</span></span>
<span><span class="co">#&gt; d.1[2,3]     0.948   0.142    0.633    0.860    0.964    1.047    1.187 1.002</span></span>
<span><span class="co">#&gt; d.1[3,3]     1.119   0.086    0.955    1.062    1.118    1.178    1.292 1.004</span></span>
<span><span class="co">#&gt; d.1[4,3]     1.267   0.112    1.052    1.186    1.264    1.346    1.490 1.002</span></span>
<span><span class="co">#&gt; d.1[5,3]     1.464   0.087    1.298    1.402    1.462    1.525    1.633 1.004</span></span>
<span><span class="co">#&gt; d.1[1,4]     0.000   0.000    0.000    0.000    0.000    0.000    0.000 1.000</span></span>
<span><span class="co">#&gt; d.1[2,4]     1.233   0.209    0.835    1.091    1.229    1.365    1.652 1.001</span></span>
<span><span class="co">#&gt; d.1[3,4]     1.600   0.313    1.035    1.384    1.583    1.797    2.262 1.001</span></span>
<span><span class="co">#&gt; d.1[1,5]     0.000   0.000    0.000    0.000    0.000    0.000    0.000 1.000</span></span>
<span><span class="co">#&gt; d.1[2,5]     0.623   0.240    0.135    0.458    0.632    0.798    1.061 1.003</span></span>
<span><span class="co">#&gt; d.1[3,5]     1.041   0.123    0.807    0.961    1.037    1.119    1.287 1.005</span></span>
<span><span class="co">#&gt; d.1[4,5]     1.452   0.213    1.063    1.303    1.444    1.595    1.886 1.006</span></span>
<span><span class="co">#&gt; d.1[1,6]     0.000   0.000    0.000    0.000    0.000    0.000    0.000 1.000</span></span>
<span><span class="co">#&gt; d.1[2,6]     0.786   0.313    0.129    0.566    0.830    1.024    1.297 1.018</span></span>
<span><span class="co">#&gt; d.1[3,6]     1.253   0.115    1.025    1.176    1.257    1.330    1.472 1.001</span></span>
<span><span class="co">#&gt; d.1[4,6]     1.559   0.188    1.236    1.425    1.543    1.681    1.970 1.003</span></span>
<span><span class="co">#&gt; d.1[5,6]     1.885   0.264    1.433    1.696    1.869    2.053    2.451 1.003</span></span>
<span><span class="co">#&gt; d.1[6,6]     2.907   0.609    1.882    2.456    2.846    3.313    4.224 1.010</span></span>
<span><span class="co">#&gt; d.1[1,7]     0.000   0.000    0.000    0.000    0.000    0.000    0.000 1.000</span></span>
<span><span class="co">#&gt; d.1[2,7]     0.561   0.209    0.137    0.426    0.567    0.702    0.978 1.003</span></span>
<span><span class="co">#&gt; d.1[3,7]     1.005   0.305    0.453    0.796    0.983    1.200    1.669 1.001</span></span>
<span><span class="co">#&gt; d.1[1,8]     0.000   0.000    0.000    0.000    0.000    0.000    0.000 1.000</span></span>
<span><span class="co">#&gt; d.1[2,8]     0.499   0.313    0.025    0.242    0.460    0.718    1.146 1.001</span></span>
<span><span class="co">#&gt; d.1[3,8]     1.277   0.160    0.955    1.172    1.280    1.388    1.584 1.005</span></span>
<span><span class="co">#&gt; d.1[4,8]     1.619   0.102    1.421    1.552    1.617    1.686    1.819 1.003</span></span>
<span><span class="co">#&gt; sd           0.259   0.047    0.171    0.228    0.257    0.289    0.356 1.006</span></span>
<span><span class="co">#&gt; totresdev  189.368  19.220  152.706  175.947  188.696  202.044  228.622 1.001</span></span>
<span><span class="co">#&gt; deviance  1092.474  19.220 1055.812 1079.053 1091.802 1105.150 1131.728 1.001</span></span>
<span><span class="co">#&gt;           n.eff</span></span>
<span><span class="co">#&gt; d.1[1,1]      1</span></span>
<span><span class="co">#&gt; d.1[1,2]      1</span></span>
<span><span class="co">#&gt; d.1[2,2]   3000</span></span>
<span><span class="co">#&gt; d.1[3,2]   2900</span></span>
<span><span class="co">#&gt; d.1[4,2]   1100</span></span>
<span><span class="co">#&gt; d.1[1,3]      1</span></span>
<span><span class="co">#&gt; d.1[2,3]   1700</span></span>
<span><span class="co">#&gt; d.1[3,3]    590</span></span>
<span><span class="co">#&gt; d.1[4,3]   1300</span></span>
<span><span class="co">#&gt; d.1[5,3]    590</span></span>
<span><span class="co">#&gt; d.1[1,4]      1</span></span>
<span><span class="co">#&gt; d.1[2,4]   2700</span></span>
<span><span class="co">#&gt; d.1[3,4]   3000</span></span>
<span><span class="co">#&gt; d.1[1,5]      1</span></span>
<span><span class="co">#&gt; d.1[2,5]   1700</span></span>
<span><span class="co">#&gt; d.1[3,5]    430</span></span>
<span><span class="co">#&gt; d.1[4,5]    390</span></span>
<span><span class="co">#&gt; d.1[1,6]      1</span></span>
<span><span class="co">#&gt; d.1[2,6]    320</span></span>
<span><span class="co">#&gt; d.1[3,6]   2400</span></span>
<span><span class="co">#&gt; d.1[4,6]    840</span></span>
<span><span class="co">#&gt; d.1[5,6]    700</span></span>
<span><span class="co">#&gt; d.1[6,6]    230</span></span>
<span><span class="co">#&gt; d.1[1,7]      1</span></span>
<span><span class="co">#&gt; d.1[2,7]   2800</span></span>
<span><span class="co">#&gt; d.1[3,7]   3000</span></span>
<span><span class="co">#&gt; d.1[1,8]      1</span></span>
<span><span class="co">#&gt; d.1[2,8]   3000</span></span>
<span><span class="co">#&gt; d.1[3,8]    410</span></span>
<span><span class="co">#&gt; d.1[4,8]    960</span></span>
<span><span class="co">#&gt; sd          530</span></span>
<span><span class="co">#&gt; totresdev  3000</span></span>
<span><span class="co">#&gt; deviance   3000</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; For each parameter, n.eff is a crude measure of effective sample size,</span></span>
<span><span class="co">#&gt; and Rhat is the potential scale reduction factor (at convergence, Rhat=1).</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; DIC info (using the rule, pD = var(deviance)/2)</span></span>
<span><span class="co">#&gt; pD = 128.3 and DIC = 1220.1</span></span>
<span><span class="co">#&gt; DIC is an estimate of expected predictive error (lower deviance is better).</span></span></code></pre></div>
<p>In the output from non-parametric models, <code>d.1</code> parameters
represent the relative effect for each treatment (specific dose of a
specific agent) versus the reference treatment, similar to in a standard
Network Meta-Analysis. The first index of <code>d</code> represents the
dose identifier, and the second index represents the agent identifier.
Information on the specific values of the doses is not included in the
model, as only the ordering of them (lowest to highest) is
important.</p>
<p>Note that some post-estimation functions (e.g. ranking, prediction)
cannot be performed on non-parametric models within the package.</p>
</div>
<div class="section level3">
<h3 id="assessment-of-model-fit">Assessment of model fit<a class="anchor" aria-label="anchor" href="#assessment-of-model-fit"></a>
</h3>
<p>For looking at model fit we will demonstrate using results from an
Emax MBNMA on the triptans dataset:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tripnet</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mbnma.network.html">mbnma.network</a></span><span class="op">(</span><span class="va">triptans</span><span class="op">)</span></span>
<span><span class="co">#&gt; Values for `agent` with dose = 0 have been recoded to `Placebo`</span></span>
<span><span class="co">#&gt; agent is being recoded to enforce sequential numbering</span></span>
<span><span class="va">trip.emax</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mbnma.run.html">mbnma.run</a></span><span class="op">(</span><span class="va">tripnet</span>, fun <span class="op">=</span> <span class="fu"><a href="../reference/demax.html">demax</a></span><span class="op">(</span>emax <span class="op">=</span> <span class="st">"rel"</span>, ed50 <span class="op">=</span> <span class="st">"rel"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; `likelihood` not given by user - set to `binomial` based on data provided</span></span>
<span><span class="co">#&gt; `link` not given by user - set to `logit` based on assigned value for `likelihood`</span></span></code></pre></div>
<div class="section level4">
<h4 id="deviance-plots">Deviance plots<a class="anchor" aria-label="anchor" href="#deviance-plots"></a>
</h4>
<p>To assess how well a model fits the data, it can be useful to look at
a plot of the contributions of each data point to the residual deviance.
This can be done using <code><a href="../reference/devplot.html">devplot()</a></code>. As individual deviance
contributions are not automatically monitored in
<code>parameters.to.save</code>, this might require the model to be
automatically run for additional iterations.</p>
<p>Results can be plotted either as a scatter plot
(<code>plot.type="scatter"</code>) or a series of boxplots
(<code>plot.type="box"</code>).</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Plot boxplots of residual deviance contributions (scatterplot is the default)</span></span>
<span><span class="fu"><a href="../reference/devplot.html">devplot</a></span><span class="op">(</span><span class="va">trip.emax</span>, plot.type <span class="op">=</span> <span class="st">"box"</span><span class="op">)</span></span>
<span><span class="co">#&gt; `resdev` not monitored in mbnma$parameters.to.save.</span></span>
<span><span class="co">#&gt; additional iterations will be run in order to obtain results for `resdev`</span></span></code></pre></div>
<p><img src="runmbnmadose-2_files/figure-html/unnamed-chunk-18-1.png" width="672"></p>
<p>From these plots we can see that whilst the model fit does not seem
to be systematically non-linear (which would suggest an alternative
dose-response function may be a better fit), residual deviance is high
at a dose of 1 for eletriptan, and at 2 for sumatriptan. This may
indicate that fitting random effects may allow for additional
variability in response which may improve the model fit.</p>
<p>If saved to an object, the output of <code><a href="../reference/devplot.html">devplot()</a></code> contains
the results for individual deviance contributions, and this can be used
to identify any extreme outliers.</p>
</div>
<div class="section level4">
<h4 id="fitted-values">Fitted values<a class="anchor" aria-label="anchor" href="#fitted-values"></a>
</h4>
<p>Another approach for assessing model fit can be to plot the fitted
values, using <code><a href="../reference/fitplot.html">fitplot()</a></code>. As with <code><a href="../reference/devplot.html">devplot()</a></code>,
this may require running additional model iterations to monitor
<code>theta</code>.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Plot fitted and observed values with treatment labels</span></span>
<span><span class="fu"><a href="../reference/fitplot.html">fitplot</a></span><span class="op">(</span><span class="va">trip.emax</span><span class="op">)</span></span>
<span><span class="co">#&gt; `theta` not monitored in mbnma$parameters.to.save.</span></span>
<span><span class="co">#&gt; additional iterations will be run in order to obtain results</span></span></code></pre></div>
<p><img src="runmbnmadose-2_files/figure-html/unnamed-chunk-19-1.png" width="672"></p>
<p>Fitted values are plotted as connecting lines and observed values in
the original dataset are plotted as points. These plots can be used to
identify if the model fits the data well for different agents and at
different doses along the dose-response function.</p>
</div>
</div>
<div class="section level3">
<h3 id="model-selection">Model Selection<a class="anchor" aria-label="anchor" href="#model-selection"></a>
</h3>
<p>Detailed description of model selection based on statistical measures
such as Deviance Information Criterion (DIC) and residual deviance is
outside the scope of this vignette. However, the following approach for
model identification and selection is recommended, which also gives
details on model fit statistics used for comparison:</p>
<ol style="list-style-type: decimal">
<li>Identify candidate dose-response functions based on plotted results
of split NMA (<code><a href="../reference/nma.run.html">plot.nma()</a></code>) and clinical/biological
reasoning</li>
<li>Compare candidate dose-response functions fitted with common
relative treatment effects
(<code>mbnma.run(..., method="common")</code>)</li>
<li>If no candidate dose-response functions converge successfully,
additional modelling assumptions can be made to strengthen inference,
provided they are clinically justifiable (e.g. class effects,
agent-specific dose-response functions, correlation between
dose-response parameters)</li>
<li>Compare selected common effects model to the same model fitted with
random effects (<code>mbnma.run(..., method="random")</code>)</li>
</ol>
<p>Finally the validity of the consistency assumption should be explored
in the selected final model (see [Consistency Testing] and Pedder et al.
<span class="citation">(2021)</span>).</p>
</div>
<div class="section level3">
<h3 id="mcmc-convergence">MCMC Convergence<a class="anchor" aria-label="anchor" href="#mcmc-convergence"></a>
</h3>
<p><code>MBNMAdose</code> runs Bayesian models in JAGS, which uses
Markov Chain Monte Carlo (MCMC) simulation. However, the validity of
results is reliant on the MCMC chains having converged successfully on
the posterior densities of all parameters in the model. For highly
parameterised models run on relatively limited data, as is often the
case with MBNMA models, convergence can often be an challenge. Note that
convergence is <em>necessary</em> to be able to compare models and
evaluate model fit. However, successful convergence <em>does not</em>
imply good model fit.</p>
<p>A full explanation of how to facilitate and to check for convergence
is outside the scope of this vignette, but below are some simple steps
for checking convergence. None of these steps alone ensures convergence
has been successful, but interpretation of them jointly can provide
strong evidence of it.</p>
<ul>
<li>Rhat values close to 1 (&lt;1.1 is considered acceptable by some).
These are shown for monitored parameters in the summary statistics table
when an <code>"mbnma"</code> or <code>"nma"</code> object is
printed.</li>
<li>Trace plots that have a “fuzzy caterpillar” look that shows good
mixing of MCMC chains</li>
<li>Density plots that show a smooth posterior distribution that is
similar across all chains</li>
<li>Autocorrelation plots that show low autocorrelation between
neighbouring MCMC iterations (i.e. low correlation at higher lags)</li>
</ul>
<p>An HTML document with all the above convergence plots can easily be
generated for all parameters in the model simultaneously using
<code><a href="https://rdrr.io/pkg/mcmcplots/man/mcmcplot.html" class="external-link">mcmcplots::mcmcplot()</a></code>.</p>
<p>Two steps may improve convergence when using <code>MBNMAdose</code>.
One step is to run models for more iterations (this can be done using
the <code>n.iter</code> argument in <code><a href="../reference/mbnma.run.html">mbnma.run()</a></code>). It can
take time for MCMC chains to converge, particularly for non-linear
models with limited data. It is important to note that chains should
only be monitored <em>after</em> they have converged - increasing the
number of burn-in iterations ensures that this is the case (using the
<code>n.burnin</code> argument in <code><a href="../reference/mbnma.run.html">mbnma.run()</a></code>). Another
method to improve convergence is by providing more information to the
model via informative priors.</p>
<p>For a detailed review of MCMC convergence assessment see Sinharay
<span class="citation">(2003)</span>.</p>
</div>
<div class="section level3">
<h3 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h3>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-GMD2" class="csl-entry">
Daly, C., N. J. Welton, S. Dias, S. Anwer, and A. E. Ades. 2021.
<span>“NICE Guideline Methodology Document 2: Meta-Analysis of
Continuous Outcomes.”</span> Population Health Sciences, University of
Bristol; Centre for Reviews; Dissemination; Centre for Health Economics,
University of York. <a href="https://www.bristol.ac.uk/media-library/sites/social-community-medicine/documents/mpes/gmd-2-continuous-jan2021.pdf" class="external-link">https://www.bristol.ac.uk/media-library/sites/social-community-medicine/documents/mpes/gmd-2-continuous-jan2021.pdf</a>.
</div>
<div id="ref-friedrich2011" class="csl-entry">
Friedrich, J. O., N. K. J. Adhikari, and J. Beyene. 2011. <span>“Ratio
of Means for Analyzing Continuous Outcomes in Meta-Analysis Performed as
Well as Mean Difference Methods.”</span> Journal Article. <em>Journal of
Clinical Epidemiology</em> 64 (5): 556–64. <a href="https://doi.org/10.1016/j.jclinepi.2010.09.016" class="external-link">https://doi.org/10.1016/j.jclinepi.2010.09.016</a>.
</div>
<div id="ref-gelman2014" class="csl-entry">
Gelman, Andrew, Jessica Hwang, and Aki Vehtari. 2014.
<span>“Understanding Predictive Information Criteria for Bayesian
Models.”</span> Journal Article. <em>Statistics and Computing</em> 24
(6): 997–1016. <a href="https://doi.org/10.1007/s11222-013-9416-2" class="external-link">https://doi.org/10.1007/s11222-013-9416-2</a>.
</div>
<div id="ref-jags" class="csl-entry">
JAGS Computer Program. 2017. <a href="https://mcmc-jags.sourceforge.io/" class="external-link">https://mcmc-jags.sourceforge.io/</a>.
</div>
<div id="ref-owen2015" class="csl-entry">
Owen, R. K., D. G. Tincello, and R. A. Keith. 2015. <span>“Network
Meta-Analysis: Development of a Three-Level Hierarchical Modeling
Approach Incorporating Dose-Related Constraints.”</span> Journal
Article. <em>Value Health</em> 18 (1): 116–26. <a href="https://doi.org/10.1016/j.jval.2014.10.006" class="external-link">https://doi.org/10.1016/j.jval.2014.10.006</a>.
</div>
<div id="ref-pedder2021" class="csl-entry">
Pedder, H., S. Dias, M. Bennetts, M. Boucher, and N. J. Welton. 2021.
<span>“Joining the Dots: Linking Disconnected Networks of Evidence Using
Dose-Response Model-Based Network Meta-Analysis.”</span> Journal
Article. <em>Medical Decision Making</em> 41 (2): 194–208.
</div>
<div id="ref-pedder2021cons" class="csl-entry">
Pedder, H., S. Dias, M. Boucher, M. Bennetts, D. Mawdsley, and N. J.
Welton. 2021. <span>“Methods to Assess Evidence Consistency in
Dose-Response Model Based Network Meta-Analysis.”</span> Journal
Article. <em>Statistics in Medicine</em> 41 (4): 625–44.
</div>
<div id="ref-plummer2008" class="csl-entry">
Plummer, M. 2008. <span>“Penalized Loss Functions for Bayesian Model
Comparison.”</span> Journal Article. <em>Biostatistics</em> 9 (3):
523–39. <a href="https://pubmed.ncbi.nlm.nih.gov/18209015/" class="external-link">https://pubmed.ncbi.nlm.nih.gov/18209015/</a>.
</div>
<div id="ref-sinharay" class="csl-entry">
Sinharay, S. 2003. <span>“Assessing Convergence of the Markov Chain
Monte Carlo Algorithms: A Review.”</span> RR-03-07. ETS Research Report
Series. <a href="https://onlinelibrary.wiley.com/doi/pdf/10.1002/j.2333-8504.2003.tb01899.x" class="external-link">https://onlinelibrary.wiley.com/doi/pdf/10.1002/j.2333-8504.2003.tb01899.x</a>.
</div>
<div id="ref-spiegelhalter2002" class="csl-entry">
Spiegelhalter, D. J., N. G. Best, B. P. Carlin, and A. van der Linde.
2002. <span>“Bayesian Measures of Model Complexity and Fit.”</span>
Journal Article. <em>J R Statistic Soc B</em> 64 (4): 583–639.
</div>
<div id="ref-thorlund2014" class="csl-entry">
Thorlund, K., E. J. Mills, P. Wu, E. P. Ramos, A. Chatterjee, E. Druyts,
and P. J. Godsby. 2014. <span>“Comparative Efficacy of Triptans for the
Abortive Treatment of Migraine: A Multiple Treatment Comparison
Meta-Analysis.”</span> Journal Article. <em>Cephalagia</em>. <a href="https://doi.org/10.1177/0333102413508661" class="external-link">https://doi.org/10.1177/0333102413508661</a>.
</div>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Hugo Pedder.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.8.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
